game.import("extension",function(lib,game,ui,get,ai,_status){return {name:"虚实",editable:false,content:function (config,pack){
    
},precontent:function (){
    
},help:{},config:{},package:{
    character:{
        character:{
            xsbaosanliang:["female","shu",3,["xsjieyuan","xsshuizhen"],["des:相传她是鲍家庄鲍员外的小女儿。后来与关索成亲，关羽自传授其武艺，因此也造就了鲍三娘的文武双全。荆州失守之后鲍三娘就跟随关索一同投奔蜀汉，并随诸葛亮征讨南蛮。平定了南蛮之后，夫妻二人就此一直替诸葛亮镇守着南中，他们也的确留下了许多脍炙人口的行侠仗义故事，在民间广为流传。"]],
            "xsanguo_nanhua":["male","qun",3,["xsanguo_xiandao","xsanguo_xiuzheng","xsanguo_shoushu"],["des:南华老仙，古典小说《三国演义》中张角的师傅，在《三国演义》中将三卷天书【太平要术】传给张角，让他普救世人。言讫，化阵清风而去。张角得此书，晓夜攻习，能呼风唤雨，号为 “天公将军”，开启三国乱世。南华老仙与迷之仙人左慈，太平道人于吉，被称为汉末三仙"]],
            xshuaxin:["male","wei",3,["xsqinglian","xsbigong","xsshuzhan"],["des:华歆（157年—232年1月30日），字子鱼，汉族。平原高唐人（今山东聊城高唐县）。汉末魏初时名士，曹魏重臣。华歆早年拜太尉陈球为师，与卢植、郑玄、管宁等为同门，又与管宁、邴原共称一龙，华歆为龙头。汉灵帝时华歆被举为孝廉，任郎中，因病去官。又被何进征召为尚书郎。后任豫章太守，甚得民心。孙策破刘繇后，华歆举豫章郡投降，被奉为上宾。官渡之战时，被征为议郎，参司空军事。入为尚书，转侍中，又代荀彧为尚书令。曹操讨孙权时，以华歆为军师。后为魏王国御史大夫。曹丕即王位，拜华歆相国，封安乐乡侯。曹丕代汉建魏，改相国为司徒。魏明帝曹叡即位后，升任太尉，晋封博平侯。太和五年十二月（232年1月）去世，谥号“敬”。"]],
            xstianyu:["male","wei",4,["xsjiansu","xszhenghuan"],["des:田豫（171年－252年），字国让，渔阳雍奴（今天津市武清区东北）人。三国时期曹魏将领。初从刘备，因母亲年老回乡，后跟随公孙瓒，公孙瓒败亡，劝说鲜于辅加入曹操。曹操攻略河北时，田豫正式得到曹操任用，历任颖阴、郎陵令、弋阳太守等。后来田豫常年镇守曹魏北疆，从征代郡乌桓、斩骨进、破轲比能，多有功勋；也曾参与对孙吴的作战，在成山斩杀周贺，于新城击败孙权。官至太中大夫，封长乐亭侯。有一子田彭祖。"]],
            xssunhuan:["male","wu",4,["xsjiezhui"],["des:孙桓（198年-223年），字叔武，吴郡富春（今浙江杭州富阳区）人。三国时期吴国建武将军，孙河第三子。仪容端正，器怀聪明，博学强记，能论议应对，孙权常称为“宗室颜渊”，擢为武卫都尉。建安二十四年（219年），参与由吕蒙指挥的袭击荆州行动，从讨关羽于华容，招揽关羽余众，得五千人以及大量牛马器械。黄武元年（222年），孙桓二十五岁，拜安东中郎将，跟随陆逊抗击进攻东吴的刘备。当时刘备率领众多兵众进攻，满山都是蜀军，孙桓奋战，与陆逊等协力击破蜀军。刘备兵败逃走，孙桓截击，“斩上夔道，扼要径”，差点生擒刘备。战后孙桓因功拜建武将军，封丹徒侯，督牛渚，修筑横江坞，期间逝世。"]],
            xsjianggan:["male","wei",3,["xsquanyu","xsdaoshu"],["des:蒋干，字子翼，汉末三国时期的人物，九江（治今安徽寿县）人。历史上的蒋干是当时的名士、辩论家。而罗贯中在历史小说《三国演义》中则将蒋干刻画成了被周瑜所愚弄的小丑形象。"]],
            xsweizhu:["male","wu",3,["xsyuandu","xsxunyi"],["des:卫温 （？——231年），三国时东吴将领，曾任将军职。230年（黄龙二年），东吴皇帝孙权命他与诸葛直率领甲士万人，浮海求夷州（台湾）、亶州。虽未找到亶州，却在台湾停留近一年。回来后，以“违诏无功”入狱被杀。此后台湾在经济，文化等方面同大陆的联系逐渐密切，开始成为中国不可分割的领土。</br>诸葛直（？——231年），三国时期东吴将领，奉孙权的命令和卫温渡海到夷洲（今台湾）。返回东吴后，孙权认为他们二人无功而返，把他们处死。卫温和诸葛直等人是史料记载的最早到达并开发台湾的中国人。"]],
            xsliuzhang:["male","qun",3,["xsshoutu","xsyinghuan","xstoucheng"],["zhu","des:刘璋（？－220年），字季玉，江夏竟陵（今湖北天门）人。东汉末年割据军阀之一。继父亲刘焉担任益州牧，刘璋为人懦弱多疑，汉中张鲁骄纵，不听刘璋号令，于是刘璋杀张鲁母弟，双方成为仇敌，刘璋派庞羲攻击张鲁，战败。后益州内乱，平定后，又有曹操将前来袭击的消息。在内外交逼之下，刘璋听信手下张松、法正之言，迎接刘备入益州，想借刘备之力，抵抗曹操。不料此举乃引狼入室，刘备反手攻击刘璋，法正又为刘备内应，刘璋不得已于214年投降，被迁往荆州公安，于建安二十四年（220年）病逝于荆州。"]],
            xssunyi:["male","wu",4,["xscefeng","xszhuolie"],["des:孙翊（184年－204年），又名孙俨，字叔弼，是孙坚的第三子，孙策、孙权的弟弟。勇猛果断，很有其兄长孙策的风格，曾被大臣推荐为继承者。孙权继位后，孙翊任丹杨太守，不久被身边的人边鸿杀害。"]],
            xshuojun:["male","shu",4,["xsshouxi"],["des:霍峻（178年—217年），字仲邈，南郡枝江（今湖北枝江）人，东汉末年刘备麾下名将。其兄霍笃曾在故乡聚部众数百人。后霍笃逝世，刘表以霍峻继承其部曲。208年（建安十三年），刘表病逝，霍峻便率部曲归降刘备，并被任为中郎将。后随刘备入蜀，刘备从葭萌还袭刘璋，留霍峻守葭萌城。张鲁遣将杨帛劝降霍峻，霍峻严词拒绝，杨帛退去。后刘璋将扶禁、向存等率万余人由阆水上，攻围霍峻，城中兵不过数百人，霍峻坚守一年，伺机将其击破。刘备定蜀，嘉霍峻之功，于是分广汉为梓潼郡，以峻为梓潼太守、裨将军。三年后，年四十岁去世，还葬成都。刘备亲率群僚临会吊祭，留宿墓上，当时的人都为他感到荣幸。"]],
            xsgaolan:["male","qun",4,["xsxiying"],["des:高览（？—200），一名高奂，字元伯，河北名将，本属袁绍部将，后官渡之战淳于琼被曹操击破，与张郃一同投降曹操，被封为偏将军，东莱侯。《三国演义》里，曾与许褚、徐晃大战不分胜负，后刘备败走荆州时，高览奉命追杀，被冲阵而来的赵云刺死。高览与颜良、文丑、张郃被后世并称为“河北四庭柱”。"]],
            xsdingyuan:["male","qun",5,["xsxiongbing","xsxiongbing2","xspanxi2"],["des:丁原（大约143—189年），字建阳，东汉末年人物，官拜执金吾，领并州刺史，汉灵帝驾崩后，受何进之邀，入洛阳诛杀十常侍，未至，何进已被宦官所杀。之后，丁原与董卓发生冲突，董卓得知丁原手下大将吕布唯利是图并未得重用，便遣使挑拨诱使吕布将其杀害。"]],
            xsdengzhi:["male","shu",3,["xsyanbian","xsdingmeng"],["des:邓芝（178年—251年），字伯苗。义阳新野（今河南新野）人。东汉名将邓禹之后，三国时蜀汉重臣。邓芝早年曾被预言能位至大将，后被刘备任为郫令，升迁为广汉太守。因任官公廉，有治绩，被征为尚书。刘备逝世后，奉命出使吴国，成功修复两国关系，并深为孙权所赏识。建兴六年（228年），丞相诸葛亮策划北伐时，命邓芝与大将赵云佯攻郿城，以吸引魏曹真军主力。建兴十二年（234年），迁前军师、前将军，领兖州刺史，封阳武亭侯，不久督领江州。延熙六年（243年），迁车骑将军，后授假节。又率军平定涪陵叛乱。延熙十四年（251年），邓芝病逝。邓芝性格正直、简单，不刻意修饰情绪。他为将二十多年，赏罚明断，体恤士卒。身上的衣食取自官府，从未经营过私产，妻儿甚至还有忍饥挨饿之时，死时家中也没有多余财物。"]],
            "xssp_yanwan":["female","shu",3,["xsmengxian","xszhenjue"],["des:杨氏（婉字出自小说，史书无记载），生卒年不祥，东汉末年凉州人。早年嫁于东汉前将军、槐里侯马腾之子马超，追随马超转战并州、雍州、凉州，为马超生下子嗣。公元212年，马超联军在渭南战败后，杨婉随马超逃亡凉州，很快马超反攻吞并陇上诸郡县。公元213年，杨婉为了帮助马超，结识王异，了解马超这些投降部下。可惜被王异蛊惑，遭致马超大败。自己和孩子都被赵衢、梁宽杀害。"]],
        },
        characterTitle:{
            "xsanguo_nanhua":"技能设计:小苏",
            xsbaosanliang:"技能设计:Esperanto",
            xshuaxin:"技能设计:Esperanto",
            xstianyu:"技能设计:苍山暮色",
            xssunhuan:"技能设计:叫我景候大人",
            xsjianggan:"技能设计:一剑问夜",
            xsweizhu:"技能设计:苍山暮色",
            xsliuzhang:"技能设计:苍山暮色",
            xssunyi:"技能设计:苍山暮色",
            xshuojun:"技能设计:苍山暮色",
            xsgaolan:"技能设计:一剑问夜",
            xsdingyuan:"技能设计:苍山暮色",
            xsdengzhi:"技能设计:叫我景候大人",
            "xssp_yanwan":"技能设计:Esperanto",
        },
        translate:{
            xsbaosanliang:"鲍三娘",
            xshuaxin:"华歆",
            "xsanguo_nanhua":"南华老仙",
            xstianyu:"田豫",
            xssunhuan:"孙桓",
            xsjianggan:"蒋干",
            xsweizhu:"卫温&诸葛直",
            xsliuzhang:"刘璋",
            xssunyi:"孙翊",
            xshuojun:"霍峻",
            xsgaolan:"高览",
            xsdingyuan:"丁原",
            xsdengzhi:"邓芝",
            "xssp_yanwan":"杨婉",
        },
    },
    card:{
        card:{
        },
        translate:{
        },
        list:[],
    },
    skill:{
        skill:{
            xsjieyuan:{
                audio:"ext:虚实:true",
                filter:function (event,player){
        return event.player!=player;
    },
                logTarget:"player",
                frequent:true,
                priority:10,
                trigger:{
                    target:"useCardToBefore",
                },
                content:function (){
        "step 0"
        player.draw();
        "step 1"
        if(player.countCards('h')>1){
        player.discardPlayerCard('hej',player,true);
        }
    },
            },
            xsshuizhen:{
                trigger:{
                    player:"phaseBegin",
                },
                audio:"ext:虚实:true",
                unique:true,
                mark:true,
                skillAnimation:true,
                init:function (player){
        player.storage.xsshuizhen=false;
    },
                check:function (event,player){
        if(player.hasJudge('lebu')) return false;
        return true;
    },
                filter:function (event,player){
        if(player.storage.xsshuizhen) return false;
        if(player.hp!=1) return false;     
        return player.getCards('e').length>0;
    },
                content:function (){
        'step 0'
        var xs=player.getCards('e').length;
         var cards=[];
                    for(var i=0;i<xs;i++){
                        cards.push(game.createCard('sha'));
                    }
                    player.gain(cards,'gain2');
        'step 1'
        player.chooseToDiscard(5,'e',true);
        player.addTempSkill('xsshuizhen2');
        player.addTempSkill('zhuge_skill');
        player.awakenSkill('xsshuizhen');
        player.storage.xsshuizhen=true;      
    },
                ai:{
                    threaten:function (player,target){
            if(target.hp==1) return 3;
            return 1;
        },
                    effect:{
                        target:function (card,player,target){
                if(!target.hasFriend()) return;
                if(get.tag(card,'damage')==1&&target.hp==2&&target.countCards('he')&&
                !target.isTurnedOver()&&_status.currentPhase!=target){
                    if(get.distance(_status.currentPhase,target,'absolute')<=2) return [0.5,1];
                    return 0.8;
                }
            },
                    },
                },
                intro:{
                    content:"limited",
                },
            },
            "xsshuizhen2":{
                group:["xsshuizhen2_1","xsshuizhen2_2","xsshuizhen2_3"],
                subSkill:{
                    "1":{
                        trigger:{
                            player:"useCard",
                        },
                        audio:"ext:虚实:2",
                        forced:true,
                        filter:function (event){            
    return event.card&&event.card.name=='sha'&&get.suit(event.card)=='diamond'&&event.notLink();
    },
                        content:function (){
                    player.addTempSkill('unequip','shaAfter');
                },
                        sub:true,
                    },
                    "2":{
                        trigger:{
                            source:"damageBegin",
                        },
                        audio:"ext:虚实:2",
                        forced:true,
                        filter:function (event){
                if(event.nature=='fire')return false;
    return event.card&&event.card.name=='sha'&&get.suit(event.card)=='spade'&&event.notLink();
    },
                        content:function (){
                    trigger.nature='fire';
                },
                        sub:true,
                    },
                    "3":{
                        trigger:{
                            source:"damageBegin",
                        },
                        audio:"ext:虚实:2",
                        forced:true,
                        filter:function (event,player){
     return event.card&&event.card.name=='sha'&&get.suit(event.card)=='heart'&&event.notLink();
            },
                        content:function (){              
                trigger.num++;
            },
                        sub:true,
                    },
                },
                mod:{
                    targetInRange:function (card){
                        if(card.name=='sha'&&get.suit(card)=='diamond') return -Infinity;
                    },
                    selectTarget:function (card,player,range){
                        if(card.name=='sha'&&range[1]!=-1&&get.suit(card)=='club'){
                            range[1]++;
                        }
                    },
                },
                ai:{
                    threaten:1.4,
                },
            },
            "xsanguo_shoushu":{
                audio:["xingshuai",2],
                trigger:{
                    global:"dying",
                },
                priority:8,
                unique:true,
                skillAnimation:true,
                animationColor:"water",
                filter:function (event,player){
        return event.player.hp<=0&&event.player!=player;
    },
                check:function (event,player){
        return get.attitude(player,event.player)>0;
    },
                logTarget:"player",
                content:function (){
       'step 0'
            player.logSkill('xsanguo_shoushu',trigger.player);                       
                player.chooseControl('releiji','guidao').set('prompt','令'+get.translation(target)+'获得一项技能');
                goon=true;                    
        
        if(!goon){
            event.finish();
        }
        'step 1'
         trigger.player.addSkillLog(result.control);
         trigger.player.recover(2-trigger.player.hp);
         trigger.player.draw(2);       
         trigger.player.storage.xsanguo_shoushu2=player; 
         trigger.player.addSkill('xsanguo_shoushu2');              
         game.broadcastAll()+trigger.player.node.avatar.setBackgroundImage('image/character/zhangjiao.jpg');        
         player.removeSkill('xsanguo_shoushu');            
    },
            },
            "xsanguo_xiandao1":{
                audio:["huashen",2],
                forced:true,
                noLose:true,
                noGain:true,
                noDeprive:true,
                locked:true,
                noRemove:true,
                noDisable:true,
                trigger:{
                    global:"gameStart",
                    player:"phaseEnd",
                },
                filter:function (event,player){                
        return player.hp>0;
    },
                content:function (){       
        var n=[1,2].randomGet();
            if(n==1){
                player.addTempSkill("releiji",{player:"phaseUseBegin"}); 
                player.markSkill("releiji",{player:"phaseUseBegin"});                      
            };
            if(n==2){
                player.addTempSkill("guidao",{player:"phaseUseBegin"});   
                player.markSkill("guidao",{player:"phaseUseBegin"});                   
            };
    },
            },
            "xsanguo_xiandao2":{
                audio:"ext:虚实:2",
                forced:true,
                trigger:{
                    player:"damageBefore",
                },
                filter:function (event,player){   
        if(!event.nature) return false;
        return true;
    },
                content:function (){                                       
    trigger.cancel();
    event.finish();
    },
            },
            "xsanguo_xiandao":{
                forced:true,
                unique:true,
                noLose:true,
                noGain:true,
                noDeprive:true,
                locked:true,
                noRemove:true,
                noDisable:true,
                group:["xsanguo_xiandao1","xsanguo_xiandao2"],
            },
            "xsanguo_shoushu2":{
                audio:["songwei",2],
                mark:"character",
                intro:{
                    content:"当你造成或受到一次伤害后，$摸一张牌",
                },
                nopop:true,
                trigger:{
                    source:"damageEnd",
                    player:"damageEnd",
                },
                forced:true,
                popup:false,
                filter:function (event,player){
        return player.storage.xsanguo_shoushu2&&player.storage.xsanguo_shoushu2.isIn()&&event.num>0;
    },
                content:function (){
        'step 0'
        game.delayx();
        'step 1'
        var target=player.storage.xsanguo_shoushu2;      
        player.line(target,'green');
        target.draw();
        game.delay();
    },
                onremove:true,
                group:"xsanguo_shoushu3",
            },
            "xsanguo_shoushu3":{
                audio:"ext:虚实:2",
                trigger:{
                    player:"dieBegin",
                },
                silent:true,
                onremove:true,
                filter:function (event,player){
        return player.storage.xsanguo_shoushu2&&player.storage.xsanguo_shoushu2.isIn();
    },
                content:function (){   
         'step 0'
        game.delayx();
        'step 1'
        var target=player.storage.xsanguo_shoushu2;      
        player.line(target,'green');                     
        target.addSkill('xsanguo_shoushu');
          
    },
                forced:true,
                popup:false,
            },
            "xsanguo_xiuzheng":{
                audio:["luanwu",2],
                enable:"phaseUse",
                usable:1,
                priority:10,
                filter:function (event,player){
        return (ui.cardPile.childElementCount+ui.discardPile.childElementCount)>=2;
    },
                filterTarget:function (card,player,target){
        return player!=target;
    },
                content:function (){
        "step 0"
        event.cards=get.cards(2);
        player.showCards(event.cards);
        "step 1"      
        if(get.color(event.cards[0])=='red'&&get.color(event.cards[1])=='red'){               
           target.recover();
            }
        if(get.color(event.cards[0])!=get.color(event.cards[1])){   
           player.discardPlayerCard(target,"hej",true);
            }
        if(get.color(event.cards[0])=='black'&&get.color(event.cards[1])=='black'){               
           target.damage('thunder');
            }               
    },
                ai:{
                    threaten:0.5,
                    order:13,
                    result:{
                        target:function (player,target){
                return get.damageEffect(target,player);
            },
                    },
                },
            },
            xsqinglian:{
                trigger:{
                    global:"gameDrawAfter",
                },
                forced:true,
                unique:true,
                content:function (){
                    player.forcemin=true;
                    player.judgemin=true;
                    player.node.judges.hide();
                    player.node.equips.hide();
                },
                mod:{
                    targetEnabled:function (card,player,target){
                        if(get.type(card)=='delay'&&player!=target){
                            return false;
                        }
                    },
                },
            },
            xsshuzhan:{
                enable:"phaseUse",
                filterCard:function (card){
        return get.type(card)=='equip';
    },
                filter:function (event,player){
        return !player.hasSkill("xsshuzhan3")&&player.countCards('h',{type:'equip'})>0;
    },
                usable:1,
                selectCard:1,
                check:function (card){return 8-get.value(card)},
                discard:false,
                prepare:"give2",
                content:function (){
    "step 0"
    player.draw();
        target.gain(cards,player);
        var att=get.attitude(target,player);
        "step 1"
        target.chooseControl('选项一','选项二',function(){
            if(att<=0) return rand;
            else{
                if(target.isHealthy()) return '选项一';
                if(target.countCards('h')>2) return '选项一';
                if(target.countCards('h')<=2) return '选项二';                        
            }
        }).set('prompt',get.prompt('xsshuzhan')).set('choiceList',[
            '非锁定技失效，直到华歆的回合结束',
            '不能使用或打出卡牌，直到华歆的回合结束'
        ]);
        "step 2"
        if(result.control=='选项一'){
            target.addTempSkill("fengyin");
        }
        else{
            target.addTempSkill("xsshuzhan2");
        }
    },
                filterTarget:function (card,player,target){
        return target!=player;
    },
                ai:{
                    order:8,
                    result:{
                        target:function (player,target){
                if(ui.selected.targets.length==0){
                    return -3;
                }
                else{
                    return get.effect(target,{name:'juedou'},ui.selected.targets[0],target);
                }
            },
                    },
                    expose:0.4,
                    threaten:0.8,
                },
            },
            xsbigong:{
                trigger:{
                    player:"phaseBegin",
                },
                direct:true,
                filter:function (event,player){
                    return player.countCards('h')>0;
                },
                content:function (){
                    "step 0"
                    player.chooseTarget(get.prompt('xsbigong'),function(card,player,target){
                        return player!=target&&target.countCards('h')>0;
                    }).set('ai',function(target){
                        return -get.attitude(_status.event.player,target)/target.countCards('h');
                    });
                    "step 1"
                    if(result.bool){
                        player.logSkill('xsbigong',result.targets[0]);
                        event.target=result.targets[0];
                        player.chooseToCompare(event.target);
                    }
                    else{
                        event.finish();
                    }
                    "step 2"    
        if(result.bool){
            player.line(event.target,'green');
            event.target.recover();
            player.discardPlayerCard(event.target,'he',2,true);
        }
        else{
            player.addTempSkill('xsshuzhan3');
        }
    },
                ai:{
                    order:1,
                    result:{
                        target:function (player,target){
                if(get.attitude(player,target)>0){
                    return Math.sqrt(target.countCards('he'));
                }
                return 0;
            },
                        player:1,
                    },
                },
            },
            "xsshuzhan2":{
                mark:true,
                mod:{
                    cardEnabled:function (){
            return false;
        },
                    cardUsable:function (){
            return false;
        },
                    cardRespondable:function (){
            return false;
        },
                    cardSavable:function (){
            return false;
        },
                },
                intro:{
                    content:"不能使用或打出卡牌",
                },
            },
            "xsshuzhan3":{
            },
            xsjiansu:{
                audio:"ext:虚实:2",
                unique:true,
                trigger:{
                    player:"gainAfter",
                },
                direct:true,
                filter:function (event,player){
        if(event.parent.parent.name=='phaseDraw') return false;       
        return event.cards&&event.cards.length>0;
    },
                content:function (){
        "step 0"
        event.cards=player.countCards('h');
        "step 1"
        player.chooseCardTarget({
            filterCard:function(card){
                return true;
            },
            selectCard:1,
            filterTarget:function(card,player,target){
                return player!=target;
            },
            ai1:function(card){
                if(ui.selected.cards.length>0) return -1;
                if(card.name=='du') return 20;
                return (_status.event.player.countCards('h')-_status.event.player.hp);
            },            
            ai2:function(target){
                var att=get.attitude(_status.event.player,target);
                if(ui.selected.cards.length&&ui.selected.cards[0].name=='du'){
                    if(target.hasSkillTag('nodu')) return 0;
                    return 1-att;
                }
                if(target.countCards('h')>_status.event.player.countCards('h')) return 0;
                return att-4;
            },
            prompt:'请选择要送人的卡牌'
        });
        "step 2"
        if(result.bool){
            player.storage.xszhenghuan++;
            player.logSkill('xsjiansu',result.targets);
            result.targets[0].gain(result.cards,player);
            player.$give(result.cards.length,result.targets[0]);
        }
        else{
        event.finish();
        }
        "step 3"
     player.chooseTarget(get.prompt('xsjiansu'),function(card,player,target){
                        if(player==target) return false;
                        return player.canUse({name:'sha'},target,false);
                    }).set('check',check).set('ai',function(target){
                        if(!_status.event.check) return 0;
                        return get.effect(target,{name:'sha'},_status.event.player);
                    });
                    "step 4"
                    if(result.bool){
                     player.logSkill('xsjiansu',result.targets);
                     player.line(result.targets[0],'fire');
                        player.useCard({name:'sha'},result.targets[0],false);
                    }
    },
                ai:{
                    expose:0.3,
                },
            },
            xszhenghuan:{
                audio:"ext:虚实:2",
                mark:true,
                init:function (player){
        player.storage.xszhenghuan=0;
    },
                intro:{
                    content:"已给出#张牌",
                },
                trigger:{
                    player:"phaseBefore",
                },
                forced:true,
                filter:function (event,player){
        return !player.hasSkill('xsmoyi');
    },
                content:function (){
        if(player.storage.xszhenghuan<3){
        event.finish();
        }
        else{
        player.removeSkill("xszhenghuan");                
        player.addSkill("xszhenghuan1");
        }
        player.updateMarks();
    },
                ai:{
                    combo:"xsjiansu",
                },
            },
            "xszhenghuan1":{
                trigger:{
                    player:"phaseBegin",
                },
                forced:true,
                skillAnimation:true,
                animationColor:"thunder",
                filter:function (event,player){
        return !player.hasSkill('xsmoyi');
    },
                content:function (){  
        player.removeSkill("xszhenghuan1");       
        player.loseMaxHp();    
        player.addSkill("xsmoyi");
    },
            },
            xsmoyi:{
                trigger:{
                    source:"damageBegin",
                },
                audio:"ext:虚实:2",
                filter:function (event,player){
                return event.card&&event.card.name=='sha';
            },
                content:function (){   
                 "step 0"
                    player.chooseControl('加伤害','回血',function(event,player){
                     if(player.hp<2&&player.countCards('h')>0) return '回血';
                        if(player.countCards('h')<1||player.hp>2) return '加伤害';
                        return rand;
                    });
                    "step 1"
                    if(result.control=='加伤害'){
                        trigger.num++;
                    }
                    else{
                    if(player.countCards('h')>0){
                        player.chooseToDiscard('h',true);
                        player.recover();
                        }
                     else{
                     event.finish();
                     }
                    }           
            },
            },
            xsjiezhui:{
                trigger:{
                    player:"loseEnd",
                },
                audio:"ext:虚实:2",
                frequent:true,
                filter:function (event,player){
        if(player==_status.currentPhase) return false;
        for(var i=0;i<event.cards.length;i++){
            if(event.cards[i].original&&event.cards[i].original!='j') return true;
        }
        return false;
    },
                content:function (){
        "step 0"
        player.chooseTarget(get.prompt('xsjiezhui'),function(card,player,target){
            return player!=target&&get.distance(player,target)<=2;
        }).ai=function(target){
            return get.damageEffect(target,player,player);
        };
        "step 1"
        if(result.bool){
            player.logSkill('xsjiezhui',result.targets);  
            player.judge(function(card){
            if(get.color(card)=='black'){
            player.addTempSkill('xsjiezhui1','shaAfter');
            }
        });         
            player.useCard({name:'sha'},result.targets[0],false);           
        }        
      },
            },
            "xsjiezhui1":{
                trigger:{
                    player:"shaBegin",
                },
                filter:function (event,player){
                    return true;
                },
                forced:true,
                logTarget:"target",
                content:function (){
                        trigger.directHit=true;
                },
            },
            xsshouxi:{
            marktext:"袭",
             init:function (player){
                    player.storage.xsshouxi=[];
                },
                intro:{
                    content:"cards",
                },
            group:["xsshouxi1","xsshouxi2","xsshouxi3"],
            },
            "xsshouxi1":{
                trigger:{
                    player:"damageEnd",
                },
                direct:true,
                filter:function (event,player){
                return true;
                },
                notemp:true,              
                content:function (){
                  'step 0'
                  player.draw(trigger.num);
                  'step 1'
                    player.chooseCard(get.prompt('xsshouxi1'),'he',[1,trigger.num]).set('ai',function(card){
                        if(card.name=='du') return 20;
                        return 7-get.useful(card);
                    });
                  'step 2'
                    if(result.bool){
                        player.logSkill('xsshouxi');
                        player.lose(result.cards,ui.special);
                        player.$give(result.cards,player);            
                       for(var i=0;i<result.cards.length;i++){
                            player.storage.xsshouxi.push(result.cards[i]);
                        }        
                        player.markSkill('xsshouxi');            
                      }
                },                                
                ai:{
                    threaten:0.8,
                    maixie:true,
                    "maixie_hp":true,
                },
            },
            "xsshouxi2":{
            		trigger:{player:'respond'},
           			filter:function(event,player){
          				return event.card.name=='shan';
           			},
                direct:true,     
                notemp:true,
                content:function (){
                  'step 0'
                  player.draw();
                  'step 1'
                    player.chooseCard(get.prompt('xsshouxi2'),'he',1).set('ai',function(card){
                        if(card.name=='du') return 20;
                        return 7-get.useful(card);
                    });
                  'step 2'
                    if(result.bool){
                        player.logSkill('xsshouxi');
                        player.lose(result.cards,ui.special);
                        player.$give(result.cards,player);            
                       for(var i=0;i<result.cards.length;i++){
                            player.storage.xsshouxi.push(result.cards[i]);
                        }        
                        player.markSkill('xsshouxi');            
                     }
                },
                ai:{
                    threaten:0.8,
                },
            },
            "xsshouxi3":{
                trigger:{
                    global:"phaseEnd",
                },
                filter:function (event,player){
                    return player!=event.player&&player.storage.xsshouxi.length>0;
                },
                check:function (event,player){
                    return get.attitude(player,event.player)<0&&get.effect(event.player,{name:'sha'},player,player)>0;
                },
                logTarget:"player",
                content:function (){
                   'step 0'
                    var cards=get.cards(ui.cardPile.childElementCount+1);
                    for(var i=0;i<cards.length;i++){
                        ui.cardPile.insertBefore(cards[i],ui.cardPile.childNodes[get.rand(ui.cardPile.childElementCount)]);
                    }
                   'step 1'
                    var list=[];
                    for(var i=0;i<ui.cardPile.childElementCount;i++){
                        if(ui.cardPile.childNodes[i].name=='sha'){
                            list.push(ui.cardPile.childNodes[i]);
                            ui.cardPile.childNodes[i].remove();
                            i--;
                        }
                    }
                    event.list=list;
                    event.num=0;                
                    'step 2'
                    if(event.list.length&&event.num<player.storage.xsshouxi.length){
                        event.num++;
                        player.useCard(event.list.shift(),trigger.player);                        
                        event.redo();
                    }                        
                    'step 3'
                    player.$throw(player.storage.xsshouxi.slice(0),1000);
                    while(player.storage.xsshouxi.length){
                        player.storage.xsshouxi.shift().discard();
                    }
                    player.unmarkSkill('xsshouxi');
                },
                ai:{
                    threaten:1.5,
                },
            },
            xsxiongbing:{
                trigger:{
                    player:"phaseBegin",
                },
                direct:true,
                filter:function (event,player){
      if(player.storage.xsxiongbing.length>=3) return false;
      return player.countCards('he')>0;
                },
                notemp:true,
                intro:{
                    content:"cards",
                    onunmark:function (storage,player){
                        if(storage&&storage.length){
                            for(var i=0;i<storage.length;i++){
                                storage[i].discard();
                            }
                            player.$throw(storage);
                            player.storage.xsxiongbing.length=0;
                        }
                    },
                },
                init:function (player){
                    player.storage.xsxiongbing=[];
                },
                content:function (){
                    'step 0'
                    player.chooseCard(get.prompt('xsxiongbing'),'he',[1,3]).set('ai',function(card){
                        if(card.name=='du') return 20;
                        return 7-get.useful(card);
                    });
                    'step 1'
                    if(result.bool){
                        player.logSkill('xsxiongbing');
                        player.lose(result.cards,ui.special);
                        player.$give(result.cards,player);            
                       for(var i=0;i<result.cards.length;i++){
                            player.storage.xsxiongbing.push(result.cards[i]);
                        }        
                        player.markSkill('xsxiongbing');            
                     }
                },
                marktext:"兵",
                global:"xspanxi",
                ai:{
                    order:1,
                    result:{
                        player:1,
                    },
                    threaten:1,
                },
            },
            "xsxiongbing2":{
                group:["xiongbing1","xiongbing21","xiongbing22","xiongbing3"],
            },
            "xiongbing1":{
                inherit:"mashu",
                filter:function (event,player){
                    if(!lib.skill.mashu.filter(event,player)) return false;                   
                    return player.storage.xsxiongbing;
                },
                mod:{
                    globalFrom:function (from,to,distance){
                        return distance-1;
                    },
                },
            },
            "xiongbing21":{
                inherit:"wushuang1",
                filter:function (event,player){
                    if(!lib.skill.wushuang1.filter(event,player)) return false;
                    if(player.storage.xsxiongbing.length<2) return false;
                    return player.storage.xsxiongbing;
                },
                audio:"wushuang",
                trigger:{
                    player:"shaBegin",
                },
                forced:true,
                priority:-1,
                content:function (){
                    if(typeof trigger.shanRequired=='number'){
                        trigger.shanRequired++;
                    }
                    else{
                        trigger.shanRequired=2;
                    }
                },
                audioname:["re_lvbu"],
            },
            "xiongbing22":{
                inherit:"wushuang1",
                filter:function (event,player){
                    if(!lib.skill.wushuang2.filter(event,player)) return false;
                    if(player.storage.xsxiongbing.length<2) return false;
                    return player.storage.xsxiongbing;
                },
                audio:"wushuang",
                trigger:{
                    player:"shaBegin",
                },
                forced:true,
                priority:-1,
                content:function (){
                    if(typeof trigger.shanRequired=='number'){
                        trigger.shanRequired++;
                    }
                    else{
                        trigger.shanRequired=2;
                    }
                },
                audioname:["re_lvbu"],
            },
            "xiongbing3":{
                trigger:{
                    source:"damageBegin",
                },
                forced:true,
                filter:function (event,player){
          return event.notLink()&&event.card&&event.card.name=='sha'&&player.storage.xsxiongbing.length==3;
          },
                content:function (){
            trigger.num++;
     },
            },
            xspanxi:{
                enable:"phaseUse",
                audio:"ext:虚实:2",
                range:{
                    global:1,
                },
                forceaudio:true,
                filter:function (event,player){
                    var players=game.filterPlayer();
                    for(var i=0;i<players.length;i++){
                        if(players[i].storage.xsxiongbing){
                            return players[i].storage.xsxiongbing.length>0&&player.canUse('sha',players[i],true,true);
                        }
                    }
                    return get.distance(player,player[i])<=1;
                },
                direct:true,
                delay:0,
                content:function (){
                    "step 0"
                    var targets=game.filterPlayer(function(current){
                        if(current.storage.xsxiongbing){
                            return current.storage.xsxiongbing.length>0&&player.canUse('sha',current,true,true);
                        }
                        return false;
                    });
                    if(targets.length==1){
                        event.target=targets[0];
                        event.goto(2);
                    }
                    else if(targets.length>0){
                        player.chooseTarget(true,'选择【叛袭】的目标',function(card,player,target){
                            return _status.event.list.contains(target);
                        }).set('list',targets).set('ai',function(target){
                            var player=_status.event.player;
                            return get.effect(target,{name:'sha'},player,player);
                        });
                    }
                    else{
                        event.finish();
                    }
                    "step 1"
                    if(result.bool&&result.targets.length){
                        event.target=result.targets[0];
                    }
                    else{
                        event.finish();
                    }
                    "step 2"
                    if(event.target){
                        if(event.target.storage.xsxiongbing.length==1){
                            event.directresult=event.target.storage.xsxiongbing.slice(0);
                        }
                        else{
                            player.chooseCardButton('移去一张“兵”',1,event.target.storage.xsxiongbing,true);
                        }
                    }
                    else{
                        event.finish();
                    }
                    "step 3"
                    if(event.directresult||result.bool){
                        player.logSkill('xspanxi');
                        var links=event.directresult||result.links;
                        for(var i=0;i<links.length;i++){
                            event.target.storage.xsxiongbing.remove(links[i]);
                        }
                        event.target.syncStorage('xsxiongbing');
                        if(!event.target.storage.xsxiongbing.length){
                            event.target.unmarkSkill('xsxiongbing');
                        }
                        else{
                            event.target.markSkill('xsxiongbing');
                        }
                        event.target.$throw(links);
                        game.log(event.target,'被移去了',links);
                        for(var i=0;i<links.length;i++){
                            links[i].discard();
                        }                    
event.target.addTempSkill('panxi','shaAfter');
player.useCard({name:'sha'},event.target);
                    }
                },
                ai:{
                    order:function (){
                        return get.order({name:'sha'})+0.05;
                    },
                    result:{
                        player:function (player){
                            var target=game.findPlayer(function(current){
                                return current.storage.xsxiongbing;
                            });
                            if(target){
                                return get.effect(target,{name:'sha'},player,player);
                            }
                        },
                    },
                },
            },
            panxi:{
                audio:"ext:虚实:2",
                mark:true,
                intro:{
                    content:"叛袭：打出两张闪",
                },
                trigger:{
                    target:"shaBegin",
                },
                forced:true,
                filter:function (event,player){
                    if(event.directHit) return false;
                    return player.hasSkill("xsxiongbing");
                },
                check:function (event,player){
                    return player==event.player;
                },
                priority:-1,
                content:function (){
                    if(typeof trigger.shanRequired=='number'){
                        trigger.shanRequired++;
                    }
                    else{
                        trigger.shanRequired=2;
                    }
                },
            },
            "xspanxi2":{
            },
            xsquanyu:{
                audio:"ext:虚实:2",
                enable:"phaseUse",
                usable:1,
                filterTarget:function (card,player,target){
                    return player!=target&&target.countCards('h')>0;
                },
                filter:function (event,player){
                    return player.countCards('h')>0;
                },
                content:function (){
                    "step 0"
                    player.chooseToCompare(target);
                    "step 1"
                    if(result.bool){
                       if(target.countCards('h')){
                            target.showHandcards();
                        }
                    }
                    else{
                    if(player.countCards('h')){
                            player.showHandcards();
                            player.chooseToDiscard('h',true);
                        }
                    }
                },
                ai:{
                    order:function (name,player){
                        var cards=player.getCards('h');
                        if(player.countCards('h')==1){
                            return 1;
                        }
                        for(var i=0;i<cards.length;i++){
                            if(cards[i].name!='sha'&&cards[i].number>11&&get.value(cards[i])<7){
                                return 9;
                            }
                        }
                        return -1;
                    },
                    result:{
                        player:function (player){
                            if(player.countCards('h')>1) return 0.6;
                            var num=player.countCards('h');
                            if(num>player.hp) return 0;
                            if(num==1) return -2;
                            if(num==2) return -1;
                            return -0.7;
                        },
                        target:function (player,target){
                            var num=target.countCards('h');
                            if(num==1) return -1;
                            if(num==2) return -0.7;
                            return -0.5
                        },
                    },
                    threaten:1.3,
                },
            },
            xsdaoshu:{
                enable:"phaseUse",
                usable:1,
                filterTarget:function (card,player,target){
                    return target!=player&&target.countCards('h');
                },
                filter:function (event,player){
                    return player.countCards('h');
                },
                content:function (){
                    'step 0'                
event.prompt2='你与目标角色各展示一张手牌，你获得其所展示的牌，若花色不同，你在获得此牌时，须弃置一张牌;若花色相同，你可以重复此流程直到花色不同';
    player.chooseCard('h',true).set('prompt2',event.prompt2);
                    'step 1'
                    if(result.bool){
                        event.card1=result.cards[0];
                        target.chooseCard('h',true);
                    }
                    else{
                        event.finish();
                    }
                    'step 2'
                    if(result.bool){
                        event.card2=result.cards[0];
                    }
                    else{
                        event.finish();
                    }
                    'step 3'
                    player.$compare(event.card1,event.target,event.card2);
                    game.delay(0,1500);
                    game.log(player,'亮出的牌为',event.card1);
                    game.log(target,'亮出的牌为',event.card2);
                    'step 4'
                    var suit1=get.suit(event.card1);
                    var suit2=get.suit(event.card2);
                    if(suit1==suit2){
         player.gain(event.card1,'gain2');
                         player.gain(event.card2,'gain2');
         player.chooseBool('是否再次发动【盗书】？');
                    }
                    else{
           player.gain(event.card1,'gain2');
           player.gain(event.card2,'gain2');
        player.chooseToDiscard('h',true);
        event.finish();
                    }
        'step5'
      if(result.bool){
                        event.goto(0);
                    }
      else{
      event.finish();
      }
                },
                ai:{
                    order:4,
                    result:{
                        target:function (player,target){
                            if(target.isHealthy()){
                                return -1/(1+target.hp);
                            }
                            else{
                                return -0.3/(1+target.hp);
                            }
                        },
                    },
                },
            },
            xsyanbian:{
                group:["xsyanbian1","xsyanbian2"],
            },
            "xsyanbian1":{
                audio:"ext:虚实:2",
                trigger:{
                    player:"phaseDrawBefore",
                },
                filter:function (event,player){
                    return true;
                },
                direct:true,
                content:function (){
       "step 0"
                    player.chooseTarget(get.prompt('xsyanbian1'),function(card,player,target){
                        if(player==target) return false;
                        return target.countCards('he');
                    }).set('ai',function(target){
                        return -get.attitude(_status.event.player,target);
                    });
                    "step 1"
                    if(result.bool){
        trigger.cancel();
                    player.logSkill('xsyanbian1',result.targets);
                    event.targets=result.targets
                            player.discardPlayerCard(event.targets[0],'he',[1,2],true);
                    }
                    else{
                        event.finish();
                    }
},
                ai:{
                    expose:0.2,
                },
            },
            "xsyanbian2":{
                audio:"ext:虚实:2",
                trigger:{
                    player:"phaseUseBefore",
                },
                filter:function (event,player){
                    return true;
                },
                direct:true,
                content:function (){
"step 0"
                    player.chooseTarget(get.prompt('xsyanbian2'),function(card,player,target){
                        return player!=target;
                    }).set('ai',function(target){
            var att=get.attitude(_status.event.player,target);
            if(att>0) return att+1;
            if(att==0) return Math.random();
            return att;
        });
                    "step 1"
                    if(result.bool){
        trigger.cancel();
                        player.logSkill('xsyanbian2',result.targets);
                        event.targets=result.targets
                        if(player.countCards('h')==0){
                            event.targets[0].draw(2);
                        }
                        else{
                            player.chooseControl('选项一','选项二',function(){
                if(event.targets[0].isHealthy()) return rand;
                if(event.targets[0].countCards('h')>2) return '选项二';
                if(event.targets[0].countCards('h')<=2) return '选项一';                        
        }).set('prompt',get.prompt('xsyanbian2')).set('choiceList',[
            '令该角色摸两张牌',
            '弃置一张牌，令该角色进行一个额外的出牌阶段'
        ]);        
            }            
   }
    else{
                        event.finish();
                    }
     "step 2"
        if(result.control=='选项一'){
            event.targets[0].draw(2);
        }
        else{
         player.addSkill('fangquan2');
                        player.storage.fangquan=event.targets[0];
        }
},
                ai:{
                    expose:0.2,
                },
            },
            xsdingmeng:{
                audio:"ext:虚实:2",
                trigger:{
                    player:"phaseBegin",
                },
                direct:true,
                filter:function (event,player){
                    return player.countCards('h')>0;
                },
                content:function (){
                    "step 0"
                    player.chooseTarget(get.prompt('xsdingmeng'),function(card,player,target){
                        return player!=target&&target.countCards('h')>0;
                    }).set('ai',function(target){
                        return -get.attitude(_status.event.player,target)/target.countCards('h');
                    });
                    "step 1"
                    if(result.bool){
                        player.logSkill('xsdingmeng',result.targets[0]);
                        event.target=result.targets[0];
                        player.chooseToCompare(event.target);
                    }
                    else{
                        event.finish();
                    }
                    "step 2"
                    if(result.bool){
                       if(event.target.countCards('h')){
           var cards=event.target.getCards('h',{type:'trick'});
                              event.target.showHandcards();
           player.gain(cards,event.target);
                        }
                    }
                    else{
                    if(player.countCards('h')){
                            player.showHandcards();
                            player.discard(player.getCards('h',{type:'basic'}));
                        }
                    }
                },
                ai:{
                    order:1,
                    result:{
                        target:function (player,target){
                if(get.attitude(player,target)>0){
                    return Math.sqrt(target.countCards('he'));
                }
                return 0;
            },
                        player:1,
                    },
                },
            },
            xscefeng:{
                trigger:{
                    player:"phaseBegin",
                },
                frequent:true,
                filter:function (event,player){
        return (ui.cardPile.childElementCount+ui.discardPile.childElementCount)>=1;
    },
                content:function (){
        "step 0"
        event.card=get.cards(1);
        player.showCards(event.card);
        "step 1"      
        if(get.color(event.card)=='red'){               
           player.addTempSkill("xscefeng1",{player:"phaseBegin"});
            }
        if(get.color(event.card)=='black'){               
           player.addTempSkill("xscefeng2");
            }               
    },
                ai:{
                    threaten:0.5,
                },
            },
            "xscefeng1":{
                mark:true,
                intro:{
                    content:"当你使用或成为杀的目标时，摸一张牌",
                },
                group:["xscefeng11","xscefeng12"],
            },
            "xscefeng11":{
                trigger:{
                    player:"shaBegin",
                },
                forced:true,
                content:function (){
                player.logSkill("xscefeng1");
                player.draw();
               },
            },
            "xscefeng12":{
                trigger:{
                    target:"shaBefore",
                },
                forced:true,
                content:function (){
                player.logSkill("xscefeng1");
                player.draw();
                },
            },
            "xscefeng2":{
                enable:"phaseUse",
                usable:1,
                priority:10,
                filter:function (event,player){
                return player.countCards('he');
               },
                content:function (){
                var cf=Math.max(1,player.maxHp-player.hp);
               "step 0"
               player.chooseToDiscard(cf,'he','请弃置一张牌').set('ai',function(card){
                            return 6-get.value(card);
                          });
               "step 1"
               player.chooseTarget([1,cf],get.prompt('xscefeng2'),function(card,player,target){
                        if(player==target) return false;
                        return target.countCards('he');
                    }).set('ai',function(target){
                        return -get.attitude(_status.event.player,target);
                    });
                    "step 2"
                    if(result.bool){
                        player.logSkill('xscefeng2',result.targets);     
                        event.targets=result.targets                               
                            if(result.targets.length==1){
                            player.discardPlayerCard(event.targets[0],'he',true);
                        }
                        else{
                            player.discardPlayerCard(event.targets[0],'he',true);
                        }
                    }
                    else{
                        event.finish();
                    }
                    "step 3"
                    if(targets.length>1){
                    for(var i=1;i<targets.length;i++){
                        player.discardPlayerCard(targets[i],'he',true);
                    }
                        if(result.links.length) targets[i].discard(result.links[0]);
              }
           },
                	ai:{
					order:8,
					result:{
						player:1
					}
				}
            },
            xszhuolie:{
                trigger:{
                    player:"damageBegin",
                },
                filter:function (event,player){
                    return event.card&&(event.card.name=='sha'||event.card.name=='juedou');
                },
                forced:true,
                content:function (){
                    "step 0"
                    if(!player.getEquip(1)){
                    trigger.num++;
                    }
                   "step 1"
                   player.moveCard();
                   event.finish();
                },
                ai:{
                    expose:0.1,
                },
            },
            xszhenjue:{
                trigger:{
                    global:"discardAfter",
                },
                filter:function (event,player){
                    if(_status.currentPhase!=player) return false;
                    var evt=event.getParent('phaseUse');
                    if(evt&&evt.name=='phaseUse') return true;
                    return false;
                },
                forced:true,
                direct:true,
                content:function (){
                player.logSkill("xszhenjue");
                player.draw();
               },
                group:"xszhenjue_dis",
                subSkill:{
                    dis:{
                        trigger:{
                            player:"gainAfter",
                        },
                        filter:function (event,player){
if(player.countCards('h')==0)return false;
if(_status.currentPhase==player) return false;
var evt=event.getParent('phaseUse');
if(evt&&evt.name=='phaseUse') return true;
return false;
},
                        forced:true,
                        direct:true,
                        content:function (){
player.logSkill("xszhenjue");
player.chooseToDiscard('he',true);
},
                        sub:true,
                    },
                },
            },
            xsmengxian:{
                trigger:{
                    global:"shaBefore",
                },
                unique:true,
                filter:function (event,player,target){
        if(event.player.sex!="male")return false;
        if(event.target==player)return false;
        return (ui.cardPile.childElementCount+ui.discardPile.childElementCount)>=1;
     },
                check:function (event,player){
                    return get.attitude(player,event.player)>0;
                },
                logTarget:"player",
                content:function (){
        "step 0"                
        event.cards=get.cards(1);
        player.showCards(event.cards);    
        "step 1"      
        if(get.color(event.cards)=='black'){               
           trigger.player.gain(event.cards,'gain2');       
           event.goto(0);
          }      
        else{
                                var list=event.cards.slice(0);
                         while(list.length){
                            ui.cardPile.insertBefore(list.pop(),ui.cardPile.firstChild);                            
                           }
                        }
    },
                ai:{
                    expose:0.2,
                    threaten:1.5,
                },
            },
            xsyuandu:{
                mod:{
                    globalFrom:function (from,to){
                        if(from.isHealthy()) return -Infinity;
          if(from.isDamaged()) return -(from.maxHp-from.hp);
                    },
                },
            },
            xsshoutu:{
                mod:{
                    globalTo:function (from,to,distance){
                        if(!to.getEquip(3)||!to.getEquip(4)) return distance+1;
                    },
                },
                trigger:{
                    player:"damageBegin",
                },
                forced:true,
                filter:function (event,player){
                    if(event.source&&event.nature)return false;
                    return !player.hasSkill("xsyinghuan1");
                },
                content:function (){
                    var num=Math.max(1,get.distance(trigger.source,player));
                    "step 0"
                    if(get.distance(trigger.source,player)<=0){
                    event.finish();
                    }  
                    else{                  
                    trigger.source.chooseToDiscard('弃置'+get.distance(trigger.source,player)+'张牌，否则此伤害对'+get.translation(player)+'无效','he',num).set('ai',function(card){
                            if(_status.event.goon) return 7-get.value(card);
                            return 0;
                        }).set('goon',get.attitude(trigger.source,player)<0);
                    }
                    "step 1"
                    if(!result.bool){
                        trigger.cancel();
                    }
                },
                ai:{
                    effect:{
                        target:function (card,player,target,current){
                            if(get.attitude(player,target)<0){
                                if(_status.event.name=='xsshoutu') return;
                                var bs=player.getCards('h');
                                if(bs.length<2) return 0;
                                if(player.hasSkill('jiu')||player.hasSkill('tianxianjiu')) return;
                                if(bs.length<=3&&player.countCards('h')<=1){
                                    for(var i=0;i<bs.length;i++){
                                        if(bs[i].name!='sha'&&get.value(bs[i])<7){
                                            return [1,0,1,-0.5];
                                        }
                                    }
                                    return 0;
                                }
                                return [1,0,1,-0.5];
                            }
                        },
                    },
                },
            },
            xsyinghuan:{
                unique:true,
                mark:true,
                marktext:"患",
                init:function (player){
        player.storage.xsyinghuan=2;
      },
                intro:{
                    content:"还可以发动【隐患】#次",
                },
                trigger:{
                    player:"phaseEnd",
                },
                forced:true,
                content:function (){
        player.storage.xsyinghuan=2;
        player.updateMarks();
        },
                group:"xsyinghuan_mark",
                subSkill:{
                    mark:{
                        trigger:{
                            global:"phaseUseBegin",
                        },
                        unique:true,
                        filter:function (event,player){
        if(event.player==player)return false;
        return player.storage.xsyinghuan>0;
     },
                        check:function (event,player){
                    return get.attitude(player,event.player)<=0;
                },
                        logTarget:"player",
                        content:function (){
      "step 0"
      player.discardPlayerCard(trigger.player,'he',2,true);
      trigger.player.addTempSkill('yhrange');
      trigger.player.storage.yinghuan=player;
      "step 1"
      player.addTempSkill("xsyinghuan1");
      player.storage.xsyinghuan--;
      player.updateMarks();
    },
                        sub:true,
                    },
                },
            },
            "xsyinghuan1":{
            },
            yhrange:{
                mod:{
                    targetInRange:function (card,player,target){
                        if(card.name=='sha'&&target==player.storage.yinghuan){
                            return true;
                        }
                    },
                },
            },
            xstoucheng:{
                trigger:{
                    global:"phaseBegin",
                },
                zhuSkill:true,
                unique:true,
                animationColor:"metal",
                skillAnimation:true,
                filter:function (event,player){
                    if(event.player==player) return false;
                    if(!player.hasZhuSkill('xstoucheng')) return false;
                    if(player.countCards('h')<=0)return false;
                    if(player.storage.toucheng)return false;
                    return (event.player.group=='qun'||event.player.group=='shu');
                },
               init:function(player){
	            				player.storage.toucheng=false;
             				},
	             check:function(event,player){
	                if(player.hasJudge('lebu')) return false;
                return get.attitude(player,event.player)>0;
                },
                logTarget:"player",
                content:function (){
                "step 0"
              player.storage.toucheng=true;                         
              player.gainMaxHp();
              player.recover();
              "step 1"
              var cards1=player.getCards('h');
              trigger.player.gain(cards1,player);
              trigger.player.addSkill("xstoucheng1");  
            },
             ai:{
                    order:function (skill,player){
                        if(player.hp<player.maxHp&&player.countCards('h')>2){
                            return 10;
                        }
                        return 1;
                    },
                    result:{
                        target:function (player,target){
                            if(ui.selected.cards.length&&ui.selected.cards[0].name=='du'){
                                if(target.hasSkillTag('nodu')) return 0;
                                return -10;
                            }
                            if(target.hasJudge('lebu')) return 0;
                            var nh=target.countCards('h');
                            var np=player.countCards('h');
                            if(player.hp==player.maxHp||player.countCards('h')<=1){
                                if(nh>=np-1&&np<=player.hp&&!target.hasSkill('haoshi')) return 0;
                            }
                            return Math.max(1,5-nh);
                        },
                    },
                    effect:{
                        target:function (card,player,target){
                            if(player==target&&get.type(card)=='equip'){
                                if(player.countCards('e',{subtype:get.subtype(card)})){
                                    var players=game.filterPlayer();
                                    for(var i=0;i<players.length;i++){
                                        if(players[i]!=player&&get.attitude(player,players[i])>0){
                                            return 0;
                                        }
                                    }
                                }
                            }
                        },
                    },
                    threaten:0.8,
                },   
            },
            "xstoucheng1":{
               unique:true,
                mark:true,
                marktext:"诚",
                intro:{
                    content:"下个回合开始时，将所有牌交给刘璋",
                },
                trigger:{
                    global:"phaseBegin",
                },
                forced:true,
                filter:function (event,player){
if(event.player.name!='xsliuzhang')return false;
return player.countCards('he');
},
                content:function (){
                "step 0"
            var cards2=player.getCards('he');
            trigger.player.gain(cards2,player);
                "step 1"
            player.removeSkill("xstoucheng1");
       },
            },
    xsxiying:{ 
            enable:'phaseUse',
	            filter:function(event,player){
	                return player.countCards('h');
	            },
	            filterTarget:function(card,player,target){
	                return target!=player&&get.distance(player,target,'attack')<=1;
	            },
	           	filterCard:true,
	           	check:function(card){
	             			return 9-get.value(card)
         				},
	            unique:true,
	            usable:1,
	            selectTarget:-1,
	            line:'fire',
	            content:function(){          
	            var xy=Math.max(1,player.maxHp-player.hp);
	                "step 0"
	                target.chooseToDiscard(xy,'he','弃置一张牌，否则本回合无法使用或打出手牌').ai=function(card){
	                    if(target.countCards('he')==0) return 0;
	                    if(target.hp==target.maxHp) return 0;
	                    if(target.hp>2) return 8-get.value(card);
	                    if(target.hp>1) return 10-get.value(card);
	                    return 10-get.value(card);
	                };
	                "step 1"
	                if(!result.bool){
	                    target.addTempSkill("xsxiying1");
	                }	
	            },
            ai:{
					order:13,
					result:{
						target:function(player,target){
							if(ui.selected.targets.length==0){
								return -3;
							}
							else{
								return get.effect(target,{name:'juedou'},ui.selected.targets[0],target);
							}
						}
					},
					expose:0.4,
					threaten:3,
				}
         },       
           xsxiying1:{
            mark:true,
                mod:{
                    cardEnabled:function (){
            return false;
        },
                    cardUsable:function (){
            return false;
        },
                    cardRespondable:function (){
            return false;
        },
                    cardSavable:function (){
            return false;
        },
                },
                intro:{
                    content:"不能使用或打出卡牌",
                },
           },
  xsxunyi:{
enable:'phaseUse',
usable:1,
unique:true,
filter:function(event,player){
return true;
},
 content:function(){
 'step 0'
 event.toRespond=game.filterPlayer(function(current){
 return current!=player&&get.distance(player,current)<=1&&current.countCards('h');
 });
 event.cards=[];
 'step 1'
 if(event.toRespond.length){
 var current=event.toRespond.shift();
 event.current=current;
 current.chooseCard('h',true);
 } 
 else{
 event.goto(3);
 }
 'step 2'
 if(result.cards){
 var card=result.cards[0];
 event.current.showCards(card);
 event.cards.push(card);;
 }
 event.goto(1);
 'step 3'
 game.log(event.cards);
 var list=new Object();
 for(var i=0;i<event.cards.length;i++){
 var t=get.type(event.cards[i]);
 if(list[t]==undefined) list[t]=1;
 else list[t]++;
 }
 var max=0,maxType='';
 for(t in list){
 if(list[t]>max) {
 max=list[t];
 maxType=t;
 }
 }
 event.num=0;
 for(var i=0;i<event.cards.length;i++){
 var card=event.cards[i];
 if(get.type(card)==maxType) {
 player.gain(card,'gain2');
 event.num++;
 }
 }
 'step 4'
 if(event.num>=2) player.loseHp();
 },
ai:{
      order:10,
      result:{
      player:function (player,current){
           return 1;    
           },
        },
          threaten:1,
     },
},
        },
        translate:{
            xsjieyuan:"结缘",
            "xsjieyuan_info":"<b>锁定技</b>，每当你成为其他角色卡牌的目标时，你摸一张牌，若你的手牌数大于1，你弃置区域内的一张牌。",
            xsshuizhen:"随征",
            "xsshuizhen_info":"<b>限定技</b>，准备阶段，若你的体力值为1且装备区内有牌，你可以获得X张杀并弃置装备区内的所有牌，若如此做，本回合你使用[杀]不计入出牌阶段使用限制并可以按以下规则使用:♦️ : 此杀无视距离和防具; ♣️:此杀可额外指定一名角色为目标;♥️:此杀造成的伤害+1:♠️:此杀造成的伤害为火焰伤害。(X为你装备区内牌的数量)",
            "xsshuizhen2":"随征",
            "xsshuizhen2_info":"",
            "xsanguo_shoushu":"授书",
            "xsanguo_shoushu_info":"<b>限定技</b>，当一名其他角色进入濒死状态时，你可以令其获得技能【雷击】或【鬼道】，若如此做，其回复体力至2并摸两张牌。</br><b>授书</b>：当该角色造成或受到一次伤害后，你摸一张牌;若该角色阵亡，重置你的技能。",
            "xsanguo_xiandao1":"仙道",
            "xsanguo_xiandao1_info":"游戏开始或回合结束阶段，你随机获得技能【雷击】或【鬼道】，直到你的下个出牌阶段。",
            "xsanguo_xiandao2":"仙道",
            "xsanguo_xiandao2_info":"<b>锁定技</b>，防止你受到属性伤害。",
            "xsanguo_xiandao":"仙道",
            "xsanguo_xiandao_info":"<b>锁定技</b>,防止你受到的属性伤害。游戏开始时，你随机获得技能【雷击】或【鬼道】，直到你的下个出牌阶段。回合结束阶段(你的第一个回合除外)，你发动一次【仙道】。",
            "xsanguo_shoushu2":"授书",
            "xsanguo_shoushu2_info":"<b>锁定技</b>，当你造成或受到一次伤害后，南华老仙摸一张牌。",
            "xsanguo_shoushu3":"授书",
            "xsanguo_shoushu3_info":"<b>锁定技</b>，当你【授书】的角色阵亡后，重置你的技能。",
            "xsanguo_xiuzheng":"修真",
            "xsanguo_xiuzheng_info":"出牌阶段限一次，你可以选择一名其他角色并亮出牌堆顶的两张牌。若同为红色，其回复一点体力；若同为黑色，其受到一点雷电伤害；若颜色不同，你弃置其区域内的一张牌。",
            xsqinglian:"清廉",
            "xsqinglian_info":"<b>锁定技</b>，你没有装备区;你不能成为延时锦囊的目标。",
            xsshuzhan:"疏战",
            "xsshuzhan_info":"出牌阶段限一次，你可以将一张装备牌交给一名其他角色，令其选择一项直到你的回合结束:</br>①非锁定技失效;</br>②不能使用或打出卡牌。</br>若如此做，你摸一张牌。",
            xsbigong:"逼宫",
            "xsbigong_info":"准备阶段，你可以与一名角色拼点。若你赢，你令该角色回复一点体力并弃置其两张牌;若你没赢，你失去技能【疏战】直到回合结束。",
            "xsshuzhan2":"疏战",
            "xsshuzhan2_info":"",
            "xsshuzhan3":"疏战",
            "xsshuzhan3_info":"",
            xsjiansu:"俭素",
            "xsjiansu_info":"每当你于摸牌阶段外获得牌时，你可以将一张手牌交给一名其他角色。若如此做，视为对你选择的一名角色使用一张无视距离的杀。",
            xszhenghuan:"征桓",
            "xszhenghuan_info":"<b>觉醒技</b>,回合开始阶段，若你发动【俭素】给出的牌不少于3张，你须减一点体力上限并获得技能【抹夷】。",
            "xszhenghuan1":"征桓",
            "xszhenghuan1_info":"",
            xsmoyi:"抹夷",
            "xsmoyi_info":"当你使用杀对一名角色造成伤害时，你可以选择一项:</br>①此伤害+1;</br>②弃置一张手牌并回复一点体力。",
            xsjiezhui:"截追",
            "xsjiezhui_info":"每当你于回合外失去一张牌时，可以视为对你距离2以内的一名角色使用一张杀。当你以此法使用一张杀前，你须进行一次判定，若判定结果为黑色，此杀不能被闪避。",
            xsshouxi:"守袭",
            "xsshouxi_info":"每当你打出一张闪或受到一点伤害后，你可以摸一张牌并将一张牌置于你的武将牌上，称为“袭”。其他角色的回合结束阶段，你可以弃置武将牌上的所有“袭”视为对该角色使用等量的杀。",
            "xsshouxi1":"守袭",
            "xsshouxi1_info":"",
            "xsshouxi2":"守袭",
            "xsshouxi2_info":"",
            "xsshouxi3":"守袭",
            "xsshouxi3_info":"",
            xsxiongbing:"雄兵",
            "xsxiongbing_info":"准备阶段，你可以将至多3张牌置于你的武将牌上，称为“兵”。若“兵”的数量为:</br>一张，视为你拥有【马术】;</br>两张，视为你拥有【无双】;</br>三张，当你使用杀对一名角色造成伤害时，该伤害+1。",
            "xsxiongbing2":"雄兵",
            "xsxiongbing2_info":"",
            "xiongbing1":"雄兵",
            "xiongbing21":"雄兵",
            "xiongbing22":"雄兵",
            "xiongbing3":"雄兵",
            xspanxi:"叛袭",
            "xspanxi_info":"",
            panxi:"叛袭",
            "xspanxi2":"叛袭",
            "xspanxi2_info":"<b>锁定技</b>,每当一名角色需要对你使用杀时，其可以移去一张“兵”，视为对你使用一张杀。若其如此做，你须连续使用两张闪才能抵消。",
            xsquanyu:"劝瑜",
            "xsquanyu_info":"出牌阶段限一次，你可以与一名角色拼点。若你赢，你观看其手牌;若你没赢，你须展示手牌并弃置一张牌。",
            xsdaoshu:"盗书",
            "xsdaoshu_info":"出牌阶段限一次，你可以选择一名其他角色，你与其各展示一张手牌，你获得其所展示的牌。若花色不同，你在获得此牌时，须弃置一张牌;若花色相同，你可以重复此流程直到花色不同。",
            xsyanbian:"严辩",
            "xsyanbian_info":"你可以跳过摸牌阶段，改为弃置一名其他角色两张牌;你可以跳过出牌阶段并选择一项:</br>①令你选择的一名角色摸两张牌;</br>②弃置一张牌，令你选择的一名角色进行一个额外的出牌阶段。",
            "xsyanbian1":"严辩",
            "xsyanbian1_info":"弃置一名角色两张牌",
            "xsyanbian2":"严辩",
            "xsyanbian2_info":"令你选择的一名角色摸两张牌或弃置一张牌，令该角色进行一个额外的出牌阶段",
            xsdingmeng:"定盟",
            "xsdingmeng_info":"准备阶段，你可以与一名角色拼点。若你赢，你观看其手牌并获得其中的锦囊牌;若你没赢，你展示手牌并弃置其中的基本牌。",
            xscefeng:"策风",
            "xscefeng_info":"准备阶段，你可以亮出牌堆顶的一张牌。若此牌为红色:当你使用或成为杀的目标时，你摸一张牌，直到你的下个回合开始阶段;若此牌为黑色:出牌阶段限一次，你可以弃置X张牌并选择X名其他角色，弃置这些角色各一张牌，若如此做，你摸一张牌。(X为你已损失的体力值且至少为1)",
            "xscefeng1":"策风",
            "xscefeng2":"策风",
            "xscefeng2_info":"出牌阶段限一次，你可以弃置X张牌(不足则全弃)并选择X名其他角色，弃置这些角色各一张牌，若如此做，你摸一张牌。(X为你已损失的体力值且至少为1)",
            xszhuolie:"拙烈",
            "xszhuolie_info":"<b>锁定技</b>,当你受到杀或决斗的伤害后，若你没有装备武器牌，此伤害+1，然后你可以将场上的一张牌移动到合理的位置。",
            xsxiying:"袭营",
            "xsxiying_info":"出牌阶段限一次，你可以弃置一张牌，令你攻击范围内的所有角色选择一项:</br>①弃置X张牌;</br>②本回合内不能使用或打出牌。(X为你已损失的体力值且至少为1)",
            xsxiying1:"袭营",
            xsmengxian:"梦娴",
            "xsmengxian_info":"每当一名男性角色使用杀指定一名角色为目标时，若目标角色不为你，你可以亮出牌堆顶的一张牌。若为黑色，你令该角色获得此牌，你可以重复此流程直到出现红色为止。",
            xszhenjue:"贞诀",
            "xszhenjue_info":"<b>锁定技</b>,每当其他角色于你回合内弃置牌时，你摸一张牌;每当你于回合外获得牌时，你弃置一张牌。",
            xsyuandu:"远渡",
            "xsyuandu_info":"<b>锁定技</b>,若你未受伤，你计算其他角色的距离时，始终为1;若你已受伤，你计算其他角色的距离-X。(X为你已损失的体力值)",
            xsshoutu:"守土",
            "xsshoutu_info":"<b>锁定技</b>,若你没有装备坐骑牌，其他角色计算与你的距离时，始终+1。每当你受到非属性伤害时，伤害来源须弃置X张牌，否则此伤害无效。(X为该角色与你的距离)",
            xsyinghuan:"引患",
            "xsyinghuan_info":"其他角色的出牌阶段开始时，你可以弃置其两张牌。若如此做，你失去【守土】且该角色与你距离为1直到其回合结束，每轮限两次。",
            xstoucheng:"投诚",
            "xstoucheng_info":"<b>主公技</b>,<b>限定技</b>,一名群雄势力或蜀势力的其他角色出牌阶段开始时，你可以将所有手牌交给该角色，若如此做，你增加一点体力上限并回复一点体力。你的下个出牌阶段开始前，该角色须将所有牌交给你。",
            xstoucheng1:"投诚",
            xsxunyi:"寻夷",
            "xsxunyi_info":"出牌阶段限一次，你可以令与你距离为1的所有角色各展示一张手牌，你从这些牌中获得数量最多的某类牌，其余牌令这些角色收回。若你以此法获得的牌不少于2张，你失去一点体力。",
        },
    },
    intro:"<b>扩展说明</b>:</br>①本扩展包含武将14名，其中基础武将13名+SP武将1名</br>②为保证游戏正常运行，使用前请打开兼容模式</br>③部分技能与牌堆剩余牌数有关，如此类技能未正常发动，可以打开“牌堆补充”扩展来减少此类情况",
    author:"无名杀五周年策划群</br><b>代码设计</b>：小苏  Esperanto</br><b>测试调整</b>：郭子岚  一剑问夜</br><b>技能提供</b>：苍山暮色  一剑问夜  叫我景候大人  小苏  Esperanto",
    diskURL:"",
    forumURL:"",
    version:"1.0",
},files:{"character":["xssp_yanwan.jpg","xsliuzhang.jpg"],"card":[],"skill":[]}}})