game.import("extension",function(lib,game,ui,get,ai,_status){return {name:"异界四国",content:function (config,pack){

},precontent:function (){
    
},help:{},config:{},package:{
    character:{
        character:{
            "嵇授获":["male","shen",4,["shibei","qingxian","zaiqi"],["des:沮授+嵇康+孟获"]],
            "刘恪":["male","shu",3,["xiangle","tianming","duwu"],["zhu","des:刘禅+刘协+诸葛恪"]],
            "刘攸":["male","shu",4,["zhanjue","zhiyu"],["des:刘谌+荀攸"]],
            "高宓":["male","qun",4,["xianzhen","jinjiu","tianbian"],["des:高顺+泰宓"]],
            "吕羽":["male","qun",4,["wushuang","lieren","tianbian"],["des:吕布+关羽"]],
            "许蝉":["male","wei",4,["luoyi","biyue"],["des:界许褚+貂蝉"]],
            "马平":["male","shu",4,["longyin","retieqi"],["des:马超+关平"]],
            "华异":["male","qun",6,["yaowu","zhenlie"],["des:华雄+王异"]],
            "刘亮":["male","shu",4,["rende","kongcheng"],["zhu","des:刘备+诸葛亮"]],
            "沮康":["male","qun",3,["shibei","qingxian"],["des:沮授+嵇康"]],
            "凌权":["male","wu",4,["xuanfeng","xinzhiheng"],["des:凌统+孙权"]],
            "夏侯嘉":["male","wei",4,["ganglie","tiandu"],["des:夏侯淳+郭嘉"]],
            "诸昏":["male","shu",3,["kongcheng","jishe"],["des:诸葛亮+岑昏"]],
            "曹侯淳":["male","wei",4,["jianxiong","ganglie"],["zhu","des:曹操+夏侯淳"]],
            "吕瑜":["male","wu",4,["keji","yingzi"],["des:吕蒙+周瑜"]],
            "张芝":["male","qun",3,["releiji","guidao","weijing"],["des:张角+鲁芝"]],
            "黄奉":["male","shu",4,["liegong","fenxun","duanbing"],["des:黄忠+丁奉"]],
            "典盖":["male","wei",4,["qiangxi","zhaxiang"],["des:典韦+界黄盖"]],
            "太史宓":["male","wu",4,["tianyi","tianbian"],["des:太史慈+泰宓"]],
            "祝宓":["female","shu",4,["juxiang","lieren","tianbian"],["des:祝融+秦宓"]],
            "孟康":["male","qun",5,["zaiqi","qingxian"],["des:孟获+嵇康"]],
            "黄志":["male","wu",4,["kurou","yijieanguo"],["des:黄盖+朱志"]],
            "孙华":["male","wu",4,["yinghun","shangshi"],["des:孙坚+张春华"]],
            "孙瑜慈":["male","wu",4,["jiang","yingzi","tianyi","yinghun"],["zhu","des:孙策+周瑜+太史慈"]],
            "甘逊":["male","wu",3,["qixi","qianxun","lianying"],["des:甘宁+陆逊"]],
            "董获":["male","qun",8,["benghuai","zaiqi"],["zhu","des:董卓+孟获"]],
            "孙仁":["female","wu",3,["xiaoji","jushou1","xinjiewei1"],["des:孙尚香+曹仁"]],
            "吴义":["male","shu",4,["benxi","fuqi","jiaozi"],["des:吴懿+麹义"]],
            "荀睿":["male","wei",3,["qice","huituo"],["des:荀攸+曹叡"]],
            "夏侯昂":["male","wei",4,["baobian","kaikang"],["des:夏侯霸+曹昂"]],
            "袁华":["male","qun",4,["yongsi","shangshi"],["des:袁术+张春华"]],
            "甄懿":["female","wei",3,["luoshen","guicai"],["des:甄姬+司马懿"]],
            "郭佗":["male","wei",3,["yiji","jijiu"],["des:郭嘉+华佗"]],
            "关松":["male","shu",4,["qiangshi","longyin"],["des:关平+张松"]],
            "魏羽":["male","shu",4,["kuanggu1","wusheng","qimou"],["des:魏延+关羽"]],
            "赵飞":["male","qun",4,["longdan","chongzhen","paoxiao"],["des:赵云+张飞"]],
            "乐仁":["male","wei",4,["xiaoguo","jushou1"],["des:乐进+曹仁"]],
            "曹智仁":["male","wei",3,["jiushi","jushou1","xinjiewei1"],["des:曹植+曹仁"]],
            "貂仁":["female","qun",3,["lihun","jushou1"],["des:sp貂蝉+曹仁"]],
            "朱盖":["male","wu",4,["zhanyi","zhaxiang"],["des:朱灵+界黄盖"]],
            "王华":["female","wei",3,["zhenlie","shangshi"],["des:王异+张春华"]],
            "诸马逊":["male","wu",3,["guicai","mingzhe","lianying"],["des:诸葛瑾+司马懿+陆逊"]],
            "钟邕":["male","qun",3,["huomo","pizhuan","tongbo"],["des:钟繇+蔡邕"]],
            "孔白权":["male","wu",3,["xinzhiheng","xiehui","lirang"],["zhu","des:孔融+董白+孙权"]],
            "满攸":["male","wei",4,["yuce","zhiyu"],["des:满宠+荀攸"]],
            "简乾灵":["male","shu",3,["shuomeng","tianbian","shuangren"],["des:简雍+孙乾+纪灵"]],
            "张顿":["male","qun",4,["fulu","zhufu","luanzhan"],["des:张梁+蹋顿"]],
            "田逊":["male","qun",3,["sijian","lianying"],["des:田丰+陆逊"]],
            "孙佗":["male","wu",3,["liangzhu","qingnang","jijiu"],["des:孙尚香+华佗"]],
            "马嘉":["male","shu",4,["retieqi","tiandu"],["des:马超+郭嘉"]],
            "诸超嘉":["male","shu",4,["tiandu","bagua","retieqi"],["des:诸葛亮+马超+郭嘉"]],
            "诸昏育":["female","shen",4,["kongcheng","jishe","meibu"],["des:诸葛亮+岑昏+孙鲁育"]],
            "荀逊":["male","wei",3,["qice","lianying"],["des:荀彧+陆逊"]],
            "严香":["female","wu",3,["zhidao","xiaoji"],["des:严白虎+孙尚香"]],
            "诸葛冲":["male","qun",2,["chengxiang1","gongao1"],["des:诸葛诞+曹冲"]],
            "李延":["male","wei",3,["wangxi1","kuanggu1"],["des:李典+魏延"]],
            "陈坚统":["male","wei",4,["faen","gai_huansha","gai_huanshan","gailianhuan"],["des:陈群+马俊坚+庞统"]],
            "刘尚姬":["male","wu",3,["polu","kongsheng","xiaoji"],["des:刘晔+孙尚香+周姬"]],
            "张超":["male","shu",4,["fuhun","retieqi","mashu"],["des:张兴张苞+马超"]],
            "黄恩月":["female","wu",3,["jiqiao1","xiefeng","xinjizhi"],["des:sp黄月英+夏侯恩+黄月英"]],
            "徐浩纪协":["male","wei",4,["shenduan1","jiezi1","jigong1","tianming"],["des:徐晃+韩浩史涣+郭图逢纪+刘协"]],
            "甄白":["female","wei",3,["luoshen","qingguo1","xiehui"],["des:甄姬+董白"]],
            "曹嘉":["male","wei",4,["jushou1","yiji","xinjiewei1"],["des:曹仁+郭嘉"]],
            "植丕":["male","wei",2,["fangzhu1","jiushi"],["des:曹丕+曹植"]],
            "张维":["male","wei",4,["qiaobian","gaikunfen","fengliang1"],["des:张郃+姜维"]],
            "诸葛姬":["female","shu",3,["yuhua1","qirang1","kongsheng"],["des:诸葛果+周姬"]],
            "邓协":["male","wei",4,["tuntian1","zaoxian1","tianming"],["zhu","des:邓艾+刘协"]],
            "刘丰":["male","qun",3,["mizhao1","tianming","sijian"],["des:刘协+田丰"]],
            "步雍":["male","wu",3,["hongde1","shenxing1"],["des:步骘+顾雍"]],
            "夏恒奉":["male","shen",4,["xinshensu1","duanbing","pingkou1"],["des:夏侯渊+朱恒+丁奉"]],
            "文亮":["male","qun",4,["zhenwei1","bagua"],["des:文聘+诸葛亮"]],
            "张宓昂":["male","shen",3,["guidao","releiji","jianzheng1","kaikang"],["des:张角+秦宓+曹昂"]],
            "诸攸节":["male","shu",4,["xinguanxing","cunmu","shouxi1"],["des:诸葛亮+许攸+曹节"]],
            "鲁然":["male","wu",3,["haosh1i","danshou"],["des:鲁肃+朱然"]],
            "蔡文彧":["female","wei",3,["beige1","jieming1"],["des:蔡文姬+荀彧"]],
            "马岱超":["male","shu",4,["qianxi1","mashu","retieqi1"],["des:马岱+马超"]],
            "刘葛禅":["male","shu",3,["xiansi1","bagua","xiangle"],["des:刘封+诸葛亮+刘禅"]],
            "蔡星":["female","qun",3,["qieting1","shenxian1"],["des:蔡夫人+张星彩"]],
            "关彩":["male","shu",4,["wusheng","shenxian1","mashu"],["des:关羽+张星彩"]],
            "颜貂文蝉":["male","shu",4,["shuangxiong1","lihun"],["des:颜良文丑+貂蝉"]],
            "曹儒":["male","wei",3,["guixin","xinjuece1","mieji1"],["des:神曹操+李儒"]],
            "贺操":["male","wu",3,["dujin1","qizhou1"],["des:贺齐+凌操"]],
            "阚宫":["male","wu",3,["xiashu1","kuanshi1","zhichi1"],["des:阚泽+陈宫"]],
            "吴姬操":["female","wu",3,["ganlu1","dujin1"],["des:吴国太+周姬+凌操"]],
            "陈岑董昏":["male","wu",4,["duanxie1","fenmin","jishe"],["des:陈武董袭+岑昏"]],
            "张坚":["male","wei",3,["gai_huansha","gai_huanshan","taiji1"],["des:张三丰+马俊坚+陈群"]],
            "何雉":["female","qun",3,["jiudu1","qiluan1","zhensha1"],["des:何太后+吕雉"]],
            "吕丰践":["male","wu",3,["tuqiang1","taiji1","keji"],["des:吕蒙+张三丰+勾践"]],
            "孙姒":["female","wu",3,["fenghuo1","xiaoji"],["des:孙尚香+褒姒"]],
            "徐羽策":["male","shu",4,["zhuhai1","wusheng","jiang"],["des:徐庶+关羽+孙策"]],
            "伏彩":["male","qun",4,["moukui1","qiangwu1"],["des:伏完+张星彩"]],
            "曹盖":["male","qun",4,["weikui1","zhaxiang"],["des:曹仁+黄盖"]],
            "诸葛获":["male","shu",4,["xinguanxing","zaiqi","juxiang"],["des:诸葛亮+孟获"]],
            "黄休":["male","shu",4,["qianju1","liegong"],["des:黄忠+曹休"]],
            "黄朗":["male","wu",4,["quji1","zhaxiang"],["des:黄盖+司马朗"]],
            "兀突坚":["male","qun",10,["ranshang1","xueji1"],["des:兀突骨+关银屏"]],
            "马茹":["male","shu",3,["qianxi1","yingjian1"],["des:马岱+孙茹"]],
            "桥昭纮":["female","wu",3,["guzheng1","guose1"],["des:大乔+张昭张纮"]],
            "王盖":["female","wei",3,["zhenlie","zhaxiang"],["des:王异+黄盖"]],
            "马松":["male","shu",3,["zishu1","qiangshi"],["des:马良+张松"]],
            "袁延奉":["male","qun",4,["luanji1","kuanggu1","fenxun"],["zhu","des:袁绍+魏延+丁奉"]],
            "关华":["male","qun",3,["longyin","shangshi"],["des:关平+张春华"]],
            "贾禁华":["male","qun",3,["weimu1","yizhong1","shangshi"],["des:贾诩+于禁+张春华"]],
            "吕虎":["male","shen",4,["shenyi","kuangbao","shenfen1"],["des:神吕布+白虎"]],
            "郭图刘协":["male","qun",3,["jigong1","tianming"],["des:郭图逢纪+刘协"]],
            "孟姒延":["male","shen",5,["juxiang","fenghuo1","kuanggu1","benxi"],["des:孟获+魏延+褒姒"]],
            "曹虎渊":["male","shen",4,["xinshensu1","jushou1","xinjiewei1"],["des:曹仁+白虎+夏侯渊"]],
            "凌宁逊":["male","shen",4,["dujin1","xuanfeng","qixi","lianying"],["des:凌操+甘宁+陆逊+凌统"]],
        },
        translate:{
            "嵇授获":"嵇授获",
            "刘恪":"刘恪",
            "刘攸":"刘攸",
            "高宓":"高宓",
            "吕羽":"吕羽",
            "许蝉":"许蝉",
            "马平":"马平",
            "华异":"华异",
            "刘亮":"刘亮",
            "沮康":"沮康",
            "凌权":"凌权",
            "夏侯嘉":"夏侯嘉",
            "诸昏":"诸昏",
            "曹侯淳":"曹侯淳",
            "吕瑜":"吕瑜",
            "张芝":"张芝",
            "黄奉":"黄奉",
            "典盖":"典盖",
            "太史宓":"太史宓",
            "祝宓":"祝宓",
            "孟康":"孟康",
            "黄志":"黄志",
            "孙华":"孙华",
            "孙瑜慈":"孙瑜慈",
            "甘逊":"甘逊",
            "董获":"董获",
            "孙仁":"孙仁",
            "吴义":"吴义",
            "荀睿":"荀睿",
            "夏侯昂":"夏侯昂",
            "袁华":"袁华",
            "甄懿":"甄懿",
            "郭佗":"郭佗",
            "关松":"关松",
            "魏羽":"魏羽",
            "赵飞":"赵飞",
            "乐仁":"乐仁",
            "曹智仁":"曹智仁",
            "貂仁":"貂仁",
            "朱盖":"朱盖",
            "王华":"王华",
            "诸马逊":"诸马逊",
            "钟邕":"钟邕",
            "孔白权":"孔白权",
            "满攸":"满攸",
            "简乾灵":"简乾灵",
            "张顿":"张顿",
            "田逊":"田逊",
            "孙佗":"孙佗",
            "马嘉":"马嘉",
            "诸超嘉":"诸超嘉",
            "诸昏育":"诸昏育",
            "荀逊":"荀逊",
            "严香":"严香",
            "诸葛冲":"诸葛冲",
            "李延":"李延",
            "陈坚统":"陈坚统",
            "刘尚姬":"刘尚姬",
            "张超":"张超",
            "黄恩月":"黄恩月",
            "徐浩纪协":"徐浩纪协",
            "甄白":"甄白",
            "曹嘉":"曹嘉",
            "植丕":"植丕",
            "张维":"张维",
            "诸葛姬":"诸葛姬",
            "邓协":"邓协",
            "刘丰":"刘丰",
            "步雍":"步雍",
            "夏恒奉":"夏恒奉",
            "文亮":"文亮",
            "张宓昂":"张宓昂",
            "诸攸节":"诸攸节",
            "鲁然":"鲁然",
            "蔡文彧":"蔡文彧",
            "马岱超":"马岱超",
            "刘葛禅":"刘葛禅",
            "蔡星":"蔡星",
            "关彩":"关彩",
            "颜貂文蝉":"颜貂文蝉",
            "曹儒":"曹儒",
            "贺操":"贺操",
            "阚宫":"阚宫",
            "吴姬操":"吴姬操",
            "陈岑董昏":"陈岑董昏",
            "张坚":"张坚",
            "何雉":"何雉",
            "吕丰践":"吕丰践",
            "孙姒":"孙姒",
            "徐羽策":"徐羽策",
            "伏彩":"伏彩",
            "曹盖":"曹盖",
            "诸葛获":"诸葛获",
            "黄休":"黄休",
            "黄朗":"黄朗",
            "兀突坚":"兀突坚",
            "马茹":"马茹",
            "桥昭纮":"桥昭纮",
            "王盖":"王盖",
            "马松":"马松",
            "袁延奉":"袁延奉",
            "关华":"关华",
            "贾禁华":"贾禁华",
            "吕虎":"吕虎",
            "郭图刘协":"郭图刘协",
            "孟姒延":"孟姒延",
            "曹虎渊":"曹虎渊",
            "凌宁逊":"凌宁逊",
        },
    },
    card:{
        card:{
        },
        translate:{
        },
        list:[],
    },
    skill:{
        skill:{
            zhaxiang:{
                init:function (player){
    player.storage.ol_zhaxiang=0;
    },
                group:"ol_zhaxiang_reset",
                trigger:{
                    player:"loseHpEnd",
                },
                marktext:"降",
                intro:{
                    content:function (storage){
            
            return '本回合已发动过'+storage+'次诈降';
        },
                },
                forced:true,
                filter:function (event){
        return (event.num>0)
    },
                content:function (){
        player.draw(3*trigger.num);
  
        if(_status.currentPhase==player){
             
            player.addTempSkill('ol_zhaxiang_sha',{player:'phaseUseEnd'});
            player.markSkill('ol_zhaxiang');
            player.storage.ol_zhaxiang+=trigger.num;
        }
        else{
            game.trySkillAudio('zhaxiang',player);
        }
    },
                subSkill:{
                    sha:{
                        audio:"zhaxiang",
                        trigger:{
                            player:"shaBegin",
                        },
                        forced:true,
                        filter:function (event,player){
                return event.card&&get.color(event.card)=='red';
            },
                        content:function (){
                trigger.directHit=true;  
                
            },
                        mod:{
                            targetInRange:function (card,player,target,now){
                    if(card.name=='sha'&&get.color(card)=='red') return true;
                },
                            cardUsable:function (card,player,num){
                    if(card.name=='sha') return num+player.storage.ol_zhaxiang;
                },
                        },
                        sub:true,
                    },
                    reset:{
                        trigger:{
                            player:"phaseUseEnd",
                        },
                        forced:true,
                        popup:false,
                        silent:true,
                        content:function (){
       player.storage.ol_zhaxiang=0;
      player.unmarkSkill('ol_zhaxiang');
           player.update();
           ui.clear();
             },
                        sub:true,
                    },
                },
            },
            qiangxi:{
                audio:"qiangxi",
                enable:"phaseUse",
                filter:function (event,player){
        if(player.hasSkill('xinqiangxi2')){
            return !player.hasSkill('xinqiangxi3');
        }
        else if(player.hasSkill('xinqiangxi3')){
            return !player.hasSkill('xinqiangxi2')&&player.countCards('he',{type:'equip'})>0;
        }
        else{
            return true;
        }
    },
                filterCard:function (card){
        var player=_status.event.player;
        if(player.hasSkill('xinqiangxi2')) return false;
        return get.type(card)=='equip';
    },
                selectCard:function (){
        var player=_status.event.player;
        if(player.hasSkill('xinqiangxi2')) return -1;
        if(player.hasSkill('xinqiangxi3')) return [1,1];
        return [0,1];
    },
                filterTarget:function (card,player,target){
        if(player==target) return false;
        return get.distance(player,target,'attack')<=1;
    },
                content:function (){
        "step 0"
        if(cards.length==0){
            player.loseHp();
            player.addTempSkill('xinqiangxi3');
        }
        else{
            player.addTempSkill('xinqiangxi2');
        }
        "step 1"
        target.damage();
    },
                check:function (card){
        return 10-get.value(card);
    },
                position:"he",
                ai:{
                    order:8.5,
                    result:{
                        target:function (player,target){
                if(player.hasSkill('xinqiangxi2')||!player.countCards('he',{type:'equip'})){
                    if(player.hp<2) return 0;
                    if(target.hp>=player.hp) return 0;
                }
                return get.damageEffect(target,player);
            },
                    },
                },
                threaten:1.5,
            },
            lianying:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"loseEnd",
                },
                direct:true,
                filter:function (event,player){
        if(player.countCards('h')) return false;
        for(var i=0;i<event.cards.length;i++){
            if(event.cards[i].original=='h') return true;
        }
        return false;
    },
                content:function (){
        "step 0"
        var num=0;
        for(var i=0;i<trigger.cards.length;i++){
            if(trigger.cards[i].original=='h') num++;
        }
        player.chooseTarget('选择发动连营的目标',[1,num]).ai=function(target){
            var player=_status.event.player;
            if(player==target) return get.attitude(player,target)+10;
            return get.attitude(player,target);
        }
        "step 1"
        if(result.bool){
            player.logSkill('relianying',result.targets);
            game.asyncDraw(result.targets);
        }
    },
                ai:{
                    threaten:0.8,
                    effect:{
                        target:function (card){
                if(card.name=='guohe'||card.name=='liuxinghuoyu') return 0.5;
            },
                    },
                    noh:true,
                },
            },
            qianxun:{
                init:function (player){
        player.storage.reqianxun2=[];
    },
                audio:"ext:异界四国:2",
                trigger:{
                    target:"useCardToBegin",
                    player:"judgeBefore",
                },
                filter:function (event,player){
        if(player.countCards('h')==0) return false;
        if(event.parent.name=='phaseJudge'){
            if(lib.skill.reqianxun.trigger.player=='judgeBefore'){
                return true;
            }
            return event.result&&event.result.judge!=0;
        }
        if(event.name=='judge') return false;
        if(event.targets&&event.targets.length>1) return false;
        if(event.card&&get.type(event.card)=='trick'&&event.player!=player) return true;
    },
                content:function (){
        player.storage.reqianxun2=player.storage.reqianxun2.concat(player.getCards('h'));
        game.addVideo('storage',player,['reqianxun2',get.cardsInfo(player.storage.reqianxun2),'cards']);
        player.lose(player.getCards('h'),ui.special);
        player.addSkill('reqianxun2');
    },
                ai:{
                    effect:function (card,player,target){
            if(!target.hasFriend()) return;
            if(player==target) return;
            var type=get.type(card);
            var nh=target.countCards();
            if(type=='trick'){
                if(!get.tag(card,'multitarget')||get.info(card).singleCard){
                    if(get.tag(card,'damage')){
                        if(nh<3||target.hp<=2) return 0.8;
                    }
                    return [1,nh];
                }
            }
            else if(type=='delay'){
                return [0.5,0.5];
            }
        },
                },
            },
            qingnang:{
                audio:"ext:异界四国:2",
                enable:"phaseUse",
                filterCard:true,
                usable:1,
                check:function (card){
        return 9-get.value(card)
    },
                filterTarget:function (card,player,target){
        if(target.hp>=target.maxHp) return false;
        return true;
    },
                content:function (){
        target.recover();
    },
                ai:{
                    order:9,
                    result:{
                        target:function (player,target){
                if(target.hp==1) return 5;
                if(player==target&&player.countCards('h')>player.hp) return 5;
                return 2;
            },
                    },
                    threaten:2,
                },
            },
            jijiu:{
                audio:"ext:异界四国:2",
                enable:"chooseToUse",
                filter:function (event,player){
        return _status.currentPhase!=player;
    },
                filterCard:function (card){
        return get.color(card)=='red';
    },
                position:"he",
                viewAs:{
                    name:"tao",
                },
                prompt:"将一张红色牌当桃使用",
                check:function (card){return 15-get.value(card)},
                ai:{
                    skillTagFilter:function (player){
            return player.countCards('he',{color:'red'})>0&&_status.currentPhase!=player;
        },
                    threaten:1.5,
                    save:true,
                    respondTao:true,
                    basic:{
                        order:function (card,player){
                            if(player.hasSkillTag('pretao')) return 5;
                            return 2;
                        },
                        useful:[8,6.5,5,4],
                        value:[8,6.5,5,4],
                    },
                    result:{
                        target:function (player,target){
                            // if(player==target&&player.hp<=0) return 2;
                            var nd=player.needsToDiscard();
                            var keep=false;
                            if(nd<=0){
                                keep=true;
                            }
                            else if(nd==1&&target.hp>=2&&target.countCards('h','tao')<=1){
                                keep=true;
                            }
                            var mode=get.mode();
                            if(target.hp>=2&&keep&&target.hasFriend()){
                                if(target.hp>2||nd==0) return 0;
                                if(target.hp==2){
                                    if(game.hasPlayer(function(current){
                                        if(target!=current&&get.attitude(target,current)>=3){
                                            if(current.hp<=1) return true;
                                            if((mode=='identity'||mode=='versus'||mode=='chess')&&current.identity=='zhu'&&current.hp<=2) return true;
                                        }
                                    })){
                                        return 0;
                                    }
                                }
                            }
                            if(target.hp<0&&target!=player&&target.identity!='zhu') return 0;
                            var att=get.attitude(player,target);
                            if(att<3&&att>=0&&player!=target) return 0;
                            var tri=_status.event.getTrigger();
                            if(mode=='identity'&&player.identity=='fan'&&target.identity=='fan'){
                                if(tri&&tri.name=='dying'&&tri.source&&tri.source.identity=='fan'&&tri.source!=target){
                                    var num=game.countPlayer(function(current){
                                        if(current.identity=='fan'){
                                            return current.countCards('h','tao');
                                        }
                                    });
                                    if(num>1&&player==target) return 2;
                                    return 0;
                                }
                            }
                            if(mode=='identity'&&player.identity=='zhu'&&target.identity=='nei'){
                                if(tri&&tri.name=='dying'&&tri.source&&tri.source.identity=='zhong'){
                                    return 0;
                                }
                            }
                            if(mode=='stone'&&target.isMin()&&
                            player!=target&&tri&&tri.name=='dying'&&player.side==target.side&&
                            tri.source!=target.getEnemy()){
                                return 0;
                            }
                            return 2;
                        },
                    },
                    tag:{
                        recover:1,
                        save:1,
                    },
                },
            },
            kurou:{
                audio:"ext:异界四国:4",
                enable:"phaseUse",
                prompt:"失去一点体力并摸两张牌",
                content:function (){
        "step 0"
        player.loseHp(1);
        "step 1"
        player.draw(2);
    },
                ai:{
                    basic:{
                        order:1,
                    },
                    result:{
                        player:function (player){
                if(player.countCards('h')>=player.hp-1) return -1;
                if(player.hp<3) return -1;
                return 1;
            },
                    },
                },
            },
            longyin:{
                trigger:{
                    global:"shaBegin",
                },
                direct:true,
                filter:function (event,player){
        return event.target==event.targets[0]&&player.countCards('he')>0&&event.card.name=='sha'&&
        _status.currentPhase==event.player&&event.parent.parent.parent.name=='phaseUse';
    },
                content:function (){
        'step 0'
        var go=false;
        if(get.attitude(player,trigger.player)>0){
            if(get.color(trigger.card)=='red'){
                go=true;
            }
            else if(!trigger.player.hasSkill('paoxiao')&&
                !trigger.player.hasSkill('tanlin3')&&
                !trigger.player.hasSkill('zhaxiang2')&&
                !trigger.player.hasSkill('fengnu')&&
                !trigger.player.getEquip('zhuge')){
                var nh=trigger.player.countCards('h');
                if(player==trigger.player){
                    go=(player.countCards('h','sha')>0);
                }
                else if(nh>=4){
                    go=true;
                }
                else if(player.countCards('h','sha')){
                    if(nh==3){
                        go=Math.random()<0.8;
                    }
                    else if(nh==2){
                        go=Math.random()<0.5;
                    }
                }
                else if(nh>=3){
                    if(nh==3){
                        go=Math.random()<0.5;
                    }
                    else if(nh==2){
                        go=Math.random()<0.2;
                    }
                }
            }
        }
        var next=player.chooseToDiscard(get.prompt('longyin'),'he');
        next.logSkill=['longyin',trigger.player];
        next.set('ai',function(card){
            if(_status.event.go){
                return 6-get.value(card);
            }
            return 0;
        });
        next.set('go',go);
        'step 1'
        if(result.bool){
            trigger.player.getStat().card.sha--;
            if(get.color(trigger.card)=='red'){
                player.draw();
            }
            // player.logSkill('longyin',trigger.player);
        }
    },
                ai:{
                    expose:0.2,
                },
            },
            mashu:{
                mod:{
                    globalFrom:function (from,to,distance){
            return distance-1;
        },
                },
            },
            retieqi:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"shaBegin",
                },
                check:function (event,player){
        return get.attitude(player,event.target)<=0;
    },
                logTarget:"target",
                content:function (){
        "step 0"
        player.judge(function(card){
            if(get.zhu(_status.event.player,'shouyue')){
                if(get.suit(card)!='spade') return 2;
            }
            else{
                if(get.color(card)=='red') return 2;
            }
            return -0.5;
        });
        "step 1"
        if(result.bool){
            trigger.directHit=true;
        }
    },
            },
            yijieanguo:{
                audio:"yijieanguo",
                enable:"phaseUse",
                usable:1,
                filterTarget:function (card,player,target){
        if(player==target) return false;
        if(player.isMinHandcard()||target.isMinHandcard()) return true;
        if(player.isMinEquip()||target.isMinEquip()) return true;
        if((player.isMinHp()&&player.isDamaged())||(target.isMinHp()&&target.isDamaged())) return true;
        return false;
    },
                content:function (){
        'step 0'
        if(target.isMinHandcard()){
            target.draw();
            event.h=true;
        }
        if(target.isMinHp()&&target.isDamaged()){
            target.recover();
            event.hp=true;
        }
        event.equip=get.cardPile(function(card){
            return get.type(card)=='equip';
        });
        if(target.isMinEquip()){
            target.equip(event.equip||game.createCard(get.inpilefull('equip').randomGet()),true);
            event.e=true;
        }
        'step 1'
        if(!event.h&&player.isMinHandcard()){
            player.draw();
        }
        if(!event.hp&&player.isMinHp()&&player.isDamaged()){
            player.recover();
        }
        if(!event.e&&player.isMinEquip()){
            player.equip(event.equip||game.createCard(get.inpilefull('equip').randomGet()),true);
        }
    },
                ai:{
                    threaten:1.6,
                    order:9,
                    result:{
                        player:function (player,target){
                if(get.attitude(player,target)<=0){
                    if(target.isMinHandcard()||target.isMinEquip()||target.isMinHp()) return -1;
                }
                var num=0;
                if(player.isMinHandcard()||target.isMinHandcard()) num++;
                if(player.isMinEquip()||target.isMinEquip()) num++;
                if((player.isMinHp()&&player.isDamaged())||(target.isMinHp()&&target.isDamaged())) num+=2.1;
                return num;
            },
                    },
                },
            },
            fenxun:{
                enable:"phaseUse",
                usable:1,
                position:"he",
                filterTarget:function (card,player,target){
        return target!=player;
    },
                content:function (){
        player.storage.fenxun2=target;
        player.addTempSkill('fenxun2');
    },
                check:function (card){
        if(card.name=='sha'&&_status.event.player.countCards('h','sha')<=1) return 0;
        return 6-get.value(card);
    },
                filterCard:true,
                ai:{
                    order:4,
                    result:{
                        player:function (player,target){
                if(get.distance(player,target)<=1) return 0;
                var hs=player.getCards('h','shunshou');
                if(hs.length&&player.canUse(hs[0],target,false)){
                    return 1;
                }
                var geteff=function(current){
                    return player.canUse('sha',current,false,true)&&get.effect(current,{name:'sha'},player,player)>0;
                }
                if(player.hasSha()&&geteff(target)){
                    var num=game.countPlayer(function(current){
                        return current!=player&&get.distance(player,current)<=1&&geteff(current);
                    });
                    if(num==0){
                        if(game.hasPlayer(function(current){
                            return player.canUse('sha',current)&&geteff(current)&&current!=target;
                        })){
                            return 1;
                        }
                    }
                    else if(num==1){
                        return 1;
                    }
                }
                return 0;
            },
                    },
                },
            },
            duanbing:{
                trigger:{
                    player:"useCard",
                },
                filter:function (event,player){
        if(event.card.name!='sha') return false;
        return game.hasPlayer(function(current){
            return !event.targets.contains(current)&&get.distance(player,current)<=1&&player.canUse('sha',current);
        });
    },
                direct:true,
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('duanbing'),function(card,player,target){
            return !_status.event.source.contains(target)&&get.distance(player,target)<=1&&player.canUse('sha',target);
        }).set('source',trigger.targets).set('ai',function(target){
            var player=_status.event.player;
            return get.effect(target,{name:'sha'},player,player);
        });
        'step 1'
        if(result.bool){
            if(!event.isMine()&&!_status.connectMode) game.delayx();
            event.target=result.targets[0];
        }
        else{
            event.finish();
        }
        'step 2'
        player.logSkill('duanbing',event.target);
        trigger.targets.push(event.target);
    },
                ai:{
                    effect:{
                        player:function (card,player,target){
                if(card.name=='sha'){
                    if(player._duanbingtmp) return;
                    player._duanbingtmp=true;
                    if(get.effect(target,{name:'sha'},player,player)<=0){
                        delete player._duanbingtmp;
                        return;
                    }
                    if(game.hasPlayer(function(current){
                        return current!=target&&get.distance(player,current)<=1&&
                        player.canUse('sha',current)&&get.effect(current,{name:'sha'},player,player)>0;
                    })){
                        delete player._duanbingtmp;
                        return [1,1];
                    }
                    delete player._duanbingtmp;
                }
            },
                    },
                },
            },
            "kuanggu1":{
                trigger:{
                    source:"damageEnd",
                },
                filter:function (event,player){
        return get.distance(player,event.player)<=1&&event.num>0;
    },
                direct:true,
                audio:"kuanggu",
                content:function (){
        'step 0'
        event.num=trigger.num;
        'step 1'
        player.chooseDrawRecover(get.prompt('kuanggu1')).set('logSkill','kuanggu1');
        'step 2'
        if(result.control!='cancel2'){
            event.num--;
            if(event.num>0){
                event.goto(1);
            }
        }
    },
            },
            wusheng:{
                audio:"ext:异界四国:3",
                enable:["chooseToRespond","chooseToUse"],
                filterCard:function (card,player){
        if(get.zhu(player,'shouyue')) return true;
        return get.color(card)=='red';
    },
                position:"he",
                viewAs:{
                    name:"sha",
                },
                viewAsFilter:function (player){
        if(get.zhu(player,'shouyue')){
            if(!player.countCards('he')) return false;
        }
        else{
            if(!player.countCards('he',{color:'red'})) return false;
        }
    },
                prompt:"将一张红色牌当杀使用或打出",
                check:function (card){return 4-get.value(card)},
                ai:{
                    skillTagFilter:function (player){
            if(get.zhu(player,'shouyue')){
                if(!player.countCards('he')) return false;
            }
            else{
                if(!player.countCards('he',{color:'red'})) return false;
            }
        },
                    respondSha:true,
                    basic:{
                        useful:[5,1],
                        value:[5,1],
                    },
                    order:function (){
                        if(_status.event.player.hasSkillTag('presha',true,null,true)) return 10;
                        return 3;
                    },
                    result:{
                        target:function (player,target){
                            if(player.hasSkill('jiu')&&!target.getEquip('baiyin')){
                                if(get.attitude(player,target)>0){
                                    return -6;
                                }
                                else{
                                    return -3;
                                }
                            }
                            return -1.5;
                        },
                    },
                    tag:{
                        respond:1,
                        respondShan:1,
                        damage:function (card){
                            if(card.nature=='poison') return;
                            return 1;
                        },
                        natureDamage:function (card){
                            if(card.nature) return 1;
                        },
                        fireDamage:function (card,nature){
                            if(card.nature=='fire') return 1;
                        },
                        thunderDamage:function (card,nature){
                            if(card.nature=='thunder') return 1;
                        },
                        poisonDamage:function (card,nature){
                            if(card.nature=='poison') return 1;
                        },
                    },
                },
            },
            qimou:{
                unique:true,
                enable:"phaseUse",
                filter:function (event,player){
        return !player.storage.qimou;
    },
                init:function (player){
        player.storage.qimou=false;
    },
                mark:true,
                intro:{
                    content:"limited",
                },
                skillAnimation:"legend",
                animationColor:"metal",
                content:function (){
        'step 0'
        var shas=player.getCards('h','sha');
        var num;
        if(player.hp>=4&&shas.length>=3){
            num=3;
        }
        else if(player.hp>=3&&shas.length>=2){
            num=2;
        }
        else{
            num=1
        }
        player.awakenSkill('qimou');
        player.storage.qimou=true;
        player.chooseControl('一','二','三','四','五','六',function(){
            return get.cnNumber(_status.event.goon,true);
        }).set('prompt','失去任意点体力').set('goon',num);
        'step 1'
        var num;
        switch(result.control){
            case '一':num=1;break;
            case '二':num=2;break;
            case '三':num=3;break;
            case '四':num=4;break;
            case '五':num=5;break;
            case '六':num=6;break;
        }
        player.storage.qimou2=num;
        player.loseHp(num);
        player.addTempSkill('qimou2');
    },
                ai:{
                    order:2,
                    result:{
                        player:function (player){
                if(player.hp==1) return 0;
                var shas=player.getCards('h','sha');
                if(!shas.length) return 0;
                var card=shas[0];
                if(!lib.filter.cardEnabled(card,player)) return 0;
                if(lib.filter.cardUsable(card,player)) return 0;
                var mindist;
                if(player.hp>=4&&shas.length>=3){
                    mindist=4;
                }
                else if(player.hp>=3&&shas.length>=2){
                    mindist=3;
                }
                else{
                    mindist=2;
                }
                if(game.hasPlayer(function(current){
                    return (current.hp<=mindist-1&&
                        get.distance(player,current,'attack')<=mindist&&
                        player.canUse(card,current,false)&&
                        get.effect(current,card,player,player)>0);
                })){
                    return 1;
                }
                return 0;
            },
                    },
                },
            },
            xianzhen:{
                audio:"ext:异界四国:2",
                enable:"phaseUse",
                usable:1,
                filterTarget:function (card,player,target){
        return player!=target&&target.countCards('h')>0;
    },
                filter:function (event,player){
        return player.countCards('h')>0;
    },
                content:function (){
        "step 0"
        player.chooseToCompare(target);
        "step 1"
        if(result.bool){
            player.storage.xianzhen=target;
            player.addTempSkill('xianzhen2');
        }
        else{
            player.addTempSkill('xianzhen3');
        }
    },
                ai:{
                    order:function (name,player){
            var cards=player.getCards('h');
            if(player.countCards('h','sha')==0){
                return 1;
            }
            for(var i=0;i<cards.length;i++){
                if(cards[i].name!='sha'&&cards[i].number>11&&get.value(cards[i])<7){
                    return 9;
                }
            }
            return get.order({name:'sha'})-1;
        },
                    result:{
                        player:function (player){
                if(player.countCards('h','sha')>0) return 0;
                var num=player.countCards('h');
                if(num>player.hp) return 0;
                if(num==1) return -2;
                if(num==2) return -1;
                return -0.7;
            },
                        target:function (player,target){
                var num=target.countCards('h');
                if(num==1) return -1;
                if(num==2) return -0.7;
                return -0.5
            },
                    },
                    threaten:1.3,
                },
            },
            jinjiu:{
                mod:{
                    cardEnabled:function (card,player){
            if(card.name=='jiu'&&_status.event.skill!='jinjiu') return false;
        },
                    cardUsable:function (card,player){
            if(card.name=='jiu'&&_status.event.skill!='jinjiu') return false;
        },
                    cardRespondable:function (card,player){
            if(card.name=='jiu'&&_status.event.skill!='jinjiu') return false;
        },
                    cardSavable:function (card,player){
            if(card.name=='jiu'&&_status.event.skill!='jinjiu') return false;
        },
                },
                enable:["chooseToUse","chooseToRespond"],
                filter:function (event,player){
        return player.countCards('h','jiu')>0;
    },
                filterCard:{
                    name:"jiu",
                },
                viewAs:{
                    name:"sha",
                },
                viewAsFilter:function (player){
        if(!player.countCards('h','jiu')) return false;
    },
                check:function (){return 1},
                ai:{
                    skillTagFilter:function (player){
            if(!player.countCards('h','jiu')) return false;
        },
                    respondSha:true,
                    order:4,
                    useful:-1,
                    value:-1,
                    basic:{
                        useful:[5,1],
                        value:[5,1],
                    },
                    result:{
                        target:function (player,target){
                            if(player.hasSkill('jiu')&&!target.getEquip('baiyin')){
                                if(get.attitude(player,target)>0){
                                    return -6;
                                }
                                else{
                                    return -3;
                                }
                            }
                            return -1.5;
                        },
                    },
                    tag:{
                        respond:1,
                        respondShan:1,
                        damage:function (card){
                            if(card.nature=='poison') return;
                            return 1;
                        },
                        natureDamage:function (card){
                            if(card.nature) return 1;
                        },
                        fireDamage:function (card,nature){
                            if(card.nature=='fire') return 1;
                        },
                        thunderDamage:function (card,nature){
                            if(card.nature=='thunder') return 1;
                        },
                        poisonDamage:function (card,nature){
                            if(card.nature=='poison') return 1;
                        },
                    },
                },
            },
            tianbian:{
                trigger:{
                    player:"chooseCardBegin",
                },
                check:function (event,player){
        return player.hasCard(function(card){
            var val=get.value(card);
            return val<0||(val<=4&&card.number>=11);
        });
    },
                filter:function (event){
        return event.type=='compare'&&!event.directresult;
    },
                content:function (){
        var cards=get.cards();
        cards[0].discard();
        cards[0].vanishtag.add('tianbian');
        trigger.directresult=cards;
        trigger.untrigger();
    },
                group:"tianbian_number",
                subSkill:{
                    number:{
                        trigger:{
                            player:"compare",
                            target:"compare",
                        },
                        filter:function (event,player){
                if(event.iwhile) return false;
                if(event.player==player){
                    return get.suit(event.card1)=='heart';//&&event.card1.vanishtag.contains('tianbian');
                }
                else{
                    return get.suit(event.card2)=='heart';//&&event.card2.vanishtag.contains('tianbian');
                }
            },
                        silent:true,
                        content:function (){
                game.log(player,'拼点牌点数视为','#y13');
                if(player==trigger.player){
                    trigger.num1=13;
                }
                else{
                    trigger.num2=13;
                }
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                },
            },
            yiji:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"damageEnd",
                },
                frequent:true,
                filter:function (event){
        return (event.num>0)
    },
                content:function (){
        "step 0"
        event.cards=get.cards(2*trigger.num);
        "step 1"
        if(event.cards.length>1){
            player.chooseCardButton('将“遗计”牌分配给任意角色',true,event.cards,[1,event.cards.length]).set('ai',function(button){
                if(ui.selected.buttons.length==0) return 1;
                return 0;
            });
        }
        else if(event.cards.length==1){
            event._result={links:event.cards.slice(0),bool:true};
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.bool){
            for(var i=0;i<result.links.length;i++){
                event.cards.remove(result.links[i]);
            }
            event.togive=result.links.slice(0);
            player.chooseTarget('将'+get.translation(result.links)+'交给一名角色',true).set('ai',function(target){
                var att=get.attitude(_status.event.player,target);
                if(_status.event.enemy){
                    return -att;
                }
                else if(att>0){
                    return att/(1+target.countCards('h'));
                }
                else{
                    return att/100;
                }
            }).set('enemy',get.value(event.togive[0])<0);
        }
        "step 3"
        if(result.targets.length){
            result.targets[0].gain(event.togive,'draw');
            player.line(result.targets[0],'green');
            game.log(result.targets[0],'获得了'+get.cnNumber(event.togive.length)+'张牌');
            event.goto(1);
        }
    },
                ai:{
                    maixie:true,
                    "maixie_hp":true,
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'damage')){
                    if(player.hasSkillTag('jueqing',false,target)) return [1,-2];
                    if(!target.hasFriend()) return;
                    var num=1;
                    if(get.attitude(player,target)>0){
                        if(player.needsToDiscard()){
                            num=0.7;
                        }
                        else{
                            num=0.5;
                        }
                    }
                    if(target.hp>=4) return [1,num*2];
                    if(target.hp==3) return [1,num*1.5];
                    if(target.hp==2) return [1,num*0.5];
                }
            },
                    },
                },
            },
            longdan:{
                group:["longdan_sha","longdan_shan","longdan_draw"],
                subSkill:{
                    draw:{
                        trigger:{
                            player:["useCard","respond"],
                        },
                        forced:true,
                        popup:false,
                        filter:function (event,player){
                if(!get.zhu(player,'shouyue')) return false;
                return event.skill=='longdan_sha'||event.skill=='longdan_shan';
            },
                        content:function (){
                player.draw();
                player.storage.fanghun2++;
            },
                        sub:true,
                    },
                    sha:{
                        audio:2,
                        enable:["chooseToUse","chooseToRespond"],
                        filterCard:{
                            name:"shan",
                        },
                        viewAs:{
                            name:"sha",
                        },
                        viewAsFilter:function (player){
                if(!player.countCards('h','shan')) return false;
            },
                        prompt:"将一张闪当杀使用或打出",
                        check:function (){return 1},
                        ai:{
                            effect:{
                                target:function (card,player,target,current){
                        if(get.tag(card,'respondSha')&&current<0) return 0.6
                    },
                            },
                            respondSha:true,
                            skillTagFilter:function (player){
                    if(!player.countCards('h','shan')) return false;
                },
                            order:function (){
                    return get.order({name:'sha'})+0.1;
                },
                            useful:-1,
                            value:-1,
                            basic:{
                                useful:[5,1],
                                value:[5,1],
                            },
                            result:{
                                target:function (player,target){
                            if(player.hasSkill('jiu')&&!target.getEquip('baiyin')){
                                if(get.attitude(player,target)>0){
                                    return -6;
                                }
                                else{
                                    return -3;
                                }
                            }
                            return -1.5;
                        },
                            },
                            tag:{
                                respond:1,
                                respondShan:1,
                                damage:function (card){
                            if(card.nature=='poison') return;
                            return 1;
                        },
                                natureDamage:function (card){
                            if(card.nature) return 1;
                        },
                                fireDamage:function (card,nature){
                            if(card.nature=='fire') return 1;
                        },
                                thunderDamage:function (card,nature){
                            if(card.nature=='thunder') return 1;
                        },
                                poisonDamage:function (card,nature){
                            if(card.nature=='poison') return 1;
                        },
                            },
                        },
                        sub:true,
                    },
                    shan:{
                        audio:2,
                        enable:["chooseToRespond"],
                        filterCard:{
                            name:"sha",
                        },
                        viewAs:{
                            name:"shan",
                        },
                        prompt:"将一张杀当闪打出",
                        check:function (){return 1},
                        viewAsFilter:function (player){
                if(!player.countCards('h','sha')) return false;
            },
                        ai:{
                            respondShan:true,
                            skillTagFilter:function (player){
                    if(!player.countCards('h','sha')) return false;
                },
                            effect:{
                                target:function (card,player,target,current){
                        if(get.tag(card,'respondShan')&&current<0) return 0.6
                    },
                            },
                            order:4,
                            useful:-1,
                            value:-1,
                            basic:{
                                useful:[7,2],
                                value:[7,2],
                            },
                        },
                        sub:true,
                    },
                },
            },
            chongzhen:{
                group:["chongzhen1","chongzhen2"],
                ai:{
                    combo:"longdan",
                    mingzhi:false,
                    effect:{
                        target:function (card,player,target,current){
                if(get.tag(card,'respondShan')||get.tag(card,'respondSha')){
                    if(get.attitude(target,player)<=0){
                        if(current>0) return;
                        if(target.countCards('h')==0) return 1.6;
                        if(target.countCards('h')==1) return 1.2;
                        if(target.countCards('h')==2) return [0.8,0.2,0,-0.2];
                        return [0.4,0.7,0,-0.7];
                    }
                }
            },
                    },
                },
            },
            paoxiao:{
                mod:{
                    cardUsable:function (card,player,num){
            if(card.name=='sha') return Infinity;
        },
                },
                ai:{
                    unequip:true,
                    skillTagFilter:function (player,tag,arg){
            if(!get.zhu(player,'shouyue')) return false;
            if(arg&&arg.name=='sha') return true;
            return false;
        },
                },
            },
            lihun:{
                audio:"ext:异界四国:2",
                enable:"phaseUse",
                usable:1,
                filterTarget:function (card,player,target){
        return player!=target&&target.sex=='male';
    },
                filterCard:true,
                position:"he",
                content:function (){
        player.gain(target.getCards('h'),target);
        target.$give(target.countCards('h'),player);
        player.turnOver();
        player.addSkill('lihun2');
        player.storage.lihun=target;
    },
                check:function (card){return 8-get.value(card)},
                ai:{
                    order:10,
                    result:{
                        player:function (player){
                if(player.classList.contains('turnedover')) return 10;
                return 0;
            },
                        target:function (player,target){
                if(target.countCards('h')>target.hp) return target.hp-target.countCards('h');
                return 0;
            },
                    },
                    threaten:1.5,
                    effect:{
                        target:function (card){
                if(card.name=='guiyoujie') return [0,2];
            },
                    },
                },
            },
            kongcheng:{
                mod:{
                    targetEnabled:function (card,player,target,now){
            if(target.countCards('h')==0){
                if(card.name=='sha'||card.name=='juedou') return false;
            }
        },
                },
                group:"kongcheng1",
                ai:{
                    noh:true,
                    skillTagFilter:function (player,tag){
            if(tag=='noh'){
                if(player.countCards('h')!=1) return false;
            }
        },
                },
            },
            jishe:{
                enable:"phaseUse",
                filter:function (event,player){
        return player.getHandcardLimit()>0;
    },
                init:function (player){
        player.storage.jishe=0;
    },
                usable:20,
                content:function (){
        player.draw();
        player.storage.jishe++;
    },
                ai:{
                    order:10,
                    result:{
                        player:function (player){
                if(!player.needsToDiscard(1)){
                    return 1;
                }
                return 0;
            },
                    },
                },
                mod:{
                    maxHandcard:function (player,num){
            return num-player.storage.jishe;
        },
                },
                group:["jishe2","jishe3"],
            },
            "jishe2":{
                trigger:{
                    player:"phaseAfter",
                },
                silent:true,
                content:function (){
                    player.storage.jishe=0;
                },
            },
            "jishe3":{
                trigger:{
                    player:"phaseEnd",
                },
                direct:true,
                filter:function (event,player){
                    if(player.countCards('h')) return false;
                    return game.hasPlayer(function(current){
                        return !current.isLinked();
                    });
                },
                content:function (){
                    "step 0"
                    var num=game.countPlayer(function(current){
                        return !current.isLinked();
                    });
                    player.chooseTarget(get.prompt("jishe"),[1,Math.min(num,player.hp)],function(card,player,target){
                        return !target.isLinked();
                    }).set('ai',function(target){
                        return -get.attitude(_status.event.player,target);
                    });
                    "step 1"
                    if(result.bool){
                        player.logSkill("jishe",result.targets);
                        event.targets=result.targets;
                        event.num=0;
                    }
                    else{
                        event.finish();
                    }
                    "step 2"
                    if(event.num<event.targets.length){
                        event.targets[event.num].link();
                        event.num++;
                        event.redo();
                    }
                },
                ai:{
                    expose:0.3,
                },
            },
            luoyi:{
                audio:"reluoyi",
                trigger:{
                    player:"phaseDrawBegin",
                },
                content:function (){
        "step 0"
        player.addTempSkill('ol_reluoyi_1',{player:'phaseBefore'});
        trigger.untrigger();
        trigger.finish();
        "step 1"
        event.cards=get.cards(3);
        player.showCards(event.cards,'裸衣');
        "step 2"
        for(var i=0;i<cards.length;i++){
            if(get.type(cards[i])!='basic'&&cards[i].name!='juedou'&&
                (get.type(cards[i])!='equip'||get.subtype(cards[i])!='equip1')){
                ui.discardPile.appendChild(cards[i]);
                cards.splice(i--,1);
            }
        }
        player.gain(cards,'gain2');
    },
                subSkill:{
                    "1":{
                        audio:false,
                        trigger:{
                            source:"damageBegin",
                        },
                        mark:true,
                        intro:{
                            content:"直到你的下回合开始，你为伤害来源的【杀】或【决斗】造成的伤害+1。",
                        },
                        filter:function (event){
                return event.card&&(event.card.name=='sha'||event.card.name=='juedou')&&event.notLink();
            },
                        forced:true,
                        content:function (){
                trigger.num++;
            },
                        sub:true,
                    },
                },
            },
            biyue:{
                audio:"biyue",
                trigger:{
                    player:"phaseEnd",
                },
                frequent:true,
                alter:true,
                content:function (){
        var num=1;
        if(get.is.altered('xinbiyue')&&!player.countCards('h')){
            num=2;
        }
        player.draw(num);
    },
            },
            yongsi:{
                group:["xinyongsi1","xinyongsi2"],
            },
            shangshi:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:["loseEnd","changeHp"],
                },
                forced:true,
                filter:function (event,player){
        return (player.countCards('h')<Math.min(3,player.maxHp-player.hp));
    },
                content:function (){
        player.draw(Math.min(3,player.maxHp-player.hp)-player.countCards('h'));
    },
                ai:{
                    noh:true,
                    skillTagFilter:function (player,tag){
            if(tag=='noh'&&player.maxHp-player.hp<player.countCards('h')){
                return false;
            }
        },
                },
            },
            zaiqi:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"phaseDrawBefore",
                },
                filter:function (event,player){
        return player.hp<player.maxHp;
    },
                check:function (event,player){
        if(player.maxHp-player.hp<2){
            return false;
        }
        else if(player.maxHp-player.hp==2){
            return player.countCards('h')>=2;
        }
        return true;
    },
                content:function (){
        "step 0"
        trigger.cancel();
        event.cards=get.cards(player.maxHp-player.hp);
        player.showCards(event.cards);
        "step 1"
        var num=0;
        for(var i=0;i<event.cards.length;i++){
            if(get.suit(event.cards[i])=='heart'){
                num++;
                event.cards[i].discard();
                event.cards.splice(i--,1);
            }
        }
        if(num){
            player.recover(num);
        }
        "step 2"
        if(event.cards.length){
            player.gain(event.cards);
            player.$gain2(event.cards);
            game.delay();
        }
    },
                ai:{
                    threaten:function (player,target){
            if(target.hp==1) return 2;
            if(target.hp==2) return 1.5;
            return 1;
        },
                },
            },
            benghuai:{
                audio:"ext:异界四国:4",
                trigger:{
                    player:"phaseEnd",
                },
                forced:true,
                check:function (){
        return false;
    },
                filter:function (event,player){
        return !player.isMinHp();
    },
                content:function (){
        "step 0"
        player.chooseControl('baonue_hp','baonue_maxHp',function(event,player){
            if(player.hp==player.maxHp) return 'baonue_hp';
            if(player.hp<player.maxHp-1||player.hp<=2) return 'baonue_maxHp';
            return 'baonue_hp';
        });
        "step 1"
        if(result.control=='baonue_hp'){
            player.loseHp();
        }
        else{
            player.loseMaxHp(true);
        }
    },
                ai:{
                    threaten:0.5,
                    neg:true,
                },
            },
            roulin:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"shaBegin",
                    target:"shaBegin",
                },
                forced:true,
                filter:function (event,player){
        if(event.directHit) return false;
        if(player==event.player){
            return event.target.sex=='female';
        }
        return event.player.sex=='female';
    },
                check:function (event,player){
        return player==event.player;
    },
                priority:-1,
                content:function (){
        if(typeof trigger.shanRequired=='number'){
            trigger.shanRequired++;
        }
        else{
            trigger.shanRequired=2;
        }
    },
            },
            qice:{
                enable:"phaseUse",
                usable:1,
                audio:"ext:异界四国:2",
                filter:function (event,player){
        return player.countCards('h')>0
    },
                chooseButton:{
                    dialog:function (){
            var list=['taoyuan','wugu','juedou','huogong','jiedao','tiesuo','guohe','shunshou','wuzhong','wanjian','nanman'];
            for(var i=0;i<list.length;i++){
                list[i]=['锦囊','',list[i]];
            }
            return ui.create.dialog(get.translation('qice'),[list,'vcard']);
        },
                    filter:function (button,player){
            return lib.filter.filterCard({name:button.link[2]},player,_status.event.getParent());
        },
                    check:function (button){
            var player=_status.event.player;
            var recover=0,lose=1,players=game.filterPlayer();
            for(var i=0;i<players.length;i++){
                if(players[i].hp==1&&get.damageEffect(players[i],player,player)>0&&!players[i].hasSha()){
                    return (button.link[2]=='juedou')?2:-1;
                }
                if(!players[i].isOut()){
                    if(players[i].hp<players[i].maxHp){
                        if(get.attitude(player,players[i])>0){
                            if(players[i].hp<2){
                                lose--;
                                recover+=0.5;
                            }
                            lose--;
                            recover++;
                        }
                        else if(get.attitude(player,players[i])<0){
                            if(players[i].hp<2){
                                lose++;
                                recover-=0.5;
                            }
                            lose++;
                            recover--;
                        }
                    }
                    else{
                        if(get.attitude(player,players[i])>0){
                            lose--;
                        }
                        else if(get.attitude(player,players[i])<0){
                            lose++;
                        }
                    }
                }
            }
            if(lose>recover&&lose>0) return (button.link[2]=='nanman')?1:-1;
            if(lose<recover&&recover>0) return (button.link[2]=='taoyuan')?1:-1;
            return (button.link[2]=='wuzhong')?1:-1;
        },
                    backup:function (links,player){
            return {
                filterCard:true,
                selectCard:-1,
                audio:2,
                popname:true,
                viewAs:{name:links[0][2]},
            }
        },
                    prompt:function (links,player){
            return '将全部手牌当作'+get.translation(links[0][2])+'使用';
        },
                },
                ai:{
                    order:1,
                    result:{
                        player:function (player){
                var num=0;
                var cards=player.getCards('h');
                if(cards.length>=3&&player.hp>=3) return 0;
                for(var i=0;i<cards.length;i++){
                    num+=Math.max(0,get.value(cards[i],player,'raw'));
                }
                num/=cards.length;
                num*=Math.min(cards.length,player.hp);
                return 12-num;
            },
                    },
                    threaten:1.6,
                },
            },
            huituo:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"damageEnd",
                },
                direct:true,
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('huituo')).set('ai',function(target){
            var player=_status.event.player;
            if(get.attitude(player,target)>0){
                return get.recoverEffect(target,player,player)+1;
            }
            return 0;
        });
        'step 1'
        if(result.bool){
            player.logSkill('huituo',result.targets);
            var target=result.targets[0];
            event.target=target;
            target.judge(function(card){
                if(target.hp==target.maxHp){
                    if(get.color(card)=='red') return -1;
                }
                if(get.color(card)=='red') return 1;
                return 0;
            });
        }
        else{
            event.finish();
        }
        'step 2'
        if(result.color){
            if(result.color=='red'){
                if(event.target.hp<event.target.maxHp) event.target.recover();
            }
            else{
                event.target.draw(trigger.num);
            }
        }
    },
                ai:{
                    maixie:true,
                    "maixie_hp":true,
                },
            },
            juxiang:{
                unique:true,
                locked:true,
                group:["juxiang1","juxiang2"],
                ai:{
                    effect:{
                        target:function (card){
                if(card.name=='nanman') return [0,1];
            },
                    },
                },
            },
            lieren:{
                audio:"ext:异界四国:2",
                trigger:{
                    source:"damageEnd",
                },
                filter:function (event,player){
        if(event._notrigger.contains(event.player)) return false;
        return (event.card&&event.card.name=='sha'&&
            event.player.classList.contains('dead')==false&&
            event.player.countCards('h')&&player.countCards('h'))&&event.player!=player;
    },
                check:function (event,player){
        return get.attitude(player,event.player)<0&&player.countCards('h')>1;
    },
                priority:5,
                content:function (){
        "step 0"
        player.chooseToCompare(trigger.player);
        "step 1"
        if(result.bool&&trigger.player.countGainableCards(player,'he')){
            player.gainPlayerCard(trigger.player,true,'he');
        }
    },
            },
            qixi:{
                audio:"ext:异界四国:4",
                enable:"chooseToUse",
                filterCard:function (card){
        return get.color(card)=='black';
    },
                position:"he",
                viewAs:{
                    name:"guohe",
                },
                viewAsFilter:function (player){
        if(!player.countCards('he',{color:'black'})) return false;
    },
                prompt:"将一张黑色牌当过河拆桥使用",
                check:function (card){return 4-get.value(card)},
                ai:{
                    basic:{
                        order:9,
                        useful:1,
                        value:5,
                    },
                    result:{
                        target:function (player,target){
                            var att=get.attitude(player,target);
                            var nh=target.countCards('h');
                            if(att>0){
                                var js=target.getCards('j');
                                if(js.length){
                                    var jj=js[0].viewAs?{name:js[0].viewAs}:js[0];
                                    if(jj.name=='guohe'||js.length>1||get.effect(target,jj,target,player)<0){
                                        return 3;
                                    }
                                }
                                if(target.getEquip('baiyin')&&target.isDamaged()&&
                                    get.recoverEffect(target,player,player)>0){
                                    if(target.hp==1&&!target.hujia) return 1.6;
                                    if(target.hp==2) return 0.01;
                                    return 0;
                                }
                            }
                            var es=target.getCards('e');
                            var noe=(es.length==0||target.hasSkillTag('noe'));
                            var noe2=(es.length==1&&es[0].name=='baiyin'&&target.isDamaged());
                            var noh=(nh==0||target.hasSkillTag('noh'));
                            if(noh&&(noe||noe2)) return 0;
                            if(att<=0&&!target.countCards('he')) return 1.5;
                            return -1.5;
                        },
                    },
                    tag:{
                        loseCard:1,
                        discard:1,
                    },
                },
            },
            luoshen:{
                audio:"luoshen",
                alter:true,
                trigger:{
                    player:"phaseBegin",
                },
                frequent:true,
                content:function (){
        "step 0"
        if(event.cards==undefined) event.cards=[];
        player.judge(function(card){
            if(get.color(card)=='black') return 1.5;
            return -1.5;
        },ui.special);
        "step 1"
        if(result.judge>0){
            event.cards.push(result.card);
            if(lib.config.autoskilllist.contains('luoshen')){
                player.chooseBool('是否再次发动【洛神】？');
            }
            else{
                event._result={bool:true};
            }
        }
        else{
            for(var i=0;i<event.cards.length;i++){
                if(get.position(event.cards[i])!='s'){
                    event.cards.splice(i,1);i--;
                }
            }
            player.gain(event.cards,'gain2');
            player.storage.xinluoshen=event.cards.slice(0);
            event.finish();
        }
        "step 2"
        if(result.bool){
            event.goto(0);
        }
        else{
            if(event.cards.length){
                player.gain(event.cards,'gain2');
                player.storage.xinluoshen=event.cards.slice(0);
            }
        }
    },
                mod:{
                    ignoredHandcard:function (card,player){
            if(get.is.altered('xinluoshen')&&player.storage.xinluoshen&&player.storage.xinluoshen.contains(card)){
                return true;
            }
        },
                },
                group:"xinluoshen_clear",
                subSkill:{
                    clear:{
                        trigger:{
                            player:"phaseAfter",
                        },
                        silent:true,
                        content:function (){
                delete player.storage.xinluoshen;
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                },
            },
            guicai:{
                audio:"ext:异界四国:2",
                trigger:{
                    global:"judge",
                },
                direct:true,
                filter:function (event,player){
        return player.countCards('h')>0;
    },
                content:function (){
        "step 0"
        player.chooseCard(get.translation(trigger.player)+'的'+(trigger.judgestr||'')+'判定为'+
        get.translation(trigger.player.judging[0])+'，'+get.prompt('guicai')).set('ai',function(card){
            var trigger=_status.event.getTrigger();
            var player=_status.event.player;
            var judging=_status.event.judging;
            var result=trigger.judge(card)-trigger.judge(judging);
            var attitude=get.attitude(player,trigger.player);
            if(attitude==0||result==0) return 0;
            if(attitude>0){
                return result-get.value(card)/2;
            }
            else{
                return -result-get.value(card)/2;
            }
        }).set('judging',trigger.player.judging[0]);
        "step 1"
        if(result.bool){
            player.respond(result.cards,'highlight');
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.bool){
            player.logSkill('guicai');
            if(trigger.player.judging[0].clone){
                trigger.player.judging[0].clone.classList.remove('thrownhighlight');
                game.broadcast(function(card){
                    if(card.clone){
                        card.clone.classList.remove('thrownhighlight');
                    }
                },trigger.player.judging[0]);
                game.addVideo('deletenode',player,get.cardsInfo([trigger.player.judging[0].clone]));
            }
            trigger.player.judging[0].discard();
            trigger.player.judging[0]=result.cards[0];
            if(!get.owner(result.cards[0],'judge')){
                trigger.position.appendChild(result.cards[0]);
            }
            game.log(trigger.player,'的判定牌改为',result.cards[0]);
            game.delay(2);
        }
    },
                ai:{
                    tag:{
                        rejudge:1,
                    },
                },
            },
            shibei:{
                trigger:{
                    player:"damageEnd",
                },
                forced:true,
                audio:"ext:异界四国:2",
                content:function (){
        if(player.hasSkill('shibei_damaged')){
            player.loseHp();
        }
        else{
            player.recover();
        }
    },
                group:"shibei_mark",
                subSkill:{
                    mark:{
                        trigger:{
                            player:"damageAfter",
                        },
                        silent:true,
                        content:function (){
                player.addTempSkill('shibei_damaged');
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                    damaged:{
                        sub:true,
                    },
                    ai:{
                        sub:true,
                    },
                },
                ai:{
                    "maixie_defend":true,
                    threaten:0.9,
                    effect:{
                        target:function (card,player,target){
                if(player.hasSkillTag('jueqing')) return;
                if(target.hujia) return;
                if(player._shibei_tmp) return;
                if(target.hasSkill('shibei_ai')) return;
                if(_status.event.getParent('useCard',true)||_status.event.getParent('_wuxie',true)) return;
                if(get.tag(card,'damage')){
                    if(target.hasSkill('shibei_damaged')){
                        return [1,-2];
                    }
                    else{
                        if(get.attitude(player,target)>0&&target.hp>1){
                            return 0;
                        }
                        if(get.attitude(player,target)<0&&!player.hasSkillTag('damageBonus')){
                            if(card.name=='sha') return;
                            var sha=false;
                            player._shibei_tmp=true;
                            var num=player.countCards('h',function(card){
                                if(card.name=='sha'){
                                    if(sha){
                                        return false;
                                    }
                                    else{
                                        sha=true;
                                    }
                                }
                                return get.tag(card,'damage')&&player.canUse(card,target)&&get.effect(target,card,player,player)>0;
                            });
                            delete player._shibei_tmp;
                            if(player.hasSkillTag('damage')){
                                num++;
                            }
                            if(num<2){
                                var enemies=player.getEnemies();
                                if(enemies.length==1&&enemies[0]==target&&player.needsToDiscard()){
                                    return;
                                }
                                return 0;
                            }
                        }
                    }
                }
            },
                    },
                },
            },
            qingxian:{
                group:["qingxian_jilie","qingxian_rouhe"],
                ai:{
                    threaten:0.8,
                    maixie:true,
                    "maixie_hp":true,
                    "maixie_defend":true,
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'damage')){
                    if(target.hp>1&&target.hasFriend()) return 0.8;
                }
            },
                    },
                },
                subSkill:{
                    rouhe:{
                        trigger:{
                            player:"recoverEnd",
                        },
                        direct:true,
                        content:function (){
                'step 0'
                player.chooseTarget(get.prompt('qingxian'),function(card,player,target){
                    return target!=player;
                }).set('ai',function(target){
                    var att=get.attitude(_status.event.player,target);
                    if(target.isHealthy()&&att>0) return 0;
                    if(target.hp==1&&att!=0){
                        if(att>0) return 9;
                        else return 10;
                    }
                    else{
                        return Math.sqrt(Math.abs(att));
                    }
                }).set('prompt2','当你回复体力后，你可以令一名其他角色执行一项：失去1点体力，随机使用一张装备牌；回复1点体力，弃置一张装备牌。若其以此法使用或弃置的牌为梅花，你回复1点体力');
                'step 1'
                if(result.bool){
                    var target=result.targets[0];
                    player.logSkill('qingxian',target);
                    event.insert(lib.skill.qingxian.content_choose,{target:target,player:player});

                }
            },
                        sub:true,
                    },
                    jilie:{
                        trigger:{
                            player:"damageEnd",
                        },
                        filter:function (event,player){
                return event.source&&event.source.isIn()&&event.source!=player;
            },
                        check:function (event,player){
                if(get.attitude(player,event.source)>0&&event.source.isHealthy()){
                    return false;
                }
                return true;
            },
                        logTarget:"source",
                        "prompt2":"当你受到伤害后，你可以令伤害来源执行一项：失去1点体力，随机使用一张装备牌；回复1点体力，弃置一张装备牌。若其以此法使用或弃置的牌为梅花，你回复1点体力",
                        content:function (){
                event.insert(lib.skill.qingxian.content_choose,{target:trigger.source,player:player});
            },
                        sub:true,
                    },
                },
                "content_choose":function (){
        'step 0'
        var index;
        if(get.attitude(player,target)>0){
            if(target.isHealthy()){
                index=0;
            }
            else{
                index=1;
            }
        }
        else{
            if(target.isHealthy()&&target.countCards('e')){
                index=1;
            }
            else{
                index=0;
            }
        }
        player.chooseControlList(
            ['令'+get.translation(target)+'失去1点体力，随机使用一张装备牌',
            '令'+get.translation(target)+'回复1点体力，弃置一张装备牌'],
            true,function(event,player){
            return _status.event.index;
        }).set('index',index);
        'step 1'
        if(result.index==0){
            target.loseHp();
            event.card=get.cardPile(function(card){
                return get.type(card)=='equip';
            });
            if(event.card){
                target.equip(event.card,true).set('delay',true);
                event.goto(3);
            }
            else{
                event.finish();
            }
        }
        else{
            target.recover();
            if(target.countCards('he',{type:'equip'})){
                target.chooseToDiscard('he',true,'弃置一张装备牌',function(card){
                    return get.type(card)=='equip';
                }).set('ai',function(card){
                    var val=-get.value(card);
                    if(get.suit(card)=='club'){
                        val+=_status.event.att*10;
                    }
                    return val;
                }).set('att',get.sgnAttitude(target,player));
            }
            else{
                event.finish();
            }
        }
        'step 2'
        if(result&&result.cards){
            event.card=result.cards[0];
        }
        'step 3'
        if(event.card&&get.suit(event.card)=='club'){
            player.recover();
        }
    },
            },
            jiushi:{
                group:["jiushi1","jiushi2","jiushi3"],
            },
            jianxiong:{
                audio:"jianxiong",
                alter:true,
                trigger:{
                    player:"damageEnd",
                },
                filter:function (event,player){
        return get.itemtype(event.cards)=='cards'&&get.position(event.cards[0])=='d';
    },
                content:function (){
        player.gain(trigger.cards);
        player.$gain2(trigger.cards);
        if(get.is.altered('xinjianxiong')){
            player.draw();
        }
    },
                ai:{
                    maixie:true,
                    "maixie_hp":true,
                    effect:{
                        target:function (card,player,target){
                if(player.hasSkillTag('jueqing',false,target)) return [1,-1];
                if(get.tag(card,'damage')) return [1,0.55];
            },
                    },
                },
            },
            ganglie:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"damageEnd",
                },
                filter:function (event,player){
        return (event.source!=undefined);
    },
                check:function (event,player){
        return (get.attitude(player,event.source)<=0);
    },
                logTarget:"source",
                content:function (){
        "step 0"
        player.judge(function(card){
            if(get.suit(card)=='heart') return -2;
            return 2;
        })
        "step 1"
        if(result.judge<2){
            event.finish();return;
        }
        trigger.source.chooseToDiscard(2).set('ai',function(card){
            if(card.name=='tao') return -10;
            if(card.name=='jiu'&&_status.event.player.hp==1) return -10;
            return get.unuseful(card)+2.5*(5-get.owner(card).hp);
        });
        "step 2"
        if(result.bool==false){
            trigger.source.damage();
        }
    },
                ai:{
                    "maixie_defend":true,
                    effect:{
                        target:function (card,player,target){
                if(player.hasSkillTag('jueqing',false,target)) return [1,-1];
                return 0.8;
                // if(get.tag(card,'damage')&&get.damageEffect(target,player,player)>0) return [1,0,0,-1.5];
            },
                    },
                },
            },
            releiji:{
                audio:"ext:异界四国:2",
                audioname:["boss_qinglong"],
                trigger:{
                    player:"respond",
                },
                filter:function (event,player){
        return event.card.name=='shan';
    },
                direct:true,
                content:function (){
        "step 0";
        player.chooseTarget(get.prompt('releiji')).ai=function(target){
            if(target.hasSkill('hongyan')) return 0;
            return get.damageEffect(target,_status.event.player,_status.event.player,'thunder');
        };
        "step 1"
        if(result.bool){
            player.logSkill('releiji',result.targets,'thunder');
            event.target=result.targets[0];
            event.target.judge(function(card){
                var suit=get.suit(card);
                if(suit=='spade') return -4;
                if(suit=='club') return -2;
                return 0;
            });
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.suit=='club'){
            event.target.damage('thunder');
            player.recover();
        }
        else if(result.suit=='spade'){
            event.target.damage(2,'thunder');
        }
    },
                ai:{
                    useShan:true,
                    effect:{
                        target:function (card,player,target,current){
                if(get.tag(card,'respondShan')){
                    var hastarget=game.hasPlayer(function(current){
                        return get.attitude(target,current)<0;
                    });
                    var be=target.countCards('e',{color:'black'});
                    if(target.countCards('h','shan')&&be){
                        if(!target.hasSkill('guidao')) return 0;
                        return [0,hastarget?target.countCards('he')/2:0];
                    }
                    if(target.countCards('h','shan')&&target.countCards('h')>2){
                        if(!target.hasSkill('guidao')) return 0;
                        return [0,hastarget?target.countCards('h')/4:0];
                    }
                    if(target.countCards('h')>3||(be&&target.countCards('h')>=2)){
                        return [0,0];
                    }
                    if(target.countCards('h')==0){
                        return [1.5,0];
                    }
                    if(target.countCards('h')==1&&!be){
                        return [1.2,0];
                    }
                    if(!target.hasSkill('guidao')) return [1,0.05];
                    return [1,Math.min(0.5,(target.countCards('h')+be)/4)];
                }
            },
                    },
                },
            },
            guidao:{
                audio:"ext:异界四国:2",
                trigger:{
                    global:"judge",
                },
                filter:function (event,player){
        return player.countCards('he',{color:'black'})>0;
    },
                direct:true,
                content:function (){
        "step 0"
        player.chooseCard(get.translation(trigger.player)+'的'+(trigger.judgestr||'')+'判定为'+
        get.translation(trigger.player.judging[0])+'，'+get.prompt('guidao'),'he',function(card){
            return get.color(card)=='black';
        }).set('ai',function(card){
            var trigger=_status.event.getTrigger();
            var player=_status.event.player;
            var judging=_status.event.judging;
            var result=trigger.judge(card)-trigger.judge(judging);
            var attitude=get.attitude(player,trigger.player);
            if(attitude==0||result==0) return 0;
            if(attitude>0){
                return result;
            }
            else{
                return -result;
            }
        }).set('judging',trigger.player.judging[0]);
        "step 1"
        if(result.bool){
            player.respond(result.cards,'highlight');
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.bool){
            player.logSkill('guidao');
            player.$gain2(trigger.player.judging[0]);
            player.gain(trigger.player.judging[0]);
            trigger.player.judging[0]=result.cards[0];
            if(!get.owner(result.cards[0],'judge')){
                trigger.position.appendChild(result.cards[0]);
            }
            game.log(trigger.player,'的判定牌改为',result.cards[0]);
        }
        "step 3"
        game.delay(2);
    },
                ai:{
                    tag:{
                        rejudge:1,
                    },
                },
            },
            weijing:{
                group:["weijing_sha","weijing_shan"],
                subSkill:{
                    sha:{
                        enable:"chooseToUse",
                        viewAs:{
                            name:"sha",
                        },
                        filterCard:function (){return false},
                        viewAsFilter:function (player){
                if(player.hasSkill('weijing_disable')) return false;
            },
                        selectCard:-1,
                        mark:false,
                        precontent:function (){
                player.addTempSkill('weijing_disable','roundStart');
            },
                        prompt:"视为使用一张杀",
                        ai:{
                            order:function (){
                    var player=_status.event.player;
                    if(!player.hasShan()&&!game.hasPlayer(function(current){
                        return player.canUse('sha',current)&&current.hp==1&&get.effect(current,{name:'sha'},player,player)>0;
                    })){
                        return 0;
                    }
                    return 2.95;
                },
                            skillTagFilter:function (player,tag,arg){
                    if(player.hasSkill('weijing_disable')) return false;
                    if(arg!='use') return false;
                },
                            respondSha:true,
                            basic:{
                                useful:[5,1],
                                value:[5,1],
                            },
                            result:{
                                target:function (player,target){
                            if(player.hasSkill('jiu')&&!target.getEquip('baiyin')){
                                if(get.attitude(player,target)>0){
                                    return -6;
                                }
                                else{
                                    return -3;
                                }
                            }
                            return -1.5;
                        },
                            },
                            tag:{
                                respond:1,
                                respondShan:1,
                                damage:function (card){
                            if(card.nature=='poison') return;
                            return 1;
                        },
                                natureDamage:function (card){
                            if(card.nature) return 1;
                        },
                                fireDamage:function (card,nature){
                            if(card.nature=='fire') return 1;
                        },
                                thunderDamage:function (card,nature){
                            if(card.nature=='thunder') return 1;
                        },
                                poisonDamage:function (card,nature){
                            if(card.nature=='poison') return 1;
                        },
                            },
                        },
                        sub:true,
                    },
                    shan:{
                        enable:"chooseToRespond",
                        viewAs:{
                            name:"shan",
                        },
                        mark:false,
                        filterCard:function (){return false},
                        viewAsFilter:function (player){
                if(player.hasSkill('weijing_disable')) return false;
                if(!lib.filter.cardRespondable({name:'sha'},player)) return false;
            },
                        onrespond:function (event,player){
                player.addTempSkill('weijing_disable','roundStart');
            },
                        selectCard:-1,
                        prompt:"视为使用一张闪",
                        ai:{
                            order:function (){
                    if(player.hasSkill('qingzhong_give')) return 2.95;
                    return 3.15;
                },
                            skillTagFilter:function (player){
                    if(player.hasSkill('weijing_disable')) return false;
                    if(!lib.filter.cardRespondable({name:'sha'},player)) return false;
                },
                            respondShan:true,
                            basic:{
                                useful:[7,2],
                                value:[7,2],
                            },
                        },
                        sub:true,
                    },
                    disable:{
                        mark:true,
                        intro:{
                            content:"本轮已发动",
                        },
                        sub:true,
                    },
                },
            },
            jiang:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:["shaBefore","juedouBefore"],
                    target:["shaBefore","juedouBefore"],
                },
                filter:function (event,player){
        if(event.card.name=='juedou') return true;
        return get.color(event.card)=='red';
    },
                frequent:true,
                content:function (){
        player.draw();
    },
                ai:{
                    effect:{
                        target:function (card,player,target){
                if(card.name=='sha'&&get.color(card)=='red') return [1,0.6];
            },
                        player:function (card,player,target){
                if(card.name=='sha'&&get.color(card)=='red') return [1,1];
            },
                    },
                },
            },
            yingzi:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"phaseDrawBegin",
                },
                frequent:true,
                content:function (){
        trigger.num++;
    },
                ai:{
                    threaten:1.3,
                },
            },
            tianyi:{
                audio:"ext:异界四国:2",
                enable:"phaseUse",
                usable:1,
                filterTarget:function (card,player,target){
        return player!=target&&target.countCards('h')>0;
    },
                filter:function (event,player){
        return player.countCards('h')>0;
    },
                content:function (){
        "step 0"
        player.chooseToCompare(target);
        "step 1"
        if(result.bool){
            player.addTempSkill('tianyi2');
        }
        else{
            player.addTempSkill('tianyi3');
        }
    },
                ai:{
                    order:function (name,player){
            var cards=player.getCards('h');
            if(player.countCards('h','sha')==0){
                return 1;
            }
            for(var i=0;i<cards.length;i++){
                if(cards[i].name!='sha'&&cards[i].number>11&&get.value(cards[i])<7){
                    return 9;
                }
            }
            return get.order({name:'sha'})-1;
        },
                    result:{
                        player:function (player){
                if(player.countCards('h','sha')>0) return 0.6;
                var num=player.countCards('h');
                if(num>player.hp) return 0;
                if(num==1) return -2;
                if(num==2) return -1;
                return -0.7;
            },
                        target:function (player,target){
                var num=target.countCards('h');
                if(num==1) return -1;
                if(num==2) return -0.7;
                return -0.5
            },
                    },
                    threaten:1.3,
                },
            },
            yinghun:{
                audio:"ext:异界四国:2",
                audioname:["sunce"],
                trigger:{
                    player:"phaseBegin",
                },
                filter:function (event,player){
        return player.hp<player.maxHp;
    },
                direct:true,
                content:function (){
        "step 0"
        player.chooseTarget(get.prompt('yinghun'),function(card,player,target){
            return player!=target;
        }).set('ai',function(target){
            var player=_status.event.player;
            if(player.maxHp-player.hp==1&&target.countCards('he')==0){
                return 0;
            }
            if(get.attitude(_status.event.player,target)>0){
                return 10+get.attitude(_status.event.player,target);
            }
            if(player.maxHp-player.hp==1){
                return -1;
            }
            return 1;
        });
        "step 1"
        if(result.bool){
            event.num=player.maxHp-player.hp;
            if(player.countCards('e')>=player.hp){
                event.num=player.maxHp;
            }
            player.logSkill('yinghun',result.targets);
            event.target=result.targets[0];
            if(event.num==1){
                event.directcontrol=true;
            }
            else{
                var str1='摸'+get.cnNumber(event.num,true)+'弃一';
                var str2='摸一弃'+get.cnNumber(event.num,true);
                player.chooseControl(str1,str2,function(event,player){
                    return _status.event.choice;
                }).set('choice',get.attitude(player,event.target)>0?str1:str2);
                event.str=str1;
            }
        }
        else{
            event.finish();
        }
        "step 2"
        if(event.directcontrol||result.control==event.str){
            event.target.draw(event.num);
            event.target.chooseToDiscard(true,'he');
        }
        else{
            event.target.draw();
            event.target.chooseToDiscard(event.num,true,'he');
        }
    },
                ai:{
                    threaten:function (player,target){
            if(target.hp==1||target.countCards('e')>=target.hp) return 2;
            if(target.hp==target.maxHp) return 0.5;
            if(target.hp==2) return 1.5;
            return 0.5;
        },
                    maixie:true,
                    effect:{
                        target:function (card,player,target){
                if(target.maxHp<=3) return;
                if(get.tag(card,'damage')){
                    if(target.hp==target.maxHp) return [0,1];
                }
                if(get.tag(card,'recover')&&player.hp>=player.maxHp-1) return [0,0];
            },
                    },
                },
            },
            xiaoji:{
                audio:"ext:异界四国:4",
                trigger:{
                    player:"loseEnd",
                },
                frequent:true,
                filter:function (event,player){
        for(var i=0;i<event.cards.length;i++){
            if(event.cards[i].original=='e') return true;
        }
        return false;
    },
                content:function (){
        var num=0;
        for(var i=0;i<trigger.cards.length;i++){
            if(trigger.cards[i].original=='e') num+=2;
        }
        player.draw(num);
    },
                ai:{
                    noe:true,
                    reverseEquip:true,
                    effect:{
                        target:function (card,player,target,current){
                if(get.type(card)=='equip') return [1,3];
            },
                    },
                },
            },
            baobian:{
                trigger:{
                    player:["phaseBefore","changeHp"],
                },
                forced:true,
                popup:false,
                unique:true,
                derivation:["tiaoxin","paoxiao","xinshensu"],
                content:function (){
        player.removeAdditionalSkill('baobian');
        var list=[];
        if(player.hp<=3){
            list.push('tiaoxin');
        }
        if(player.hp<=2){
            list.push('paoxiao');
        }
        if(player.hp<=1){
            list.push('xinshensu');
        }
        if(list.length){
            player.addAdditionalSkill('baobian',list);
        }
    },
                ai:{
                    maixie:true,
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'damage')){
                    if(!target.hasFriend()) return;
                    if(target.hp>=4) return [0,1];
                }
                if(get.tag(card,'recover')&&player.hp>=player.maxHp-1) return [0,0];
            },
                    },
                },
            },
            kaikang:{
                audio:"ext:异界四国:2",
                trigger:{
                    global:"shaBegin",
                },
                filter:function (event,player){
        return get.distance(player,event.target)<=1;
    },
                check:function (event,player){
        return get.attitude(player,event.target)>=0;
    },
                content:function (){
        "step 0"
        player.draw();
        if(trigger.target!=player){
            player.chooseCard(true,'he','交给'+get.translation(trigger.target)+'一张牌').set('ai',function(card){
                if(get.position(card)=='e') return -1;
                if(card.name=='shan') return 1;
                if(get.type(card)=='equip') return 0.5;
                return 0;
            });
        }
        else{
            event.finish();
        }
        "step 1"
        trigger.target.gain(result.cards,player);
        player.$give(result.cards,trigger.target);
        game.delay();
        event.card=result.cards[0];
        if(get.type(event.card)!='equip') event.finish();
        "step 2"
        if(!trigger.target.isMin()){
            trigger.target.chooseBool('是否装备'+get.translation(event.card)+'？').set('ai',function(){
                var current=_status.event.player.getCards('e',{subtype:get.subtype(_status.event.card)});
                if(current&&current.length){
                    return get.equipValue(event.card)>get.equipValue(current[0]);
                }
                return true;
            }).set('card',event.card);
        }
        else{
            event.finish();
        }
        "step 3"
        if(result.bool){
            trigger.target.equip(event.card);
        }
    },
                ai:{
                    threaten:1.1,
                },
            },
            tiandu:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"judgeEnd",
                },
                frequent:function (event){
        if(event.result.card.name=='du') return false;
        if(get.mode()=='guozhan') return false;
        return true;
    },
                check:function (event){
        if(event.result.card.name=='du') return false;
        return true;
    },
                filter:function (event,player){
        if(get.owner(event.result.card)){
            return false;
        }
        if(event.nogain&&event.nogain(event.result.card)){
            return false;
        }
        return true;
    },
                content:function (){
        player.gain(trigger.result.card);
        player.$gain2(trigger.result.card);
    },
            },
            benxi:{
                mod:{
                    globalFrom:function (from,to,distance){
            if(_status.currentPhase==from){
                return distance-from.countUsed();
            }
        },
                    selectTarget:function (card,player,range){
            if(_status.currentPhase==player){
                if(card.name=='sha'&&range[1]!=-1){
                    if(!game.hasPlayer(function(current){
                        return get.distance(player,current)>1;
                    })){
                        range[1]++;
                    }
                }
            }
        },
                },
                ai:{
                    unequip:true,
                    skillTagFilter:function (player){
            if(game.hasPlayer(function(current){
                return get.distance(player,current)>1;
            })){
                return false;
            }
        },
                },
            },
            fuqi:{
                mod:{
                    wuxieRespondable:function (card,player,target,current){
            if(player!=current&&get.distance(player,current)<=1){
                return false;
            }
        },
                },
                ai:{
                    norespond:true,
                    skillTagFilter:function (player,tag,arg){
            if(tag=='norespond'&&Array.isArray(arg)){
                if(get.distance(arg[1],player)<=1) return true;
            }
            return false;
        },
                },
            },
            jiaozi:{
                trigger:{
                    player:"damageBegin",
                    source:"damageBegin",
                },
                forced:true,
                filter:function (event,player){
        return player.isMaxHandcard(true);
    },
                content:function (){
        trigger.num++;
    },
            },
            wushuang:{
                forced:true,
                locked:true,
                group:["wushuang1","wushuang2"],
            },
            keji:{
                audio:"ext:异界四国:4",
                trigger:{
                    player:"phaseDiscardBefore",
                },
                frequent:function (event,player){
        return !player.needsToDiscard();
    },
                filter:function (event,player){
        return player.countUsed('sha')==0;
    },
                content:function (){
        trigger.cancel();
    },
            },
            yaowu:{
                trigger:{
                    player:"damageEnd",
                },
                priority:1,
                audio:"ext:异界四国:2",
                filter:function (event){
        if(event.card&&(event.card.name=='sha')){
            if(get.color(event.card)=='red') return true;
        }
        return false;
    },
                forced:true,
                check:function (){
        return false;
    },
                content:function (){
        trigger.source.chooseDrawRecover(true);
    },
                ai:{
                    effect:{
                        target:function (card,player,target,current){
                if(card.name=='sha'&&(get.color(card)=='red')){
                    return [1,-2];
                }
            },
                    },
                },
            },
            zhenlie:{
                audio:"ext:异界四国:2",
                filter:function (event,player){
        return event.player!=player&&event.card&&(event.card.name=='sha'||get.type(event.card)=='trick');
    },
                logTarget:"player",
                check:function (event,player){
        if(get.attitude(player,event.player)>0){
            return false;
        }
        if(get.tag(event.card,'respondSha')){
            if(player.countCards('h',{name:'sha'})==0){
                return true;
            }
        }
        else if(get.tag(event.card,'respondShan')){
            if(player.countCards('h',{name:'shan'})==0){
                return true;
            }
        }
        else if(get.tag(event.card,'damage')){
            if(player.countCards('h')<2) return true;
        }
        else if(event.card.name=='shunshou'&&player.hp>2){
            return true;
        }
        return false;
    },
                priority:10,
                trigger:{
                    target:"useCardToBefore",
                },
                content:function (){
        "step 0"
        player.loseHp();
        "step 1"
        trigger.cancel();
        "step 2"
        if(trigger.player.countCards('he')){
            player.discardPlayerCard(trigger.player,'he',true);
        }
    },
                ai:{
                    expose:0.3,
                },
            },
            zhanjue:{
                audio:"ext:异界四国:2",
                enable:"phaseUse",
                filterCard:true,
                selectCard:-1,
                filter:function (event,player){
        if(!player.countCards('h')) return false;
        if(player.storage.zhanjue>=2) return false;
        return true;
    },
                viewAs:{
                    name:"juedou",
                },
                group:["zhanjue2","zhanjue3","zhanjue4"],
                ai:{
                    damage:true,
                    order:1,
                    effect:{
                        player:function (card,player,target){
                if(_status.event.skill=='zhanjue'){
                    if(player.countCards('h')>=3||target.countCards('h')>=3) return 'zeroplayertarget';
                    if(player.countCards('h','tao')) return 'zeroplayertarget';
                    if(target.countCards('h','sha')>1) return 'zeroplayertarget';
                }
            },
                    },
                    basic:{
                        order:5,
                        useful:1,
                        value:5.5,
                    },
                    result:{
                        target:-1.5,
                        player:function (player,target){
                            if(get.damageEffect(target,player,target)>0&&get.attitude(player,target)>0&&get.attitude(target,player)>0){
                                return 0;
                            }
                            var hs1=target.getCards('h','sha');
                            var hs2=player.getCards('h','sha');
                            if(hs1.length>hs2.length+1){
                                return -2;
                            }
                            var hsx=target.getCards('h');
                            if(hsx.length>2&&hs2.length==0&&hsx[0].number<6){
                                return -2;
                            }
                            if(hsx.length>3&&hs2.length==0){
                                return -2;
                            }
                            if(hs1.length>hs2.length&&(!hs2.length||hs1[0].number>hs2[0].number)){
                                return -2;
                            }
                            return -0.5;
                        },
                    },
                    tag:{
                        respond:2,
                        respondSha:2,
                        damage:1,
                    },
                },
            },
            zhiyu:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"damageEnd",
                },
                content:function (){
        "step 0"
        player.draw();
        "step 1"
        player.showHandcards();
        "step 2"
        if(!trigger.source) return;
        var cards=player.getCards('h');
        for(var i=1;i<cards.length;i++){
            if(get.color(cards[i])!=get.color(cards[0])) return;
        }
        trigger.source.chooseToDiscard(true);
    },
                ai:{
                    "maixie_defend":true,
                    threaten:0.9,
                },
            },
            xiangle:{
                audio:"ext:异界四国:2",
                trigger:{
                    target:"useCardToBefore",
                },
                forced:true,
                filter:function (event,player){
        return event.card.name=='sha';
    },
                content:function (){
        "step 0"
        var eff=get.effect(player,trigger.card,trigger.player,trigger.player);
        trigger.player.chooseToDiscard('享乐：弃置一张基本牌，否则杀对'+get.translation(player)+'无效',function(card){
            return get.type(card)=='basic';
        }).set('ai',function(card){
            if(_status.event.eff>0){
                return 10-get.value(card);
            }
            return 0;
        }).set('eff',eff);
        "step 1"
        if(result.bool==false){
            trigger.cancel();
        }
    },
                ai:{
                    effect:{
                        target:function (card,player,target,current){
                if(card.name=='sha'&&get.attitude(player,target)<0){
                    if(_status.event.name=='xiangle') return;
                    var bs=player.getCards('h',{type:'basic'});
                    if(bs.length<2) return 0;
                    if(player.hasSkill('jiu')||player.hasSkill('tianxianjiu')) return;
                    if(bs.length<=3&&player.countCards('h','sha')<=1){
                        for(var i=0;i<bs.length;i++){
                            if(bs[i].name!='sha'&&get.value(bs[i])<7){
                                return [1,0,1,-0.5];
                            }
                        }
                        return 0;
                    }
                    return [1,0,1,-0.5];
                }
            },
                    },
                },
            },
            tianming:{
                audio:"ext:异界四国:2",
                trigger:{
                    target:"shaBegin",
                },
                check:function (event,player){
        var cards=player.getCards('h');
        if(cards.length<=2){
            for(var i=0;i<cards.length;i++){
                if(cards[i].name=='shan'||cards[i].name=='tao') return false;
            }
        }
        return true;
    },
                content:function (){
        "step 0"
        player.chooseToDiscard(2,true,'he');
        player.draw(2);
        var players=game.filterPlayer();
        players.sort(function(a,b){
            return b.hp-a.hp;
        });
        if(players[0].hp>players[1].hp&&players[0]!=player){
            players[0].chooseBool(get.prompt('tianming'));
            event.player=players[0];
        }
        else{
            event.finish();
        }
        "step 1"
        if(result.bool){
            player.chooseToDiscard(2,true,'he');
            player.draw(2);
        }
    },
                ai:{
                    effect:{
                        target:function (card,player,target,current){
                if(card.name=='sha') return [1,0.5];
            },
                    },
                },
            },
            duwu:{
                audio:"ext:异界四国:2",
                enable:"phaseUse",
                filter:function (event,player){
        return player.hasSkill('duwu2')==false;
    },
                filterCard:function (){
        if(ui.selected.targets.length) return false;
        return true;
    },
                position:"he",
                selectCard:[1,Infinity],
                complexSelect:true,
                complexCard:true,
                filterTarget:function (card,player,target){
        return target!=player&&get.distance(player,target,'attack')<=1&&ui.selected.cards.length==target.hp;
    },
                check:function (card){
        switch(ui.selected.cards.length){
            case 0:return 7-get.value(card);
            case 1:return 6-get.value(card);
            case 2:return 3-get.value(card);
            default:return 0;
        }
    },
                content:function (){
        "step 0"
        player.addSkill('duwu3');
        target.damage();
        "step 1"
        if(!player.hasSkill('duwu3')){
            player.addSkill('duwu2');
            player.loseHp();
        }
        else{
            player.removeSkill('duwu3');
        }
    },
                ai:{
                    damage:true,
                    order:2,
                    result:{
                        target:function (player,target){
                return get.damageEffect(target,player);
            },
                    },
                    threaten:1.5,
                    expose:0.3,
                },
            },
            rende:{
                audio:"ext:异界四国:2",
                group:["rende1"],
                enable:"phaseUse",
                filterCard:true,
                selectCard:[1,Infinity],
                discard:false,
                prepare:"give",
                filterTarget:function (card,player,target){
        return player!=target;
    },
                check:function (card){
        if(ui.selected.cards.length>1) return 0;
        if(ui.selected.cards.length&&ui.selected.cards[0].name=='du') return 0;
        if(!ui.selected.cards.length&&card.name=='du') return 20;
        var player=get.owner(card);
        if(player.hp==player.maxHp||player.storage.rende<0||player.countCards('h')<=1){
            if(ui.selected.cards.length){
                return -1;
            }
            var players=game.filterPlayer();
            for(var i=0;i<players.length;i++){
                if(players[i].hasSkill('haoshi')&&
                    !players[i].isTurnedOver()&&
                    !players[i].hasJudge('lebu')&&
                    get.attitude(player,players[i])>=3&&
                    get.attitude(players[i],player)>=3){
                    return 11-get.value(card);
                }
            }
            if(player.countCards('h')>player.hp) return 10-get.value(card);
            if(player.countCards('h')>2) return 6-get.value(card);
            return -1;
        }
        return 10-get.value(card);
    },
                content:function (){
        target.gain(cards,player);
        if(typeof player.storage.rende!='number'){
            player.storage.rende=0;
        }
        if(player.storage.rende>=0){
            player.storage.rende+=cards.length;
            if(player.storage.rende>=2){
                player.recover();
                player.storage.rende=-1;
            }
        }
    },
                ai:{
                    order:function (skill,player){
            if(player.hp<player.maxHp&&player.storage.rende<2&&player.countCards('h')>1){
                return 10;
            }
            return 1;
        },
                    result:{
                        target:function (player,target){
                if(target.hasSkillTag('nogain')) return 0;
                if(ui.selected.cards.length&&ui.selected.cards[0].name=='du'){
                    if(target.hasSkillTag('nodu')) return 0;
                    return -10;
                }
                if(target.hasJudge('lebu')) return 0;
                var nh=target.countCards('h');
                var np=player.countCards('h');
                if(player.hp==player.maxHp||player.storage.rende<0||player.countCards('h')<=1){
                    if(nh>=np-1&&np<=player.hp&&!target.hasSkill('haoshi')) return 0;
                }
                return Math.max(1,5-nh);
            },
                    },
                    effect:{
                        target:function (card,player,target){
                if(player==target&&get.type(card)=='equip'){
                    if(player.countCards('e',{subtype:get.subtype(card)})){
                        var players=game.filterPlayer();
                        for(var i=0;i<players.length;i++){
                            if(players[i]!=player&&get.attitude(player,players[i])>0){
                                return 0;
                            }
                        }
                    }
                }
            },
                    },
                    threaten:0.8,
                },
            },
            xuanfeng:{
                audio:"xuanfeng",
                trigger:{
                    player:["loseEnd","phaseDiscardEnd"],
                },
                direct:true,
                filter:function (event,player){
        if(event.name=='phaseDiscard'){
            return event.cards&&event.cards.length>1
        }
        else{
            for(var i=0;i<event.cards.length;i++){
                if(event.cards[i].original=='e') return true;
            }
        }
        return false;
    },
                content:function (){
        "step 0"
        event.num=2
         "step 1"
       
        
        player.chooseTarget(get.prompt('ol_xuanfeng'),function(card,player,target){
            if(player==target) return false;
            return target.countCards('he');
        }).set('ai',function(target){
            return -get.attitude(_status.event.player,target);
        });
        "step 2"
        if(result.bool){
            player.logSkill('ol_xuanfeng',result.targets);
            event.targets=result.targets
            player.discardPlayerCard(event.targets[0],'he',true);
            
        event.num--;
                    if(event.num>0){
                       
                        event.goto(1);
                    }}
        
    },
                ai:{
                    effect:{
                        target:function (card,player,target,current){
                if(get.type(card)=='equip') return [1,3];
            },
                    },
                    noe:true,
                },
            },
            qiangshi:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"phaseUseBegin",
                },
                direct:true,
                filterTarget:function (card,player,target){
        return target!=player&&target.countCards('h')>0;
    },
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('qiangzhi'),function(card,player,target){
            return target!=player&&target.countCards('h')>0;
        }).set('ai',function(){
            return Math.random();
        });
        'step 1'
        if(result.bool){
            var target=result.targets[0];
            player.logSkill('qiangzhi',target);
            var card=target.getCards('h').randomGet();
            player.showCards(card);
            player.storage.qiangzhi=get.type(card,'trick');
            game.addVideo('storage',player,['qiangzhi',player.storage.qiangzhi]);
            player.markSkill('qiangzhi');
        }
    },
                intro:{
                    content:function (type){
            return get.translation(type)+'牌';
        },
                },
                group:["qiangzhi2","qiangzhi3"],
                ai:{
                    order:11,
                    result:{
                        player:1,
                    },
                },
            },
            xiaoguo:{
                audio:"ext:异界四国:2",
                trigger:{
                    global:"phaseEnd",
                },
                filter:function (event,player){
        return event.player.isAlive()&&event.player!=player&&player.countCards('h',{type:'basic'});
    },
                direct:true,
                content:function (){
        "step 0"
        var nono=(Math.abs(get.attitude(player,trigger.player))<3);
        if(get.damageEffect(trigger.player,player,player)<=0){
            nono=true;
        }
        var next=player.chooseToDiscard('弃置一张装备牌并令'+get.translation(player)+'摸一张牌，或受到一点伤害',get.prompt('xiaoguo',trigger.player),{type:'basic'});
        next.set('ai',function(card){
            if(_status.event.nono) return 0;
            return 8-get.useful(card);
        });
        next.set('logSkill',['xiaoguo',trigger.player]);
        next.set('nono',nono);
        "step 1"
        if(result.bool){
            var nono=(get.damageEffect(trigger.player,player,trigger.player)>=0);
            trigger.player.chooseToDiscard('he',{type:'equip'}).set('ai',function(card){
                if(_status.event.nono){
                    return 0;
                }
                if(_status.event.player.hp==1) return 10-get.value(card);
                return 9-get.value(card);
            }).set('nono',nono);
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.bool){
            player.draw();
        }
        else{
            trigger.player.damage();
        }
    },
                ai:{
                    expose:0.3,
                    threaten:1.3,
                },
            },
            liegong:{
                mod:{
                    targetInRange:function (card,player,target){
            if(card.name=='sha'&&card.number){
                if(get.distance(player,target)<=card.number) return true;
            }
        },
                },
                audio:"liegong",
                trigger:{
                    player:"shaBegin",
                },
                logTarget:"target",
                check:function (event,player){
        return get.attitude(player,event.target)<=0;
    },
                filter:function (event,player){
        if(event.target.countCards('h')<=player.countCards('h')) return true;
        if(event.target.hp<=player.hp) return true;
        return false;
    },
                content:function (){
        if(trigger.target.countCards('h')<=player.countCards('h')) trigger.directHit=true;
        if(trigger.target.hp>=player.hp) player.addTempSkill('xinliegong2','shaAfter');
    },
                ai:{
                    threaten:0.5,
                },
            },
            zhanyi:{
                enable:"phaseUse",
                usable:1,
                filterCard:true,
                position:"he",
                check:function (card){
        var player=_status.event.player;
        if(player.hp<3) return 0;
        var type=get.type(card,'trick');
        if(type=='trick'){
            return 6-get.value(card);
        }
        else if(type=='equip'){
            if(player.hasSha()&&game.hasPlayer(function(current){
                return (player.canUse('sha',current)&&
                    get.attitude(player,current)<0&&
                    get.effect(current,{name:'sha'},player,player)>0)
            })){
                return 6-get.value(card);
            }
        }
        return 0;
    },
                content:function (){
        player.loseHp();
        switch(get.type(cards[0],'trick')){
            case 'basic':player.addTempSkill('zhanyi_basic');break;
            case 'equip':player.addTempSkill('zhanyi_equip');break;
            case 'trick':player.addTempSkill('zhanyi_trick');player.draw(2);break;
        }
    },
                ai:{
                    order:9.1,
                    result:{
                        player:1,
                    },
                },
            },
            jili:{
                subSkill:{
                    count:{
                        trigger:{
                            player:["useCard","respond"],
                        },
                        silent:true,
                        priority:1,
                        content:function (){
                player.storage.gzjili++;
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                    init:{
                        trigger:{
                            global:"phaseBefore",
                        },
                        silent:true,
                        content:function (){
                player.storage.gzjili=0;
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                },
                group:["gzjili_count","gzjili_init"],
                trigger:{
                    player:["useCard","respond"],
                },
                frequent:true,
                filter:function (event,player){
        return player.storage.gzjili==player.getAttackRange();
    },
                content:function (){
        player.draw(player.getAttackRange());
    },
                ai:{
                    threaten:1.8,
                },
            },
            mingzhe:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:["useCardAfter","respondAfter","discardAfter"],
                },
                frequent:true,
                filter:function (event,player){
        if(player==_status.currentPhase) return false;
        if(event.cards){
            for(var i=0;i<event.cards.length;i++){
                if(get.color(event.cards[i])=='red'&&
                event.cards[i].original!='j') return true;
            }
        }
        return false;
    },
                content:function (){
        player.draw();
    },
                ai:{
                    threaten:0.7,
                },
            },
            fulin:{
                trigger:{
                    player:"phaseDiscardBegin",
                },
                silent:true,
                content:function (){
        player.addTempSkill('fulin2','phaseDiscardAfter');
    },
                group:["fulin_count","fulin_reset"],
                subSkill:{
                    reset:{
                        trigger:{
                            player:["phaseBegin","phaseEnd"],
                        },
                        silent:true,
                        priority:10,
                        content:function (){
                player.storage.fulin=[];
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                    count:{
                        trigger:{
                            player:"gainEnd",
                        },
                        silent:true,
                        filter:function (event,player){
                return _status.currentPhase==player;
            },
                        content:function (){
                if(!player.storage.fulin){
                    player.storage.fulin=[];
                }
                for(var i=0;i<trigger.cards.length;i++){
                    player.storage.fulin.add(trigger.cards[i]);
                }
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                },
                forced:true,
                popup:false,
            },
            qiaoshuo:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"phaseUseBegin",
                },
                direct:true,
                filter:function (event,player){
        return player.countCards('h')>0;
    },
                content:function (){
        "step 0"
        player.chooseTarget(get.prompt('qiaoshui'),function(card,player,target){
            return player!=target&&target.countCards('h')>0;
        }).set('ai',function(target){
            return -get.attitude(_status.event.player,target)/target.countCards('h');
        });
        "step 1"
        if(result.bool){
            player.logSkill('qiaoshui',result.targets[0]);
            player.chooseToCompare(result.targets[0]);
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.bool){
            player.addTempSkill('qiaoshui3');
        }
        else{
            player.addTempSkill('qiaoshui2');
        }
    },
                ai:{
                    expose:0.1,
                },
            },
            zongshi:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:["chooseToCompareAfter","compareMultipleAfter"],
                    target:["chooseToCompareAfter","compareMultipleAfter"],
                },
                filter:function (event,player){
        if(event.preserve) return false;
        if(player==event.player){
            if(event.card1.number>event.card2.number){
                return !get.owner(event.card2);
            }
            else{
                return !get.owner(event.card1);
            }
        }
        else{
            if(event.card1.number<event.card2.number){
                return !get.owner(event.card1);
            }
            else{
                return !get.owner(event.card2);
            }
        }
    },
                check:function (event,player){
        if(player==event.player){
            if(event.card1.number>event.card2.number){
                return event.card2.name!='du';
            }
            else{
                return event.card1.name!='du';
            }
        }
        else{
            if(event.card1.number<event.card2.number){
                return event.card1.name!='du';
            }
            else{
                return event.card2.name!='du';
            }
        }
    },
                content:function (){
        if(player==trigger.player){
            if(trigger.card1.number>trigger.card2.number){
                player.gain(trigger.card2,'gain2');
            }
            else{
                player.gain(trigger.card1,'gain2');
            }
        }
        else{
            if(trigger.card1.number<trigger.card2.number){
                player.gain(trigger.card1,'gain2');
            }
            else{
                player.gain(trigger.card2,'gain2');
            }
        }
    },
            },
            shuomeng:{
                trigger:{
                    player:"phaseUseAfter",
                },
                direct:true,
                filter:function (event,player){
        return player.countCards('h');
    },
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('shuimeng'),function(card,player,target){
            return target!=player&&target.countCards('h');
        }).set('ai',function(target){
            if(!_status.event.goon) return 0;
            return -get.attitude(_status.event.player,target);
        }).set('goon',player.needsToDiscard()||player.hasCard(function(card){
            var val=get.value(card);
            if(val<0) return true;
            if(val<=5){
                return card.number>=11;
            }
            if(val<=6){
                return card.number>=12;
            }
            return false;
        }));
        'step 1'
        if(result.bool){
            player.logSkill('shuimeng',result.targets);
            event.target=result.targets[0];
            player.chooseToCompare(event.target);
        }
        else{
            event.finish();
        }
        'step 2'
        if(result.bool){
            player.useCard({name:'wuzhong'},player);
        }
        else{
            event.target.useCard({name:'guohe'},player);
        }
    },
            },
            huomo:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"chooseToRespondBegin",
                },
                filter:function (event,player){
        if(event.responded) return false;
        if(!event.filterCard({name:'shan'})) return false;
        if(player.hasSkill('huomo2')) return false;
        if(event.parent.name!='sha') return false;
        var hs=player.getCards('he',{color:'black'});
        for(var i=0;i<hs.length;i++){
            if(get.type(hs[i])!='basic'){
                break;
            }
        }
        if(i==hs.length) return false;
        return true;
    },
                direct:true,
                content:function (){
        "step 0"
        player.chooseCard(get.prompt('huomo'),'he',function(card){
            return get.type(card)!='basic'&&get.color(card)=='black';
        }).set('ai',function(card){
            if(!_status.event.player.countCards('h','shan')){
                return 8-get.value(card);
            }
            return 6-get.value(card);
        });
        "step 1"
        if(result.bool){
            trigger.untrigger();
            trigger.responded=true;
            trigger.result={bool:true,card:{name:'shan'}}
            player.lose(result.cards,ui.special);
            player.$throw(result.cards);
            event.card=result.cards[0];
            player.logSkill('huomo');
            player.addTempSkill('huomo2');
        }
        else{
            event.finish();
        }
        'step 2'
        if(player==game.me&&event.card){
            game.delay();
        }
        'step 3'
        if(event.card){
            ui.cardPile.insertBefore(event.card,ui.cardPile.firstChild);
        }
    },
                group:["huomo_count","huomo_count2","huomo_use"],
            },
            zuoding:{
                trigger:{
                    global:"useCard",
                },
                filter:function (event,player){
        return !player.hasSkill('zuoding2')&&get.suit(event.card)=='spade'&&
            _status.currentPhase==event.player&&event.targets&&event.targets.length&&
            event.player!=player;
    },
                direct:true,
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('zuoding'),function(card,player,target){
            return _status.event.getTrigger().targets.contains(target);
        }).set('ai',function(target){
            return get.attitude(_status.event.player,target);
        });
        'step 1'
        if(result.bool){
            player.logSkill('zuoding',result.targets);
            result.targets[0].draw();
        }
    },
                ai:{
                    expose:0.2,
                },
                group:"zuoding3",
            },
            pizhuan:{
                trigger:{
                    player:"useCardAfter",
                    target:"useCardToBegin",
                },
                filter:function (event,player){
        if(event.name!='useCard'&&event.player==event.target) return false;
        if(player.storage.bizhuan.length>=4) return false;
        return get.suit(event.card)=='spade';
    },
                init:function (player){
        player.storage.bizhuan=[];
    },
                intro:{
                    content:"cards",
                },
                frequent:true,
                content:function (){
        var card=get.cards()[0];
        ui.special.appendChild(card);
        player.$draw(card);
        game.delay();
        player.storage.bizhuan.push(card);
        player.markSkill('bizhuan');
    },
                mod:{
                    maxHandcard:function (player,num){
            return num+player.storage.bizhuan.length;
        },
                },
            },
            tongbo:{
                trigger:{
                    player:"phaseDrawAfter",
                },
                direct:true,
                filter:function (event,player){
        return player.storage.bizhuan&&player.storage.bizhuan.length&&event.num>0;
    },
                locked:false,
                content:function (){
        "step 0"
        var four=false;
        var nofour=!player.hasFriend();
        if(player.storage.bizhuan.length==4){
            var suits=['club','spade','heart','diamond'];
            var list=player.getCards('h').concat(player.storage.bizhuan);
            for(var i=0;i<list.length;i++){
                suits.remove(get.suit(list[i]));
                if(suits.length==0){
                    four=true;
                    break;
                }
            }
        }
        var suits2=[];
        if(four){
            suits2=['club','spade','heart','diamond'];
            for(var i=0;i<player.storage.bizhuan.length;i++){
                suits2.remove(get.suit(player.storage.bizhuan[i]));
            }
        }
        player.chooseCard('选择任意张手牌与“书”交换',[1,Math.min(player.countCards('h'),player.storage.bizhuan.length)]).set('ai',function(card){
            var val=get.value(card);
            if(_status.event.four&&!_status.event.nofour){
                var suits=_status.event.suits2.slice(0);
                for(var i=0;i<ui.selected.cards.length;i++){
                    suits.remove(get.suit(ui.selected.cards[i]));
                }
                if(suits.contains(get.suit(card))){
                    if(val<0) return 10;
                    return 1;
                }
                else{
                    return 0;
                }
            }
            else{
                if(val<0) return 10;
                if(_status.event.player.skipList.contains('phaseUse')){
                    return val;
                }
                return 10-val;
            }
        }).set('four',four).set('suits2',suits2).set('nofour',nofour);
        event.four=four;
        event.nofour=nofour;
        "step 1"
        if(result.bool){
            player.logSkill('tongbo');
            player.lose(result.cards,ui.special)._triggered=null;
            player.storage.bizhuan=player.storage.bizhuan.concat(result.cards);
            player.syncStorage('bizhuan');
            event.num=result.cards.length;
        }
        else{
            event.finish();
        }
        "step 2"
        var suits2={
            heart:0,
            diamond:0,
            spade:0,
            club:0
        };
        for(var i=0;i<player.storage.bizhuan.length;i++){
            suits2[get.suit(player.storage.bizhuan[i])]++;
        }
        player.chooseCardButton(player.storage.bizhuan,'选择'+event.num+'张牌作为手牌',event.num,true).set('ai',function(button){
            var val=get.value(button.link);
            if(_status.event.four||_status.event.nofour){
                var suits=get.copy(_status.event.suits2);
                for(var i=0;i<ui.selected.buttons.length;i++){
                    suits[get.suit(ui.selected.buttons[i].link)]--;
                }
                var num=suits[get.suit(button.link)];
                if(_status.event.nofour){
                    for(var i in suits){
                        if(suits[i]==0) return val;
                    }
                    if(num!=2){
                        if(val<=0) return 0.01;
                        return val;
                    }
                    else{
                        return 0;
                    }
                }
                else{
                    if(num>1){
                        if(val<=0) return 0.01;
                        return val;
                    }
                    else{
                        return 0;
                    }
                }
            }
            else{
                if(val<0) return -10;
                if(_status.event.player.skipList.contains('phaseUse')){
                    return -val;
                }
                return val;
            }
        }).set('four',event.four).set('suits2',suits2).set('nofour',event.nofour);
        if(player==game.me&&!event.isMine()){
            game.delay(0.5);
        }
        "step 3"
        player.gain(result.links)._triggered=null;
        for(var i=0;i<result.links.length;i++){
            player.storage.bizhuan.remove(result.links[i]);
        }
        player.syncStorage('bizhuan');
        if(player==game.me&&_status.auto){
            game.delay(0.5);
        }
        "step 4"
        suits2=['club','spade','heart','diamond'];
        for(var i=0;i<player.storage.bizhuan.length;i++){
            suits2.remove(get.suit(player.storage.bizhuan[i]));
        }
        if(suits2.length>0){
            event.finish();
        }
        "step 5"
        event.cards=player.storage.bizhuan.slice(0);
        player.storage.bizhuan.length=0;
        player.unmarkSkill('bizhuan');
        "step 6"
        if(event.cards.length>1){
            player.chooseCardButton('将所有“书”交给任意名其他角色',true,event.cards,[1,event.cards.length]).set('ai',function(button){
                if(ui.selected.buttons.length==0) return 1;
                return 0;
            });
        }
        else if(event.cards.length==1){
            event._result={links:event.cards.slice(0),bool:true};
        }
        else{
            event.finish();
        }
        "step 7"
        if(result.bool){
            for(var i=0;i<result.links.length;i++){
                event.cards.remove(result.links[i]);
            }
            event.togive=result.links.slice(0);
            player.chooseTarget('将'+get.translation(result.links)+'交给一名其他角色',true,function(card,player,target){
                return target!=player;
            }).set('ai',function(target){
                var att=get.attitude(_status.event.player,target);
                if(_status.event.enemy){
                    return -att;
                }
                else if(att>0){
                    return att/(1+target.countCards('h'));
                }
                else{
                    return att/100;
                }
            }).set('enemy',get.value(event.togive[0])<0);
        }
        else{
            event.finish();
        }
        "step 8"
        if(result.targets.length){
            result.targets[0].gain(event.togive,'draw');
            player.line(result.targets[0],'green');
            game.log(result.targets[0],'获得了'+get.cnNumber(event.togive.length)+'张','#g“书”');
            event.goto(6);
        }
    },
                ai:{
                    combo:"bizhuan",
                },
            },
            lirang:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"discardAfter",
                },
                filter:function (event,player){
        for(var i=0;i<event.cards.length;i++){
            if(get.position(event.cards[i])=='d'){
                return true;
            }
        }
        return false;
    },
                direct:true,
                popup:false,
                content:function (){
        "step 0"
        if(trigger.delay==false) game.delay();
        event.cards=[];
        for(var i=0;i<trigger.cards.length;i++){
            if(get.position(trigger.cards[i])=='d'){
                event.cards.push(trigger.cards[i]);
                ui.special.appendChild(trigger.cards[i]);
            }
        }
        "step 1"
        if(event.cards.length){
            var goon=false;
            for(var i=0;i<event.cards.length;i++){
                if(event.cards[i].name=='du'){
                    goon=true;break;
                }
            }
            if(!goon){
                goon=game.hasPlayer(function(current){
                    return player!=current&&get.attitude(player,current)>1;
                });
            }
            player.chooseCardButton(get.prompt('lirang'),event.cards,[1,event.cards.length]).set('ai',function(button){
                if(!_status.event.goon||ui.selected.buttons.length) return 0;
                if(button.link.name=='du') return 2;
                return 1;
            }).set('goon',goon);
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.bool){
            event.togive=result.links.slice(0);
            player.chooseTarget('将'+get.translation(result.links)+'交给一名角色',true,function(card,player,target){
                return target!=player;
            }).set('ai',function(target){
                var att=get.attitude(_status.event.player,target);
                if(_status.event.enemy){
                    return -att;
                }
                else{
                    if(att>2) return att/Math.sqrt(1+target.countCards('h'));
                    return att/Math.sqrt(1+target.countCards('h'))/5;
                }
            }).set('enemy',get.value(event.togive[0])<0);
        }
        else{
            for(var i=0;i<event.cards.length;i++){
                event.cards[i].discard();
            }
            event.finish();
        }
        "step 3"
        if(result.bool){
            player.logSkill('lirang',result.targets);
            for(var i=0;i<event.togive.length;i++){
                event.cards.remove(event.togive[i]);
            }
            result.targets[0].gain(event.togive,player);
            result.targets[0].$gain2(event.togive);
            event.goto(1);
        }
        else{
            for(var i=0;i<event.cards.length;i++){
                event.cards[i].discard();
            }
            event.finish();
        }
    },
                ai:{
                    expose:0.1,
                    effect:{
                        target:function (card,player,target,current){
                if(target.hasFriend()&&get.tag(card,'discard')){
                    if(current<0) return 0;
                    return [1,1];
                }
            },
                    },
                },
            },
            mingshi:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"damageBegin",
                },
                direct:true,
                filter:function (event,player){
        return event.source&&event.source.hp>player.hp;
    },
                content:function (){
        "step 0"
        var next=player.chooseToDiscard(get.prompt('mingshi'),{color:'black'});
        next.set('ai',function(card){
            return 9-get.value(card);
        });
        next.set('logSkill','mingshi');
        "step 1"
        if(result.bool){
            trigger.num--;
        }
    },
                ai:{
                    threaten:0.8,
                },
            },
            lianzhu:{
                audio:"ext:异界四国:2",
                trigger:{
                    global:"recoverAfter",
                },
                direct:true,
                filter:function (event,player){
        return _status.currentPhase==event.player;
    },
                content:function (){
        'step 0'
        if(player==trigger.player){
            player.chooseControl('摸一张','摸两张','cancel2',function(){
                return '摸两张';
            }).set('prompt',get.prompt('liangzhu'));
            event.single=true;
        }
        else{
            player.chooseTarget(get.prompt('liangzhu'),function(card,player,target){
                return target==_status.event.player||target==_status.event.target;
            }).set('target',trigger.player).set('ai',function(target){
                var player=_status.event.player;
                if(player==target) return 1;
                return get.attitude(player,target)-1.5;
            });
        }
        'step 1'
        if(event.single){
            if(result.control!='cancel2'){
                player.logSkill('liangzhu',player);
                if(result.control=='摸一张'){
                    player.draw();
                }
                else{
                    player.draw(2);
                    player.storage.liangzhu=player;
                }
            }
        }
        else if(result.bool){
            var target=result.targets[0];
            player.logSkill('liangzhu',target);
            if(target==player){
                target.draw();
            }
            else{
                target.draw(2);
                if(target.storage.liangzhu){
                    target.storage.liangzhu.add(player);
                }
                else{
                    target.storage.liangzhu=[player];
                }
            }
        }
    },
                ai:{
                    expose:0.1,
                },
            },
            xiehui:{
                mod:{
                    maxHandcard:function (player,num){
            var hs=player.getCards('h');
            for(var i=0;i<hs.length;i++){
                if(get.color(hs[i])=='black'){
                    num++;
                }
            }
            return num;
        },
                },
                trigger:{
                    global:"gainBegin",
                },
                forced:true,
                popup:false,
                filter:function (event,player){
        if(event.source==player&&event.player!=player){
            for(var i=0;i<event.cards.length;i++){
                if(get.color(event.cards[i])=='black') return true;
            }
        }
        return false;
    },
                content:function (){
        trigger.player.addSkill('xiehui2');
        if(!trigger.player.storage.xiehui2){
            trigger.player.storage.xiehui2=[];
        }
        for(var i=0;i<trigger.cards.length;i++){
            if(get.color(trigger.cards[i])=='black'){
                trigger.player.storage.xiehui2.add(trigger.cards[i]);
            }
        }
    },
            },
            junxing:{
                enable:"phaseUse",
                audio:"ext:异界四国:2",
                usable:1,
                filterCard:true,
                selectCard:[1,Infinity],
                filter:function (event,player){
        return player.countCards('h')>0;
    },
                check:function (card){
        if(ui.selected.cards.length) return -1;
        var val=get.value(card);
        if(get.type(card)=='basic') return 8-get.value(card);
        return 5-get.value(card);
    },
                filterTarget:function (card,player,target){
        return player!=target;
    },
                content:function (){
        "step 0"
        var types=[];
        for(var i=0;i<cards.length;i++){
            types.add(get.type(cards[i],'trick'));
        }
        target.chooseToDiscard(function(card){
            return !_status.event.types.contains(get.type(card,'trick'));
        }).set('ai',function(card){
            if(_status.event.player.isTurnedOver()) return -1;
            return 8-get.value(card);
        }).set('types',types).set('dialog',['弃置一张与'+get.translation(player)+'弃置的牌类别均不同的牌，或将武将牌翻面','hidden',cards]);
        "step 1"
        if(!result.bool){
            target.turnOver();
            target.draw(cards.length);
        }
    },
                ai:{
                    order:2,
                    expose:0.3,
                    threaten:1.8,
                    result:{
                        target:function (player,target){
                if(target.hasSkillTag('noturn')) return 0;
                if(target.isTurnedOver()) return 2;
                return -1/(target.countCards('h')+1);
            },
                    },
                },
            },
            yuce:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"damageAfter",
                },
                direct:true,
                filter:function (event,player){
        return player.countCards('h')>0&&player.isDamaged();
    },
                content:function (){
        "step 0"
        var next=player.chooseToDiscard(get.prompt('yuce'));
        next.logSkill='yuce';
        next.set('ai',function(card){
            return 7-get.value(card);
        });
        "step 1"
        if(result.bool){
            var type=get.type(result.cards[0],'trick');
            if(trigger.source){
                trigger.source.chooseToDiscard('弃置一张'+get.translation(type)+'牌或令'+get.translation(player)+'回复一点体力',function(card){
                    return get.type(card,'trick')==_status.event.type;
                }).set('ai',function(card){
                    if(get.recoverEffect(_status.event.getParent().player,_status.event.player,_status.event.player)<0){
                        return 7-get.value(card);
                    }
                    return 0;
                }).set('type',type);
            }
            else{
                event.recover=true;
            }
        }
        else{
            event.finish();
        }
        "step 2"
        if(event.recover){
            player.recover();
        }
        else if(result.bool){
            player.draw();
        }
        else{
            player.recover();
        }
    },
                ai:{
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'damage'&&target.countCards('h'))){
                    return 0.8
                }
            },
                    },
                },
            },
            polu:{
                trigger:{
                    player:["phaseBegin","damageEnd"],
                },
                forced:true,
                filter:function (event,player){
        return !player.getEquip('ly_piliche');
    },
                content:function (){
        if(trigger.name=='phase'){
            player.useCard(game.createCard('ly_piliche','diamond',1),player);
        }
        else{
            player.draw();
        }
    },
            },
            xinzhiheng:{
                audio:"zhiheng",
                enable:"phaseUse",
                alter:true,
                usable:1,
                position:"he",
                filterCard:true,
                selectCard:[1,Infinity],
                check:function (card){
        var player=_status.event.player;
        if(get.is.altered('xinzhiheng')&&get.position(card)=='h'&&!player.countCards('h',function(card){
            return get.value(card)>=8;
        })){
            return 8-get.value(card);
        }
        return 6-get.value(card)
    },
                delay:0,
                content:function (){
        'step 0'
        if(!player.hasSkill('xinzhiheng_delay')) game.delayx();
        'step 1'
        player.draw(cards.length);
    },
                group:"xinzhiheng_draw",
                subSkill:{
                    draw:{
                        trigger:{
                            player:"loseEnd",
                        },
                        silent:true,
                        filter:function (event,player){
                if(event.getParent(2).skill!='xinzhiheng') return false;
                if(!get.is.altered('xinzhiheng')) return false;
                if(player.countCards('h')) return false;
                for(var i=0;i<event.cards.length;i++){
                    if(event.cards[i].original=='h') return true;
                }
                return false;
            },
                        content:function (){
                player.draw();
                player.addTempSkill('xinzhiheng_delay','xinzhihengAfter');
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                    delay:{
                        sub:true,
                    },
                },
                ai:{
                    order:1,
                    result:{
                        player:1,
                    },
                    threaten:1.55,
                },
            },
            shuangren:{
                trigger:{
                    player:"phaseUseBegin",
                },
                direct:true,
                priority:15,
                content:function (){
        'step 0'
        var goon;
        if(player.needsToDiscard()>1){
            goon=player.hasCard(function(card){
                return card.number>10&&get.value(card)<=5;
            });
        }
        else{
            goon=player.hasCard(function(card){
                return (card.number>=9&&get.value(card)<=5)||get.value(card)<=3;
            });
        }
        player.chooseTarget(get.prompt('shuangren'),function(card,player,target){
            return target!=player&&target.countCards('h');
        }).set('ai',function(target){
            var player=_status.event.player;
            if(_status.event.goon&&get.attitude(player,target)<0){
                return get.effect(target,{name:'sha'},player,player);
            }
            return 0;
        }).set('goon',goon);
        'step 1'
        if(result.bool){
            var target=result.targets[0];
            event.target=target;
            player.logSkill('shuangren',target);
            player.chooseToCompare(target);
        }
        else{
            event.finish();
        }
        'step 2'
        if(result.bool){
            var target=event.target;
            if(target.identity!='ye'&&target.identity!='unknown'&&game.hasPlayer(function(current){
                if(!player.canUse('sha',current,false)) return false;
                if(target==current) return false;
                if(get.mode()=='guozhan'){
                    return target.identity==current.identity;
                }
                return true;
            })){
                var str='对一名';
                if(get.mode()=='guozhan'){
                    str+=get.translation(target.identity)+'势力的';
                }
                player.chooseTarget(str+'角色使用一张杀',true,function(card,player,target){
                    if(!player.canUse('sha',target,false)) return false;
                    if(get.mode()=='guozhan'){
                        return target.identity==_status.event.identity;
                    }
                    return true;
                }).set('ai',function(target){
                    var player=_status.event.player;
                    return get.effect(target,{name:'sha'},player,player);
                }).set('identity',target.identity);
            }
            else{
                player.useCard({name:'sha'},target,false);
                event.finish();
            }
        }
        else{
            trigger.cancel();
            event.finish();
        }
        'step 3'
        if(result.bool&&result.targets&&result.targets.length){
            player.useCard({name:'sha'},result.targets[0],false);
        }
    },
            },
            fulu:{
                enable:"chooseToUse",
                filterCard:function (card){
        return card.name=='sha'&&!card.nature;
    },
                viewAs:{
                    name:"sha",
                    nature:"thunder",
                },
                ai:{
                    order:function (){
            return get.order({name:'sha'})+0.1;
        },
                    basic:{
                        useful:[5,1],
                        value:[5,1],
                    },
                    result:{
                        target:function (player,target){
                if(player.hasSkill('jiu')&&!target.getEquip('baiyin')){
                    if(get.attitude(player,target)>0){
                        return -6;
                    }
                    else{
                        return -3;
                    }
                }
                return -1.5;
            },
                    },
                    tag:{
                        respond:1,
                        respondShan:1,
                        damage:function (card){
                if(card.nature=='poison') return;
                return 1;
            },
                        natureDamage:function (card){
                if(card.nature) return 1;
            },
                        fireDamage:function (card,nature){
                if(card.nature=='fire') return 1;
            },
                        thunderDamage:function (card,nature){
                if(card.nature=='thunder') return 1;
            },
                        poisonDamage:function (card,nature){
                if(card.nature=='poison') return 1;
            },
                    },
                },
            },
            zhufu:{
                trigger:{
                    global:"damageBegin",
                },
                filter:function (event){
        return event.source&&event.nature=='thunder';
    },
                check:function (event,player){
        return get.attitude(player,event.source)>0&&get.attitude(player,event.player)<0;
    },
                prompt:function (event){
        return get.translation(event.source)+'即将对'+get.translation(event.player)+'造成伤害，'+get.prompt('fuji');
    },
                logTarget:"source",
                content:function (){
        "step 0"
        trigger.source.judge(ui.special);
        "step 1"
        if(result.color=='black'){
            result.card.discard();
            trigger.num++;
        }
        else{
            trigger.source.gain(result.card);
            trigger.source.$gain2(result.card);
        }
    },
            },
            luanzhan:{
                mod:{
                    selectTarget:function (card,player,range){
            if(!player.storage.luanzhan) return;
            if(range[1]==-1) return;
            if(range[1]==-1) return;
            if(card.name=='sha') range[1]+=player.storage.luanzhan;
            if(get.color(card)=='black'&&get.type(card)=='trick'){
                var info=get.info(card);
                if(info.multitarget) return false;
                range[1]+=player.storage.luanzhan;
            }
        },
                },
                trigger:{
                    source:"damageEnd",
                },
                silent:true,
                mark:true,
                intro:{
                    content:function (storage){
            return '可以额外指定'+storage+'个目标';
        },
                },
                init:function (player){
        player.storage.luanzhan=0;
    },
                "init2":function (player){
        player.markSkill('luanzhan');
    },
                content:function (){
        if(typeof player.storage.luanzhan=='number'){
            player.storage.luanzhan+=trigger.num;
        }
        else{
            player.storage.luanzhan=trigger.num;
        }
        if(player.hasSkill('luanzhan')){
            player.markSkill('luanzhan');
        }
    },
                group:"luanzhan_cancel",
                subSkill:{
                    cancel:{
                        trigger:{
                            player:"useCard",
                        },
                        forced:true,
                        filter:function (event,player){
                if(!player.storage.luanzhan) return false;
                var check=false;
                var card=event.card;
                if(card.name=='sha'){
                    check=true;
                }
                else if(get.color(card)=='black'&&get.type(card)=='trick'){
                    var info=get.info(card);
                    if(!info.multitarget){
                        check=true;
                        if(info.selectTarget==-1){
                            check=false;
                        }
                        else if(Array.isArray(info.selectTarget)&&info.selectTarget[1]==-1){
                            check=false;
                        }
                    }
                }
                if(check&&event.targets&&event.targets.length<player.storage.luanzhan){
                    return true;
                }
                return false;
            },
                        content:function (){
                player.storage.luanzhan=0;
                player.markSkill('luanzhan');
            },
                        sub:true,
                    },
                },
                forced:true,
                popup:false,
            },
            sijian:{
                trigger:{
                    player:"loseEnd",
                },
                direct:true,
                audio:"ext:异界四国:2",
                filter:function (event,player){
        if(player.countCards('h')) return false;
        for(var i=0;i<event.cards.length;i++){
            if(event.cards[i].original=='h') return true;
        }
        return false;
    },
                content:function (){
        "step 0"
        player.chooseTarget(get.prompt('sijian'),function(card,player,target){
            return player!=target&&target.countCards('he')>0;
        }).set('ai',function(target){
            return -get.attitude(_status.event.player,target);
        });
        "step 1"
        if(result.bool){
            player.logSkill('sijian',result.targets);
            event.target=result.targets[0];
            player.discardPlayerCard(event.target,true);
        }
        else{
            event.finish();
        }
    },
                ai:{
                    expose:0.2,
                },
            },
            bagua:{
                audio:"ext:异界四国:2",
                inherit:"bagua_skill",
                filter:function (event,player){
        if(!lib.skill.bagua_skill.filter(event,player)) return false;
        if(player.getEquip(2)) return false;
        return true;
    },
                ai:{
                    effect:{
                        target:function (card,player,target){
                if(player==target&&get.subtype(card)=='equip2'){
                    if(get.equipValue(card)<=7.5) return 0;
                }
                if(target.getEquip(2)) return;
                return lib.skill.bagua_skill.ai.effect.target.apply(this,arguments);
            },
                    },
                },
                trigger:{
                    player:"chooseToRespondBegin",
                },
                check:function (event,player){
                    if(get.damageEffect(player,event.player,player)>=0) return false;
                    return true;
                },
                content:function (){
                    "step 0"
                    player.judge('bagua',function(card){return (get.color(card)=='red')?1.5:-0.5});
                    "step 1"
                    if(result.judge>0){
                        trigger.untrigger();
                        trigger.responded=true;
                        trigger.result={bool:true,card:{name:'shan'}}
                    }
                },
            },
            meibu:{
                trigger:{
                    global:"phaseUseBegin",
                },
                filter:function (event,player){
        return event.player!=player&&get.distance(event.player,player,'attack')>1;
    },
                logTarget:"player",
                check:function (event,player){
        if(get.attitude(player,event.player)>=0) return false;
        var e2=player.getEquip(2);
        if(e2){
            if(e2.name=='tengjia') return true;
            if(e2.name=='bagua') return    true;
        }
        return player.countCards('h','shan')>0;
    },
                content:function (){
        var target=trigger.player;
        target.addTempSkill('meibu_viewas');
        target.addTempSkill('meibu_range');
        target.storage.meibu=player;
        target.markSkillCharacter('meibu',player,'魅步','锦囊牌均视为杀且'+get.translation(player)+'视为在攻击范围内');
    },
                ai:{
                    expose:0.2,
                },
                subSkill:{
                    range:{
                        mod:{
                            targetInRange:function (card,player,target){
                    if(card.name=='sha'&&target==player.storage.meibu){
                        return true;
                    }
                },
                        },
                        onremove:function (player){
                game.broadcast(function(player){
                    if(player.marks.meibu){
                        player.marks.meibu.delete();
                        delete player.marks.meibu;
                    }
                },player);
                if(player.marks.meibu){
                    player.marks.meibu.delete();
                    delete player.marks.meibu;
                    game.addVideo('unmark',player,'meibu');
                }
            },
                        trigger:{
                            player:"useCard",
                        },
                        forced:true,
                        popup:false,
                        filter:function (event,player){
                return event.skill=='meibu_viewas'
            },
                        content:function (){
                player.removeSkill('meibu_viewas');
                game.broadcastAll(function(player){
                    if(player.marks.meibu&&player.marks.meibu.info){
                        player.marks.meibu.info.content=player.marks.meibu.info.content.slice(8);
                    }
                },player);
            },
                        sub:true,
                    },
                    viewas:{
                        mod:{
                            cardEnabled:function (card,player){
                    if(card.name!='sha'&&get.type(card,'trick')=='trick') return false;
                },
                            cardUsable:function (card,player){
                    if(card.name!='sha'&&get.type(card,'trick')=='trick') return false;
                },
                            cardRespondable:function (card,player){
                    if(card.name!='sha'&&get.type(card,'trick')=='trick') return false;
                },
                            cardSavable:function (card,player){
                    if(card.name!='sha'&&get.type(card,'trick')=='trick') return false;
                },
                        },
                        enable:["chooseToUse","chooseToRespond"],
                        filterCard:function (card){
                return get.type(card,'trick')=='trick';
            },
                        viewAs:{
                            name:"sha",
                            suit:"heart",
                            number:12,
                            cards:[{"node":{"image":{},"info":{},"name":{},"name2":{},"background":{},"intro":{},"range":{}},"storage":{},"vanishtag":[],"_uncheck":[],"suit":"heart","number":12,"name":"shandian","nature":"thunder","cardid":"9190725272","clone":{"name":"shandian","suit":"heart","number":12,"node":{"name":{},"info":{},"intro":{},"background":{},"image":{}},"_onEndDelete":true,"_transitionEnded":true,"timeout":4838},"timeout":4718,"original":"h"}],
                        },
                        check:function (){return 1},
                        ai:{
                            effect:{
                                target:function (card,player,target,current){
                        if(get.tag(card,'respondSha')&&current<0) return 0.8
                    },
                            },
                            respondSha:true,
                            order:4,
                            useful:-1,
                            value:-1,
                            basic:{
                                useful:[5,1],
                                value:[5,1],
                            },
                            result:{
                                target:function (player,target){
                        if(player.hasSkill('jiu')&&!target.getEquip('baiyin')){
                            if(get.attitude(player,target)>0){
                                return -6;
                            }
                            else{
                                return -3;
                            }
                        }
                        return -1.5;
                    },
                            },
                            tag:{
                                respond:1,
                                respondShan:1,
                                damage:function (card){
                        if(card.nature=='poison') return;
                        return 1;
                    },
                                natureDamage:function (card){
                        if(card.nature) return 1;
                    },
                                fireDamage:function (card,nature){
                        if(card.nature=='fire') return 1;
                    },
                                thunderDamage:function (card,nature){
                        if(card.nature=='thunder') return 1;
                    },
                                poisonDamage:function (card,nature){
                        if(card.nature=='poison') return 1;
                    },
                            },
                        },
                        sub:true,
                    },
                },
            },
            zhidao:{
                trigger:{
                    source:"damageEnd",
                },
                filter:function (event,player){
        if(event._notrigger.contains(event.player)) return false;
        return _status.currentPhase==player&&event.player.isAlive()&&
        event.player.countCards('hej')>0&&event.player!=player&&!player.hasSkill('zhidao2');
    },
                forced:true,
                content:function (){
        var num=0;
        if(trigger.player.countCards('h')) num++;
        if(trigger.player.countCards('e')) num++;
        if(trigger.player.countCards('j')) num++;
        if(num){
            player.gainPlayerCard(trigger.player,num,'hej',true).set('filterButton',function(button){
                for(var i=0;i<ui.selected.buttons.length;i++){
                    if(get.position(button.link)==get.position(ui.selected.buttons[i].link)) return false;
                }
                return true;
            });
        }
        player.addTempSkill('zhidao2');
    },
            },
            hezong:{
                audio:"ext:2",
                trigger:{
                    player:"phaseEnd",
                },
                direct:true,
                filter:function (event,player){
        return game.hasPlayer(function(current){
            return !current.isLinked();
        });
    },
                content:function (){
        "step 0"
        var num=game.countPlayer(function(current){
            return !current.isLinked();
        });
        player.chooseTarget(get.prompt('ex_hezong'),[1,2],function(card,player,target){
            return !target.isLinked();
        }).set('ai',function(target){
            return -get.attitude(_status.event.player,target);
        });
        "step 1"
        if(result.bool){
            player.logSkill('ex_hezong',result.targets);
            event.targets=result.targets;
            event.num=0;
        }
        else{
            event.finish();
        }
        "step 2"
        if(event.num<event.targets.length){
            event.targets[event.num].link();
            event.num++;
            event.redo();
        }
    },
                ai:{
                    expose:0.3,
                },
            },
            faen:{
                audio:2,
                trigger:{
                    global:["turnOverAfter","linkAfter"],
                },
                filter:function (event,player){
        if(event.name=='link') return event.player.isLinked();
        return !event.player.isTurnedOver();
    },
                check:function (event,player){
        return get.attitude(player,event.player)>0;
    },
                logTarget:"player",
                content:function (){
        trigger.player.draw();
    },
                ai:{
                    expose:0.2,
                },
            },
            gailianhuan:{
                group:["gailianhuan1","gailianhuan2"],
            },
            "gailianhuan1":{
                audio:"ext:异界四国:2",
                enable:"phaseUse",
                filter:function (event,player){
        return player.countCards('h',{color:'black'})>0;
    },
                filterCard:function (card){
        return get.color(card)=='black';
    },
                viewAs:{
                    name:"tiesuo",
                    suit:"spade",
                    number:9,
                    cards:[{"node":{"image":{},"info":{},"name":{},"name2":{},"background":{},"intro":{},"range":{}},"storage":{},"vanishtag":[],"_uncheck":[],"suit":"spade","number":9,"name":"sha","cardid":"7301746328","clone":{"name":"sha","suit":"spade","number":9,"node":{"name":{},"info":{},"intro":{},"background":{},"image":{}},"_onEndDelete":true,"_transitionEnded":true,"timeout":2330},"timeout":2238,"original":"h"}],
                },
                prompt:"将一张黑色牌当铁锁连环使用",
                check:function (card){return 4-get.value(card)},
                ai:{
                    wuxie:function (){
            if(Math.random()<0.5) return 0;
        },
                    basic:{
                        useful:4,
                        value:4,
                        order:7,
                    },
                    result:{
                        target:function (player,target){
                if(target.isLinked()){
                    if(target.hasSkillTag('link')) return 0;
                    var f=target.hasSkillTag('nofire');
                    var t=target.hasSkillTag('nothunder');
                    if(f&&t) return 0;
                    if(f||t) return 0.5;
                    return 2;
                }
                if(get.attitude(player,target)>=0) return -0.9;
                if(ui.selected.targets.length) return -0.9;
                if(game.hasPlayer(function(current){
                    return get.attitude(player,current)<=-1&&current!=target&&!current.isLinked();
                })){
                    return -0.9;
                }
                return 0;
            },
                    },
                    tag:{
                        multitarget:1,
                        multineg:1,
                        norepeat:1,
                    },
                },
            },
            "gailianhuan2":{
                audio:"ext:异界四国:2",
                enable:"phaseUse",
                filter:function (event,player){
        return player.countCards('h',{color:'black'})>0;
    },
                filterCard:function (card){
        return get.color(card)=='black';
    },
                check:function (card){
        return 5-get.useful(card);
    },
                content:function (){
        player.draw();
    },
                discard:false,
                prompt:"将一张黑色牌置入弃牌堆并摸一张牌",
                delay:0.5,
                prepare:function (cards,player){
        player.$throw(cards,1000);
    },
                ai:{
                    basic:{
                        order:1,
                    },
                    result:{
                        player:1,
                    },
                },
            },
            "gai_huansha":{
                audio:"ext:2",
                srlose:true,
                enable:["chooseToUse","chooseToRespond"],
                filterCard:function (){return false;},
                selectCard:-1,
                viewAs:{
                    name:"sha",
                    nature:"fire",
                },
                viewAsFilter:function (player){
        return !player.isLinked();
    },
                prompt:"横置你的武将牌，视为打出一张火杀",
                check:function (){return 1},
                onuse:function (result,player){
        player.link();
    },
                onrespond:function (result,player){
        if(!player.isLinked()) player.link()
    },
                ai:{
                    skillTagFilter:function (player){
            return !player.isLinked();
        },
                    respondSha:true,
                    basic:{
                        useful:[5,1],
                        value:[5,1],
                    },
                    order:function (){
                        if(_status.event.player.hasSkillTag('presha',true,null,true)) return 10;
                        return 3;
                    },
                    result:{
                        target:function (player,target){
                            if(player.hasSkill('jiu')&&!target.getEquip('baiyin')){
                                if(get.attitude(player,target)>0){
                                    return -6;
                                }
                                else{
                                    return -3;
                                }
                            }
                            return -1.5;
                        },
                    },
                    tag:{
                        respond:1,
                        respondShan:1,
                        damage:function (card){
                            if(card.nature=='poison') return;
                            return 1;
                        },
                        natureDamage:function (card){
                            if(card.nature) return 1;
                        },
                        fireDamage:function (card,nature){
                            if(card.nature=='fire') return 1;
                        },
                        thunderDamage:function (card,nature){
                            if(card.nature=='thunder') return 1;
                        },
                        poisonDamage:function (card,nature){
                            if(card.nature=='poison') return 1;
                        },
                    },
                },
            },
            "gai_huanshan":{
                audio:"ext:2",
                enable:"chooseToRespond",
                filterCard:function (){return false;},
                selectCard:-1,
                viewAs:{
                    name:"shan",
                },
                viewAsFilter:function (player){
                    return player.isLinked();
                },
                prompt:"重置你的武将牌，视为打出一张闪",
                check:function (){return 1},
                onrespond:function (result,player){
                    if(player.isLinked()) player.link()
                },
                ai:{
                    skillTagFilter:function (player){
                        return player.isLinked();
                    },
                    respondShan:true,
                    basic:{
                        useful:[7,2],
                        value:[7,2],
                    },
                },
            },
            fuhun:{
                enable:["chooseToUse","chooseToRespond"],
                filterCard:true,
                selectCard:2,
                position:"h",
                audio:2,
                derivation:["wusheng","paoxiao"],
                viewAs:{
                    name:"sha",
                },
                prompt:"将两张手牌当杀使用或打出",
                check:function (card){
        if(_status.event.player.hasSkill('wusheng')&&get.color(card)=='red') return 0;
        if(_status.event.name=='chooseToRespond'){
            if(card.name=='sha') return 0;
            return 6-get.useful(card);
        }
        if(_status.event.player.countCards('h')<4) return 6-get.useful(card);
        return 7-get.useful(card);
    },
                ai:{
                    respondSha:true,
                    order:function (item,player){
            if(player.hasSkill('wusheng')&&player.hasSkill('paoxiao')){
                return 1;
            }
            if(player.countCards('h')<4){
                return 1;
            }
            return 4;
        },
                    basic:{
                        useful:[5,1],
                        value:[5,1],
                    },
                    result:{
                        target:function (player,target){
                if(player.hasSkill('jiu')&&!target.getEquip('baiyin')){
                    if(get.attitude(player,target)>0){
                        return -6;
                    }
                    else{
                        return -3;
                    }
                }
                return -1.5;
            },
                    },
                    tag:{
                        respond:1,
                        respondShan:1,
                        damage:function (card){
                if(card.nature=='poison') return;
                return 1;
            },
                        natureDamage:function (card){
                if(card.nature) return 1;
            },
                        fireDamage:function (card,nature){
                if(card.nature=='fire') return 1;
            },
                        thunderDamage:function (card,nature){
                if(card.nature=='thunder') return 1;
            },
                        poisonDamage:function (card,nature){
                if(card.nature=='poison') return 1;
            },
                    },
                },
                group:"fuhun2",
            },
            "fuhun2":{
                trigger:{
                    source:"damageAfter",
                },
                forced:true,
                filter:function (event,player){
                    if(player.hasSkill('fuhun3')) return false;
                    return event.getParent().skill=='fuhun';
                },
                content:function (){
                    player.addTempSkill('wusheng');
                    player.addTempSkill('paoxiao');
                    player.addTempSkill('fuhun3');
                },
            },
            "fuhun3":{
            },
            "fengqi1":{
                trigger:{
                    player:["phaseBegin","phaseEnd"],
                },
                direct:true,
                content:function (){
        'step 0'
        var list={basic:[],equip:[],trick:[],delay:[]};
        for(var i=0;i<lib.inpile.length;i++){
            var name=lib.inpile[i];
            var info=lib.card[name];
            if(info.autoViewAs||name=='yuansuhuimie') continue;
            if(lib.filter.cardEnabled({name:name},player)){
                if(!list[info.type]){
                    list[info.type]=[];
                }
                list[info.type].push([get.translation(lib.card[name].type),'',name]);
            }
        }
        list.trick.sort(lib.sort.name);
        var dialog=ui.create.dialog('风起',[list.trick,'vcard']);
        // for(var i in list){
        //     dialog.addText(get.translation(i)+'牌');
        //     dialog.add([list[i],'vcard']);
        // }
        var rand1=Math.random()<1/3;
        var rand2=Math.random()<0.5;
        var rand3=Math.random()<1/3;
        var rand4=Math.random()<1/3;
        player.chooseButton(dialog).ai=function(button){
            var name=button.link[2];
            if(player.hp<=1){
                switch(name){
                    case 'zhiliaobo':return 1;
                    case 'dunpaigedang':return 0.8;
                    case 'nanman':return 0.5;
                    default:return 0;
                }
            }
            if(rand4&&player.countCards('h')<=1){
                switch(name){
                    case 'zengbin':return 1;
                    case 'wuzhong':return 0.8;
                    default:return 0;
                }
            }
            if(player.hasSkill('qinglonglingzhu')){
                if(rand2) return name=='chiyuxi'?0.8:0;
                return name=='jingleishan'?0.8:0;
            }
            if(rand2) return name=='wanjian'?0.8:0;
            return name=='nanman'?0.8:0;
        }
        'step 1'
        if(result.bool){
            player.chooseUseTarget(result.links[0][2]);
        }
    },
                ai:{
                    threaten:1.5,
                },
            },
            "huoshen1":{
                trigger:{
                    player:"damageBefore",
                },
                forced:true,
                unique:true,
                filter:function (event){
        return event.nature=='fire';
    },
                content:function (){
        trigger.cancel();
        player.recover();
    },
                ai:{
                    effect:{
                        target:function (card){
                if(get.tag(card,'fireDamage')){
                    return [0,2];
                }
            },
                    },
                },
            },
            shenyi:{
                unique:true,
                mod:{
                    judge:function (player,result){
            if(_status.event.type=='phase'){
                if(result.bool==false){
                    result.bool=null;
                }
                else{
                    result.bool=false;
                }
            }
        },
                },
                trigger:{
                    player:"turnOverBefore",
                },
                priority:20,
                forced:true,
                filter:function (event,player){
        return !player.isTurnedOver();
    },
                content:function (){
        trigger.cancel();
        game.log(player,'取消了翻面');
    },
                ai:{
                    noturn:true,
                    effect:{
                        target:function (card,player,target){
                if(get.type(card)=='delay') return 0.5;
            },
                    },
                },
            },
            "gongao1":{
                audio:"ext:异界四国:2",
                trigger:{
                    global:"dieAfter",
                },
                forced:true,
                unique:true,
                content:function (){
        player.gainMaxHp();
        player.recover();
    },
                ai:{
                    threaten:1.5,
                },
            },
            "chengxiang1":{
                trigger:{
                    player:"damageEnd",
                },
                direct:true,
                audio:"ext:异界四国:2",
                content:function (){
        "step 0"
        event.cards=get.cards(4);
        event.videoId=lib.status.videoId++;
        game.broadcastAll(function(player,id,cards){
            var str;
            if(player==game.me&&!_status.auto){
                str='称象：选择任意张点数不大于13的牌';
            }
            else{
                str='称象';
            }
            var dialog=ui.create.dialog(str,cards);
            dialog.videoId=id;
        },player,event.videoId,event.cards);
        event.time=get.utc();
        game.addVideo('showCards',player,['称象',get.cardsInfo(event.cards)]);
        game.addVideo('delay',null,2);
        "step 1"
        var next=player.chooseButton([0,4]);
        next.set('dialog',event.videoId);
        next.set('filterButton',function(button){
            var num=0
            for(var i=0;i<ui.selected.buttons.length;i++){
                num+=get.number(ui.selected.buttons[i].link);
            }
            return (num+get.number(button.link)<=13);
        });
        next.set('ai',function(button){
            return get.value(button.link,_status.event.player);
        });
        "step 2"
        if(result.bool&&result.links){
            player.logSkill('chengxiang');
            var cards2=[];
            for(var i=0;i<result.links.length;i++){
                cards2.push(result.links[i]);
                cards.remove(result.links[i]);
            }
            for(var i=0;i<cards.length;i++){
                cards[i].discard();
            }
            event.cards2=cards2;
        }
        else{
            event.finish();
        }
        var time=1000-(get.utc()-event.time);
        if(time>0){
            game.delay(0,time);
        }
        "step 3"
        game.broadcastAll('closeDialog',event.videoId);
        var cards2=event.cards2;
        player.gain(cards2,'log');
        player.$draw(cards2);
        game.delay();
    },
                ai:{
                    maixie:true,
                    "maixie_hp":true,
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'damage')){
                    if(player.hasSkillTag('jueqing',false,target)) return [1,-2];
                    if(!target.hasFriend()) return;
                    if(target.hp>=4) return [1,2];
                    if(target.hp==3) return [1,1.5];
                    if(target.hp==2) return [1,0.5];
                }
            },
                    },
                },
            },
            "wangxi1":{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"damageEnd",
                    source:"damageEnd",
                },
                filter:function (event){
        if(event._notrigger.contains(event.player)) return false;
        return event.num&&event.source&&event.player&&
        event.player.isAlive()&&event.source.isAlive()&&event.source!=event.player;
    },
                check:function (event,player){
        if(event.player==player) return get.attitude(player,event.source)>-3;
        return get.attitude(player,event.player)>-3;
    },
                logTarget:function (event,player){
        if(event.player==player) return event.source;
        return event.player;
    },
                content:function (){
        "step 0"
        game.asyncDraw([trigger.player,trigger.source],trigger.num);
        "step 1"
        game.delay();
    },
                ai:{
                    maixie:true,
                    "maixie_hp":true,
                },
            },
            "jushou1":{
                audio:"jushou",
                trigger:{
                    player:"phaseEnd",
                },
                content:function (){
        'step 0'
        player.draw(4);
        player.turnOver();
        'step 1'
        player.chooseCard('h',true,'弃置一张手牌，若以此法弃置的是装备牌，则你改为使用之').set('ai',function(card){
            if(get.type(card)=='equip'){
                return 5-get.value(card);
            }
            return -get.value(card);
        }).set('filterCard',lib.filter.cardDiscardable);
        'step 2'
        if(result.bool&&result.cards.length){
            if(get.type(result.cards[0])=='equip'){
                player.$give(result.cards,player);
                player.lose(result.cards,ui.special);
                event.toequip=result.cards[0];
            }
            else{
                player.discard(result.cards[0]);
            }
        }
        'step 3'
        if(event.toequip){
            game.delay();
        }
        'step 4'
        if(event.toequip){
            player.equip(event.toequip);
        }
    },
                ai:{
                    effect:{
                        target:function (card,player,target){
                if(card.name=='guiyoujie') return [0,1];
            },
                    },
                },
            },
            "xinjiewei1":{
                audio:"yanzheng",
                enable:"chooseToUse",
                filterCard:true,
                position:"e",
                viewAs:{
                    name:"wuxie",
                },
                filter:function (event,player){
        return player.countCards('e')>0;
    },
                viewAsFilter:function (player){
        return player.countCards('e')>0;
    },
                prompt:"将一张装备区内的牌当无懈可击使用",
                check:function (card){return 8-get.equipValue(card)},
                threaten:1.2,
                group:"xinjiewei1_move",
                subSkill:{
                    move:{
                        trigger:{
                            player:"turnOverEnd",
                        },
                        direct:true,
                        audio:"jiewei",
                        filter:function (event,player){
                return !player.isTurnedOver()&&player.canMoveCard();
            },
                        content:function (){
                "step 0"
                player.chooseToDiscard('he',get.prompt('xinjiewei1'),'弃置一张牌并移动场上的一张牌',lib.filter.cardDiscardable).set('ai',function(card){
                    if(!_status.event.check) return 0;
                    return 7-get.value(card);
                }).set('check',player.canMoveCard(true)).set('logSkill','xinjiewei1');
                "step 1"
                if(result.bool){
                    player.moveCard(true);
                }
                else{
                    event.finish();
                }
            },
                        sub:true,
                    },
                },
                ai:{
                    basic:{
                        useful:[6,4],
                        value:[6,4],
                    },
                    result:{
                        player:1,
                    },
                    expose:0.2,
                },
            },
            xiefeng:{
                audio:"ext:2",
                trigger:{
                    player:"phaseBegin",
                },
                frequent:true,
                filter:function (event,player){
       if(player.getEquip(1)) return false;
                    return true;
   },
                content:function (){
        event.equip=get.cardPile(function(card){
            return get.subtype(card)=='equip1';
        });
            player.equip(event.equip||game.createCard(get.inpilefull('equip').randomGet()),true);
            event.e=true;
    },
                ai:{
                    order:8,
                    threaten:1.2,
                    result:{
                        player:1,
                    },
                },
            },
            "jiqiao1":{
                trigger:{
                    player:"phaseUseBegin",
                },
                direct:true,
                filter:function (event,player){
        return player.countCards('he',{type:'equip'})>0;
    },
                content:function (){
        'step 0'
        player.chooseToDiscard(get.prompt('jiqiao'),[1,player.countCards('he',{type:'equip'})],'he',function(card){
            return get.type(card)=='equip';
        }).set('ai',function(card){
            if(card.name=='bagua') return 10;
            return 7-get.value(card);
        });
        'step 1'
        if(result.bool){
            player.logSkill('jiqiao');
            event.cards=get.cards(5*result.cards.length);
            player.showCards(event.cards);
        }
        else{
            event.finish();
        }
        'step 2'
        var gained=[];
        for(var i=0;i<event.cards.length;i++){
            if(get.type(event.cards[i],'trick')=='trick'){
                gained.push(event.cards[i]);
            }
            else{
                event.cards[i].discard();
            }
        }
        player.gain(gained,'gain2');
    },
                ai:{
                    threaten:1.5,
                },
            },
            kongsheng:{
                audio:"ext2",
                trigger:{
                    player:"phaseBegin",
                },
                direct:true,
                filter:function (event,player){
        return player.countCards('he')>0;
    },
                content:function (){
        'step 0'
        player.chooseCard(get.prompt('drlt_kongsheng'),'he',[1,player.countCards('he')]).set('ai',function(card){
            if(card.name=='shan'||card.name=='du') return 1;
            return 5-get.value(card);
        });
        'step 1'
        if(result.bool){
            player.logSkill('drlt_kongsheng');
            if(player.storage.drlt_kongsheng1==undefined) player.storage.drlt_kongsheng1=result.cards;
            player.lose(result.cards,ui.special);
            game.log(player,'将',result.cards,'置于其武将牌上');
            player.addSkill('drlt_kongsheng1');
        }else{
            event.finish();
        };
    },
            },
            "shenduan1":{
                trigger:{
                    player:"discardAfter",
                },
                filter:function (event,player){
        for(var i=0;i<event.cards.length;i++){
            if(get.color(event.cards[i])=='black'&&get.type(event.cards[i])=='basic'&&
                get.position(event.cards[i])=='d'){
                return true;
            }
        }
        return false;
    },
                direct:true,
                content:function (){
        'step 0'
        var cards=[];
        for(var i=0;i<trigger.cards.length;i++){
            if(get.color(trigger.cards[i])=='black'&&get.type(trigger.cards[i])=='basic'&&
                get.position(trigger.cards[i])=='d'){
                cards.push(trigger.cards[i]);
            }
        }
        if(!cards.length){
            event.finish();
        }
        else{
            event.cards=cards;
        }
        'step 1'
        if(event.cards.length){
            player.chooseTarget(get.prompt('shenduan'),function(card,player,target){
                return player.canUse({name:'bingliang'},target,false);
            }).set('ai',function(target){
                var player=_status.event.player;
                return get.effect(target,{name:'bingliang'},player,player);
            });
        }
        else{
            event.finish();
        }
        'step 2'
        if(result.bool&&result.targets&&result.targets.length){
            event.current=result.targets[0];
            if(event.cards.length==1){
                event.directCard=event.cards[0];
            }
            else{
                delete event.directCard;
                player.chooseCardButton('选择一张牌当作兵断寸断使用',event.cards,true);
            }
        }
        else{
            event.finish();
        }
        'step 3'
        var card;
        if(event.directCard){
            card=event.directCard;
        }
        else if(result.links&&result.links.length&&
            event.cards.contains(result.links[0])){
            card=result.links[0]
        }
        if(card){
            event.cards.remove(card);
            event.current.addJudge('bingliang',[card]);
            event.goto(1);
            player.logSkill('shenduan',event.current);
        }
    },
            },
            "jiezi1":{
                trigger:{
                    global:["phaseDrawSkipped","phaseDrawCancelled"],
                },
                forced:true,
                filter:function (event,player){
        return event.player!=player;
    },
                content:function (){
        player.draw();
    },
            },
            "jigong1":{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"phaseUseBegin",
                },
                check:function (event,player){
        var nh=player.countCards('h')-player.countCards('h',{type:'equip'});
        if(nh<=1) return true;
        if(player.countCards('h','tao')) return false;
        if(nh<=2) return Math.random()<0.7;
        if(nh<=3) return Math.random()<0.4;
        return false;
    },
                content:function (){
        player.draw(2);
        player.addTempSkill('jigong2');
    },
            },
            "jigong2":{
                mod:{
                    maxHandcard:function (player,num){
                        var damage=player.getStat().damage;
                        if(typeof damage=='number') return num-player.hp+damage;
                        return 0;
                    },
                },
            },
            xinjizhi:{
                audio:"jizhi",
                trigger:{
                    player:"useCard",
                },
                frequent:true,
                alter:true,
                filter:function (event){
        if(!get.is.altered('xinjizhi')&&get.type(event.card)=='delay') return false;
        return (get.type(event.card,'trick')=='trick'&&event.cards[0]&&event.cards[0]==event.card);
    },
                init:function (player){
        player.storage.xinjizhi=0;
    },
                content:function (){
        'step 0'
        player.draw();
        'step 1'
        if(get.is.altered('xinjizhi')&&get.type(result[0])=='basic'){
            event.card=result[0];
            player.chooseBool('是否弃置'+get.translation(event.card)+'并令本回合手牌上限+1？').set('ai',function(evt,player){
                return _status.currentPhase==player&&player.needsToDiscard(-3)&&_status.event.value<6;
            }).set('value',get.value(event.card,player));
        }
        else{
            event.finish();
        }
        'step 2'
        if(result.bool){
            player.discard(event.card);
            player.storage.xinjizhi++;
            if(_status.currentPhase==player){
                player.markSkill('xinjizhi');
            }
        }
    },
                ai:{
                    threaten:1.4,
                    noautowuxie:true,
                },
                mod:{
                    maxHandcard:function (player,num){
            if(get.is.altered('xinjizhi')&&_status.currentPhase==player){
                return num+player.storage.xinjizhi;
            }
            return num;
        },
                },
                intro:{
                    content:"本回合手牌上限+#",
                },
                group:"xinjizhi_clear",
                subSkill:{
                    clear:{
                        trigger:{
                            global:"phaseAfter",
                        },
                        silent:true,
                        content:function (){
                player.storage.xinjizhi=0;
                player.unmarkSkill('xinjizhi');
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                },
            },
            "qingguo1":{
                audio:"ext:异界四国:2",
                enable:["chooseToRespond"],
                filterCard:function (card){
        return get.color(card)=='black';
    },
                viewAs:{
                    name:"shan",
                },
                viewAsFilter:function (player){
        if(!player.countCards('h',{color:'black'})) return false;
    },
                prompt:"将一张黑色手牌当闪打出",
                check:function (){return 1},
                ai:{
                    respondShan:true,
                    skillTagFilter:function (player){
            if(!player.countCards('h',{color:'black'})) return false;
        },
                    effect:{
                        target:function (card,player,target,current){
                if(get.tag(card,'respondShan')&&current<0) return 0.6
            },
                    },
                    basic:{
                        useful:[7,2],
                        value:[7,2],
                    },
                },
            },
            "fangzhu1":{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"damageEnd",
                },
                direct:true,
                content:function (){
        "step 0"
        player.chooseTarget(get.prompt('fangzhu'),function(card,player,target){
            return player!=target
        }).ai=function(target){
            if(target.hasSkillTag('noturn')) return 0;
            var player=_status.event.player;
            if(get.attitude(_status.event.player,target)==0) return 0;
            if(get.attitude(_status.event.player,target)>0){
                if(target.classList.contains('turnedover')) return 1000-target.countCards('h');
                if(player.maxHp-player.hp<3) return -1;
                return 100-target.countCards('h');
            }
            else{
                if(target.classList.contains('turnedover')) return -1;
                if(player.maxHp-player.hp>=3) return -1;
                return 1+target.countCards('h');
            }
        }
        "step 1"
        if(result.bool){
            player.logSkill('fangzhu',result.targets);
            result.targets[0].draw(player.maxHp-player.hp);
            result.targets[0].turnOver();
        }
    },
                ai:{
                    maixie:true,
                    "maixie_hp":true,
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'damage')){
                    if(player.hasSkillTag('jueqing',false,target)) return [1,-2];
                    if(target.hp<=1) return;
                    if(!target.hasFriend()) return;
                    var hastarget=false;
                    var turnfriend=false;
                    var players=game.filterPlayer();
                    for(var i=0;i<players.length;i++){
                        if(get.attitude(target,players[i])<0&&!players[i].isTurnedOver()){
                            hastarget=true;
                        }
                        if(get.attitude(target,players[i])>0&&players[i].isTurnedOver()){
                            hastarget=true;
                            turnfriend=true;
                        }
                    }
                    if(get.attitude(player,target)>0&&!hastarget) return;
                    if(turnfriend||target.hp==target.maxHp) return [0.5,1];
                    if(target.hp>1) return [1,0.5];
                }
            },
                    },
                },
            },
            gaikunfen:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"phaseEnd",
                },
                direct:true,
                content:function (){
        "step 0"
        if(player.storage.gaikunfen||
        (get.mode()=='guozhan'&&player.hiddenSkills.contains('gaikunfen'))){
            if(!player.storage.gaikunfen){
                event.skillHidden=true;
            }
            player.chooseBool(get.prompt('gaikunfen')).set('ai',function(){
                var player=_status.event.player;
                if(player.hp>3) return true;
                if(player.hp==3&&player.countCards('h')<3) return true;
                if(player.hp==2&&player.countCards('h')==0) return true;
                return false;
            });
        }
        else{
            event.forced=true;
        }
        "step 1"
        if(event.forced||result.bool){
            player.logSkill('gaikunfen');
            player.loseHp();
        }
        else{
            event.finish();
        }
        "step 2"
        player.draw(2);
    },
                ai:{
                    threaten:1.5,
                },
            },
            "fengliang1":{
                skillAnimation:true,
                unique:true,
                audio:"ext:异界四国:2",
                derivation:"tiaoxin",
                trigger:{
                    player:"dying",
                },
                priority:10,
                forced:true,
                filter:function (event,player){
        return !player.storage.gaikunfen;
    },
                content:function (){
        "step 0"
        player.loseMaxHp();
        "step 1"
        if(player.hp<2){
            player.recover(2-player.hp);
        }
        "step 2"
        player.addSkill('tiaoxin');
        player.storage.gaikunfen=true;
        player.awakenSkill('fengliang');
    },
            },
            "yuhua1":{
                trigger:{
                    player:"phaseDiscardBegin",
                },
                forced:true,
                audio:"ext:异界四国:2",
                filter:function (event,player){
        return event.parent.name=='phaseDiscard'&&player.countCards('h',{type:'basic'})<player.countCards('h');
    },
                content:function (){},
                mod:{
                    ignoredHandcard:function (card,player){
            if(get.type(card)!='basic'){
                return true;
            }
        },
                    cardDiscardable:function (card,player,name){
            if(name=='phaseDiscard'&&get.type(card)!='basic') return false;
        },
                },
            },
            "qirang1":{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"equipEnd",
                },
                frequent:true,
                content:function (){
        player.gain(get.cardPile(function(card){
            return get.type(card,'trick')=='trick';
        }),'gain2');
    },
                ai:{
                    effect:{
                        target:function (card,player,target,current){
                if(get.type(card)=='equip') return [1,3];
            },
                    },
                    threaten:1.3,
                },
            },
            "tuntian1":{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"loseEnd",
                },
                frequent:true,
                filter:function (event,player){
        if(player==_status.currentPhase) return false;
        for(var i=0;i<event.cards.length;i++){
            if(event.cards[i].original&&event.cards[i].original!='j') return true;
        }
        return false;
    },
                content:function (){
        "step 0"
        player.judge(function(card){
            if(get.suit(card)=='heart') return -1;
            return 1;
        },ui.special).nogain=function(card){
            return get.suit(card)!='heart';
        };
        "step 1"
        if(result.bool){
            result.card.goto(ui.special);
            player.storage.tuntian.push(result.card);
            result.node.moveDelete(player);
            game.broadcast(function(cardid,player){
                var node=lib.cardOL[cardid];
                if(node){
                    node.moveDelete(player);
                }
            },result.node.cardid,player);
            game.addVideo('gain2',player,get.cardsInfo([result.node]));
            player.markSkill('tuntian');
            game.addVideo('storage',player,['tuntian',get.cardsInfo(player.storage.tuntian),'cards']);
        }
    },
                init:function (player){
        player.storage.tuntian=[];
    },
                intro:{
                    content:"cards",
                },
                group:"tuntian_dist",
                subSkill:{
                    dist:{
                        mod:{
                            globalFrom:function (from,to,distance){
                    if(from.storage.tuntian) return distance-from.storage.tuntian.length;
                },
                        },
                        sub:true,
                    },
                },
                locked:false,
                ai:{
                    effect:{
                        target:function (card,player,target,current){
                if(!target.hasFriend()&&!player.hasUnknown()) return;
                if(_status.currentPhase==target) return;
                if(get.tag(card,'loseCard')&&target.countCards('he')){
                    if(target.hasSkill('ziliang')) return 0.7;
                    return [0.5,Math.max(2,target.countCards('h'))];
                }
                if(target.isUnderControl(true,player)){
                    if((get.tag(card,'respondSha')&&target.countCards('h','sha'))||
                        (get.tag(card,'respondShan')&&target.countCards('h','shan'))){
                        if(target.hasSkill('ziliang')) return 0.7;
                        return [0.5,1];
                    }
                }
                else if(get.tag(card,'respondSha')||get.tag(card,'respondShan')){
                    if(get.attitude(player,target)>0&&card.name=='juedou') return;
                    if(get.tag(card,'damage')&&target.hasSkillTag('maixie')) return;
                    if(target.countCards('h')==0) return 2;
                    if(target.hasSkill('ziliang')) return 0.7;
                    if(get.mode()=='guozhan') return 0.5;
                    return [0.5,Math.max(target.countCards('h')/4,target.countCards('h','sha')+target.countCards('h','shan'))];
                }
            },
                    },
                    threaten:function (player,target){
            if(target.countCards('h')==0) return 2;
            return 0.5;
        },
                    nodiscard:true,
                    nolose:true,
                },
            },
            "zaoxian1":{
                skillAnimation:true,
                audio:"ext:异界四国:2",
                unique:true,
                trigger:{
                    player:"phaseBegin",
                },
                forced:true,
                filter:function (event,player){
        if(player.storage.tuntian) return player.storage.tuntian.length>=3&&!player.storage.zaoxian;
    },
                derivation:"jixi",
                content:function (){
        player.loseMaxHp();
        player.addSkill('jixi');
        player.storage.zaoxian=true;
        player.awakenSkill('zaoxian1');
    },
            },
            jixi:{
                audio:2,
                enable:"phaseUse",
                filter:function (event,player){
                    return player.storage.tuntian.length>0;
                },
                chooseButton:{
                    dialog:function (event,player){
                        return ui.create.dialog('急袭',player.storage.tuntian,'hidden');
                    },
                    backup:function (links,player){
                        return {
                            filterCard:function(){return false},
                            selectCard:-1,
                            viewAs:{name:'shunshou'},
                            cards:links,
                            onuse:function(result,player){
                                result.cards=lib.skill[result.skill].cards;
                                var card=result.cards[0];
                                player.storage.tuntian.remove(card);
                                player.syncStorage('tuntian');
                                if(!player.storage.tuntian.length){
                                    player.unmarkSkill('tuntian');
                                }
                                else{
                                    player.markSkill('tuntian');
                                }
                                player.logSkill('jixi',result.targets);
                            }
                        }
                    },
                    prompt:function (links,player){
                        return '选择急袭的目标';
                    },
                },
                ai:{
                    order:10,
                    result:{
                        player:function (player){
                            return player.storage.tuntian.length-1;
                        },
                    },
                },
            },
            "mizhao1":{
                enable:"phaseUse",
                usable:1,
                audio:"ext:异界四国:2",
                filter:function (event,player){
        return player.countCards('h')>0;
    },
                filterCard:true,
                selectCard:-1,
                filterTarget:function (card,player,target){
        return player!=target;
    },
                discard:false,
                prepare:"give2",
                ai:{
                    order:1,
                    result:{
                        player:0,
                        target:function (player,target){
                if(target.hasSkillTag('nogain')) return 0;
                if(player.countCards('h')>1){
                    return 1;
                }
                var players=game.filterPlayer();
                for(var i=0;i<players.length;i++){
                    if(players[i].countCards('h')&&players[i]!=target&&players[i]!=player&&get.attitude(player,players[i])<0){
                        break;
                    }
                }
                if(i==players.length){
                    return 1;
                }
                return -2/(target.countCards('h')+1);
            },
                    },
                },
                content:function (){
        "step 0"
        event.target1=targets[0];
        targets[0].gain(cards,player);
        var players=game.filterPlayer();
        for(var i=0;i<players.length;i++){
            if(players[i].countCards('h')&&players[i]!=event.target1&&players[i]!=player){
                break;
            }
        }
        if(i==players.length){
            event.finish();
        }
        "step 1"
        player.chooseTarget(true,'选择拼点目标',function(card,player,target){
            return target.countCards('h')&&target!=_status.event.target1&&target!=player;
        }).set('ai',function(target){
            var player=_status.event.player;
            var eff=get.effect(target,{name:'sha'},_status.event.target1,player);
            var att=get.attitude(player,target);
            if(att>0){
                return eff-10;
            }
            return eff;
        }).set('target1',event.target1);
        "step 2"
        if(result.targets.length){
            event.target2=result.targets[0];
            event.target1.line(event.target2);
            event.target1.chooseToCompare(event.target2);
        }
        else{
            event.finish();
        }
        "step 3"
        if(!result.tie){
            if(result.bool){
                event.target1.useCard({name:'sha'},event.target2);
            }
            else{
                event.target2.useCard({name:'sha'},event.target1);
            }
        }
    },
            },
            "hongde1":{
                trigger:{
                    player:["gainEnd","loseEnd"],
                },
                direct:true,
                filter:function (event,player){
        return event.cards&&event.cards.length>1;
    },
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('hongde1'),function(card,player,target){
            return target!=player;
        }).set('ai',function(target){
            return get.attitude(player,target);
        });
        'step 1'
        if(result.bool){
            player.logSkill('hongde1',result.targets);
            result.targets[0].draw();
        }
    },
            },
            "shenxing1":{
                audio:"ext:异界四国:2",
                enable:"phaseUse",
                position:"he",
                filterCard:true,
                selectCard:2,
                prompt:"弃置两张牌并摸一张牌",
                check:function (card){return 4-get.useful(card)},
                content:function (){
        player.draw();
    },
                ai:{
                    order:1,
                    result:{
                        player:1,
                    },
                },
            },
            "wuyan1":{
                audio:"ext:异界四国:2",
                trigger:{
                    source:"damageBefore",
                    player:"damageBefore",
                },
                forced:true,
                priority:15,
                check:function (event,player){
        if(player==event.player) return true;
        return false;
    },
                filter:function (event,player){
        return get.type(event.card,'trick')=='trick';
    },
                content:function (){
        trigger.cancel();
    },
                ai:{
                    notrick:true,
                    notricksource:true,
                    effect:{
                        target:function (card,player,target,current){
                if(get.type(card)=='trick'&&get.tag(card,'damage')){
                    return 'zeroplayertarget';
                }
            },
                        player:function (card,player,target,current){
                if(get.type(card)=='trick'&&get.tag(card,'damage')){
                    return 'zeroplayertarget';
                }
            },
                    },
                },
            },
            "pingkou1":{
                group:["pingkou_init","pingkou_count"],
                subSkill:{
                    init:{
                        trigger:{
                            player:"phaseBegin",
                        },
                        silent:true,
                        content:function (){
                player.storage.pingkou=0;
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                    count:{
                        trigger:{
                            player:["phaseJudgeCancelled","phaseJudgeSkipped","phaseDrawCancelled","phaseDrawSkipped","phaseUseCancelled","phaseUseSkipped","phaseDiscardCancelled","phaseDiscardSkipped"],
                        },
                        silent:true,
                        content:function (){
                player.storage.pingkou++;
                console.log(event.triggername,trigger.name)
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                },
                trigger:{
                    player:"phaseEnd",
                },
                direct:true,
                filter:function (event,player){
        return player.storage.pingkou>0;
    },
                content:function (){
        'step 0'
        player.chooseTarget([1,player.storage.pingkou],get.prompt2('pingkou'),function(card,player,target){
            return target!=player;
        }).set('ai',function(target){
            var player=_status.event.player;
            return get.damageEffect(target,player,player);
        });
        'step 1'
        if(result.bool){
            player.logSkill('pingkou',result.targets);
            event.targets=result.targets.slice(0).sortBySeat();
        }
        else{
            event.finish();
        }
        'step 2'
        if(event.targets&&event.targets.length){
            event.targets.shift().damage();
            event.redo();
        }
    },
                ai:{
                    combo:"fenli",
                    effect:{
                        target:function (card){
                if(card.name=='lebu'||card.name=='bingliang') return 0.5;
            },
                    },
                },
            },
            "zhenwei1":{
                trigger:{
                    global:"useCardToBefore",
                },
                direct:true,
                priority:5,
                filter:function (event,player){
        if(player==event.target||player==event.player) return false;
        if(!player.countCards('he')) return false;
        if(event.targets.length>1) return false;
        if(!event.target) return false;
        if(event.target.hp>=player.hp) return false;

        var card=event.card;
        if(card.name=='sha') return true;
        if(get.color(card)=='black'&&get.type(card)=='trick') return true;
        return false;
    },
                content:function (){
        "step 0"
        var save=false;
        if(get.attitude(player,trigger.target)>2){
            if(trigger.card.name=='sha'){
                if(player.countCards('h','shan')||player.getEquip(2)||
                trigger.target.hp==1||player.hp>trigger.target.hp+1){
                    if(!trigger.target.countCards('h','shan')||trigger.target.countCards('h')<player.countCards('h')){
                        save=true;
                    }
                }
            }
            else if(trigger.card.name=='juedou'&&trigger.target.hp==1){
                save=true;
            }
            else if(trigger.card.name=='shunshou'&&
                get.attitude(player,trigger.player)<0&&
                get.attitude(trigger.player,trigger.target)<0){
                save=true;
            }
        }
        var next=player.chooseToDiscard('he',get.prompt('zhenwei'));
        next.logSkill=['zhenwei',trigger.target];
        next.set('ai',function(card){
            if(_status.event.aisave){
                return 7-get.value(card);
            }
            return 0;
        });
        next.set('aisave',save);
        "step 1"
        if(result.bool){
            player.chooseControl('转移','失效',function(){
                var trigger=_status.event.getTrigger();
                var player=_status.event.player;
                if(trigger.card.name=='sha'){
                    if(player.countCards('h','shan')) return '转移';
                }
                else if(trigger.card.name=='juedou'){
                    if(player.countCards('h','sha')) return '转移';
                }
                return '失效';
            }).set('prompt','将'+get.translation(trigger.card)+'转移给你，或令其失效');
        }
        else{
            event.finish();
        }
        "step 2"
        if(result.control=='转移'){
            player.draw();
            trigger.target=player;
            trigger.targets.length=0;
            trigger.targets.push(player);
            trigger.untrigger();
            trigger.trigger('useCardToBefore');
            trigger.trigger(trigger.card.name+'Before');
            trigger.player.line(player);
        }
        else{
            if(get.itemtype(trigger.card)=='card'){
                trigger.player.$gain2(trigger.card);
                if(!trigger.player.storage.zhenwei2){
                    trigger.player.storage.zhenwei2=[trigger.card];
                }
                else{
                    trigger.player.storage.zhenwei2.push(trigger.card);
                }
                ui.special.appendChild(trigger.card);
                trigger.player.markSkill('zhenwei2');
            }
            trigger.cancel();
            trigger.player.addSkill('zhenwei2');
        }
        game.delay();
    },
                ai:{
                    threaten:1.1,
                },
            },
            "xinshensu1":{
                group:["shensu1","shensu2","shensu4"],
            },
            "jianzheng1":{
                trigger:{
                    global:"useCard",
                },
                filter:function (event,player){
        if(!player.countCards('h')) return false;
        return event.player!=player&&event.card.name=='sha'&&!event.targets.contains(player)&&
            get.distance(event.player,player,'attack')<=1;
    },
                direct:true,
                content:function (){
        "step 0"
        var effect=0;
        for(var i=0;i<trigger.targets.length;i++){
            effect-=get.effect(trigger.targets[i],trigger.card,trigger.player,player);
        }
        if(effect>0){
            if(get.color(trigger.card)!='black'){
                effect=0;
            }
            else{
                effect=1;
            }
            if(trigger.targets.length==1){
                if(trigger.targets[0].hp==1){
                    effect++;
                }
                if(effect>0&&trigger.targets[0].countCards('h')<player.countCards('h')){
                    effect++;
                }
            }
            if(effect>0){
                effect+=6;
            }
        }
        player.chooseCard('h',get.prompt2('jianzheng',trigger.player)).set('ai',function(card){
            if(_status.event.effect>=0){
                var val=get.value(card);
                if(val<0) return 10-val;
                return _status.event.effect-val;
            }
            return 0;
        }).set('effect',effect).set('logSkill',['jianzheng',trigger.player]);
        "step 1"
        if(result.bool&&result.cards){
            event.card=result.cards[0];
            trigger.targets.length=0;
            trigger.untrigger();
        }
        else{
            event.finish();
        }
        "step 2"
        if(!event.isMine()) game.delayx();
        "step 3"
        if(event.card){
            player.logSkill('jianzheng',trigger.player);
            player.lose(result.cards,ui.special);
            game.broadcastAll(function(player){
                var cardx=ui.create.card();
                cardx.classList.add('infohidden');
                cardx.classList.add('infoflip');
                player.$throw(cardx,1000,'nobroadcast');
            },player);
        }
        "step 4"
        if(event.card){
            event.card.fix();
            ui.cardPile.insertBefore(event.card,ui.cardPile.firstChild);
        }
        "step 5"
        if(get.color(trigger.card)!='black'){
            trigger.targets.push(player);
            trigger.player.line(player);
            game.delay();
            trigger.trigger('useCard');
        }
    },
            },
            cunmu:{
                audio:"ext:2",
                trigger:{
                    player:"drawBegin",
                },
                forced:true,
                content:function (){
        'step 0'
        trigger.cancel();
        event.list=[];
        event.num=0;
        'step 1'
        event.list.push(ui.cardPile.removeChild(ui.cardPile.lastChild));
        event.num++;
        if(event.num<trigger.num) event.redo();
        'step 2'
        if(ui.cardPileNumber) ui.cardPileNumber.innerHTML=game.roundNumber+'轮 剩余牌: '+ui.cardPile.childNodes.length;
        player.gain(event.list);
        player.$draw(trigger.num);
        game.log(player,'从牌堆底摸'+get.cnNumber(trigger.num)+'张牌');
    },
            },
            xinguanxing:{
                audio:"guanxing",
                alter:true,
                trigger:{
                    player:["phaseBegin","phaseEnd"],
                },
                frequent:true,
                filter:function (event,player,name){
        if(name=='phaseEnd'){
            return player.hasSkill('xinguanxing_on');
        }
        return true;
    },
                content:function (){
        'step 0'
        if(get.is.altered('xinguanxing')){
            event.num=game.countPlayer()<4?3:5;
        }
        else{
            event.num=Math.min(5,game.countPlayer());
        }
        event.cards=get.cards(event.num);
        event.chosen=[];
        event.num1=0;
        event.num2=0;
        event.bottom=-1;
        'step 1'
        var js=player.getCards('j');
        var pos;
        var choice=-1;
        var getval=function(card,pos){
            if(js[pos]){
                return (get.judge(js[pos]))(card);
            }
            else if(event.triggername=='phaseEnd'&&get.attitude(player,player.getNext())<=0){
                return 11.5-get.value(card,player);
            }
            else{
                return get.value(card,player);
            }
        };
        event.discard=false;
        var minval=6;
        for(pos=0;pos<event.cards.length;pos++){
            var max=getval(event.cards[pos],pos);
            for(var j=pos+1;j<event.cards.length;j++){
                var current=getval(event.cards[j],pos);
                if(current>max){
                    choice=j;
                    max=current;
                }
            }
            if(event.bottom<0){
                if(!js[pos]){
                    if(max<minval){
                        event.bottom=pos;
                    }
                }
                else if(max<0){
                    event.bottom=pos;
                }
            }
            if(event.bottom>=0&&event.bottom<=pos){
                choice=pos;
                event.discard=true;break;
            }
            if(choice!=-1){
                break;
            }
        }
        player.chooseCardButton('观星：选择要移动的牌',event.cards).set('filterButton',function(button){
            return !_status.event.chosen.contains(button.link);
        }).set('chosen',event.chosen).set('ai',function(button){
            return button.link==_status.event.choice?1:0;
        }).set('choice',event.cards[choice]);
        event.pos=pos;
        'step 2'
        if(result.bool){
            var card=result.links[0];
            var index=event.cards.indexOf(card);
            event.card=card;
            event.chosen.push(card);
            event.cards.remove(event.card);
            var controlai=event.pos||0;
            if(event.discard){
                controlai=event.cards.length+1;
            }
            var buttons=event.cards.slice(0);
            player.chooseControl(function(){
                return _status.event.controlai;
            }).set('controlai',controlai).set('sortcard',buttons).set('tosort',card);
        }
        else{
            event.goto(4);
        }
        'step 3'
        if(typeof result.index=='number'){
            if(result.index>event.cards.length){
                ui.cardPile.appendChild(event.card);
                event.num2++;
            }
            else{
                event.cards.splice(result.index,0,event.card);
            }
            event.num--;
            if(event.num>0){
                event.goto(1);
            }
        }
        'step 4'
        while(event.cards.length){
            ui.cardPile.insertBefore(event.cards.pop(),ui.cardPile.firstChild);
            event.num1++;
        }
        var js=player.getCards('j');
        if(js.length==1){
            if((get.judge(js[0]))(ui.cardPile.firstChild)<0){
                player.addTempSkill('guanxing_fail');
            }
        }
        player.popup(get.cnNumber(event.num1)+'上'+get.cnNumber(event.num2)+'下');
        game.log(player,'将','#y'+get.cnNumber(event.num1)+'张牌','置于牌堆顶，','#y'+get.cnNumber(event.num2)+'张牌','置于牌堆底');
        if(event.triggername=='phaseBegin'&&get.is.altered('xinguanxing')&&event.num1==0){
            player.addTempSkill('xinguanxing_on');
        }
    },
                subSkill:{
                    on:{
                        sub:true,
                    },
                },
            },
            "shouxi1":{
                trigger:{
                    target:"shaBefore",
                },
                direct:true,
                init:function (player){
        player.storage.shouxi=[];
    },
                content:function (){
        'step 0'
        var list=['sha','shan','tao','jiu','taoyuan','wugu','juedou','huogong','jiedao','tiesuo','guohe','shunshou','wuzhong','wanjian','nanman','lebu','bingliang','shandian'];
        for(var i=0;i<player.storage.shouxi.length;i++){
            list.remove(player.storage.shouxi[i]);
        }
        for(var i=0;i<list.length;i++){
            list[i]=[get.type(list[i]),'',list[i]];
        }
        player.chooseButton([get.prompt('shouxi',trigger.player),[list,'vcard']]).set('ai',function(button){
            return Math.random();
        });
        'step 1'
        if(result.bool){
            player.logSkill('shouxi');
            var name=result.links[0][2];
            var card=game.createCard(name,get.type(name),'');
            event.cardname=name;
            player.storage.shouxi.add(name);
            player.showCards(get.translation(player)+'声明了'+get.translation(name),card);
        }
        else{
            event.finish();
        }
        'step 2'
        var name=event.cardname;
        trigger.player.chooseToDiscard('守玺：弃置一张'+get.translation(name)+'，否则杀对'+get.translation(player)+'无效',function(card){
            return card.name==_status.event.cardname;
        }).set('ai',function(card){
            if(_status.event.att<0){
                return 10-get.value(card);
            }
            return 0;
        }).set('att',get.attitude(trigger.player,player)).set('cardname',name);
        'step 3'
        if(result.bool==false){
            trigger.cancel();
        }
        else{
            trigger.player.gainPlayerCard(player);
        }
    },
                ai:{
                    effect:{
                        target:function (card,player,target,current){
                if(card.name=='sha'&&get.attitude(player,target)<0){
                    return 0.3;
                }
            },
                    },
                },
            },
            danshou:{
                enable:"phaseUse",
                filterCard:true,
                position:"he",
                audio:2,
                filter:function (event,player){
                    var num=player.getStat().skill.danshou;
                    if(num){
                        num++;
                    }
                    else{
                        num=1;
                    }
                    return player.countCards('he')>=num;
                },
                check:function (card){
                    if(ui.selected.cards.length>=2){
                        return 4-get.value(card);
                    }
                    return 6-get.value(card);
                },
                selectCard:function (card){
                    var num=_status.event.player.getStat().skill.danshou;
                    if(num) return num+1;
                    return 1;
                },
                filterTarget:function (card,player,target){
                    if(player==target) return false;
                    var num=player.getStat().skill.danshou;
                    if(num){
                        num++;
                    }
                    else{
                        num=1;
                    }
                    if(num<=2&&!target.countCards('he')) return false;
                    return get.distance(player,target,'attack')<=1;
                },
                content:function (){
                    'step 0'
                    var num=player.getStat().skill.danshou;
                    switch(num){
                        case 1:player.discardPlayerCard(target,true);break;
                        case 2:target.chooseCard('选择一张牌交给'+get.translation(player),'he',true);break;
                        case 3:target.damage();break;
                        default:game.asyncDraw([player,target],2);
                    }
                    if(num!=2) event.finish();
                    'step 1'
                    if(result.cards){
                        player.gain(result.cards,target);
                        target.$give(result.cards.length,player);
                    }
                },
                ai:{
                    order:8.6,
                    result:{
                        target:function (player,target){
                            var num=player.getStat().skill.danshou;
                            if(num){
                                num++;
                            }
                            else{
                                num=1;
                            }
                            if(num>3) return 0;
                            if(num==3) return get.damageEffect(target,player,target);
                            return -1;
                        },
                    },
                },
            },
            "haosh1i":{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"phaseDrawBegin",
                },
                threaten:1.4,
                check:function (event,player){
        if(player.countCards('h')<=1) return true;
        return game.hasPlayer(function(current){
            return current!=player&&current.isMinHandcard()&&get.attitude(player,current)>0;
        });
    },
                content:function (){
        trigger.num+=2;
        player.addSkill('haoshi2');
    },
                ai:{
                    threaten:2,
                    ai:{
                        noh:true,
                        skillTagFilter:function (player,tag){
                if(tag=='noh'){
                    if(player.countCards('h')!=2) return false;
                }
            },
                    },
                },
            },
            "beige1":{
                audio:"ext:异界四国:4",
                trigger:{
                    global:"damageEnd",
                },
                filter:function (event,player){
        return (event.card&&event.card.name=='sha'&&event.source&&
            event.player.classList.contains('dead')==false&&player.countCards('he'));
    },
                direct:true,
                checkx:function (event,player){
        var att1=get.attitude(player,event.player);
        var att2=get.attitude(player,event.source);
        return att1>0&&att2<=0;
    },
                content:function (){
        "step 0"
        var next=player.chooseToDiscard('he',get.prompt('beige'));
        var check=lib.skill.beige.checkx(trigger,player);
        next.set('ai',function(card){
            if(_status.event.goon) return 8-get.value(card);
            return 0;
        });
        next.set('logSkill','beige');
        next.set('goon',check);
        "step 1"
        if(result.bool){
            trigger.player.judge();
        }
        else{
            event.finish();
        }
        "step 2"
        switch(get.suit(result.card)){
            case 'heart':trigger.player.recover();break;
            case 'diamond':trigger.player.draw(2);break;
            case 'club':trigger.source.chooseToDiscard('he',2,true);break;
            case 'spade':trigger.source.turnOver();break;
        }
    },
                ai:{
                    expose:0.3,
                },
            },
            "jieming1":{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"damageEnd",
                },
                direct:true,
                content:function (){
        "step 0"
        player.chooseTarget(get.prompt('jieming'),[1,trigger.num],function(card,player,target){
            return target.countCards('h')<Math.min(target.maxHp,5);
        }).set('ai',function(target){
            var att=get.attitude(_status.event.player,target);
            if(att>2){
                return Math.min(5,target.maxHp)-target.countCards('h');
            }
            return att/3;
        });
        "step 1"
        if(result.bool){
            player.logSkill('jieming',result.targets);
            for(var i=0;i<result.targets.length;i++){
                result.targets[i].draw(Math.min(5,result.targets[i].maxHp)-result.targets[i].countCards('h'));
            }
        }
    },
                ai:{
                    maixie:true,
                    "maixie_hp":true,
                    effect:{
                        target:function (card,player,target,current){
                if(get.tag(card,'damage')&&target.hp>1){
                    if(player.hasSkillTag('jueqing',false,target)) return [1,-2];
                    var max=0;
                    var players=game.filterPlayer();
                    for(var i=0;i<players.length;i++){
                        if(get.attitude(target,players[i])>0){
                            max=Math.max(Math.min(5,players[i].hp)-players[i].countCards('h'),max);
                        }
                    }
                    switch(max){
                        case 0:return 2;
                        case 1:return 1.5;
                        case 2:return [1,2];
                        default:return [0,max];
                    }
                }
                if((card.name=='tao'||card.name=='caoyao')&&
                    target.hp>1&&target.countCards('h')<=target.hp) return [0,0];
            },
                    },
                },
            },
            "qianxi1":{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"phaseBegin",
                },
                content:function (){
        "step 0"
        player.draw();
        player.chooseToDiscard('he',true);
        "step 1"
        if(!result.bool){
            event.finish();
            return;
        }
        event.color=get.color(result.cards[0]);
        player.chooseTarget(function(card,player,target){
            return player!=target&&get.distance(player,target)<=1;
        },true).set('ai',function(target){
            return -get.attitude(_status.event.player,target);
        });
        "step 2"
        if(result.bool&&result.targets.length){
            result.targets[0].storage.qianxi2=event.color;
            result.targets[0].addSkill('qianxi2');
            player.line(result.targets,'green');
            game.addVideo('storage',result.targets[0],['qianxi2',event.color]);
        }
    },
            },
            "qianxi2":{
                trigger:{
                    global:"phaseAfter",
                },
                forced:true,
                mark:true,
                audio:false,
                content:function (){
                    player.removeSkill('qianxi2');
                    delete player.storage.qianxi2;
                },
                mod:{
                    cardEnabled:function (card,player){
                        if(get.color(card)==player.storage.qianxi2) return false;
                    },
                    cardUsable:function (card,player){
                        if(get.color(card)==player.storage.qianxi2) return false;
                    },
                    cardRespondable:function (card,player){
                        if(get.color(card)==player.storage.qianxi2) return false;
                    },
                    cardSavable:function (card,player){
                        if(get.color(card)==player.storage.qianxi2) return false;
                    },
                },
                intro:{
                    content:function (color){
                        return '不能使用或打出'+get.translation(color)+'的牌';
                    },
                },
            },
            "retieqi1":{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"shaBegin",
                },
                check:function (event,player){
        return get.attitude(player,event.target)<0;
    },
                logTarget:"target",
                content:function (){
        "step 0"
        player.judge(function(){return 0});
        if(!trigger.target.hasSkill('fengyin')){
            trigger.target.addTempSkill('fengyin');
        }
        "step 1"
        var suit=get.suit(result.card);
        var target=trigger.target;
        var num=target.countCards('h','shan');
        target.chooseToDiscard('请弃置一张'+get.translation(suit)+'牌，否则不能使用闪抵消此杀','he',function(card){
            return get.suit(card)==_status.event.suit;
        }).set('ai',function(card){
            var num=_status.event.num;
            if(num==0) return 0;
            if(card.name=='shan') return num>1?2:0;
            return 8-get.value(card);
        }).set('num',num).set('suit',suit);
        "step 2"
        if(!result.bool){
            trigger.directHit=true;
        }
    },
            },
            "xiansi1":{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"phaseBegin",
                },
                direct:true,
                init:function (player){
        player.storage.xiansi=[];
    },
                content:function (){
        "step 0"
        player.chooseTarget(get.prompt('xiansi'),[1,2],function(card,player,target){
            return target.countCards('he')>0;
        },function(target){
            return -get.attitude(_status.event.player,target);
        });
        "step 1"
        if(result.bool){
            player.logSkill('xiansi',result.targets);
            event.targets=result.targets;
        }
        else{
            event.finish();
        }
        "step 2"
        if(event.targets.length){
            var target=event.targets.shift();
            event.current=target;
            player.choosePlayerCard(target,true);
        }
        else{
            event.finish();
        }
        "step 3"
        if(result.bool){
            player.storage.xiansi=player.storage.xiansi.concat(result.links);
            player.markSkill('xiansi');
            player.syncStorage('xiansi');
            event.current.lose(result.links,ui.special);
            event.current.$give(result.links,player);
            event.goto(2);
        }
    },
                intro:{
                    content:"cards",
                    onunmark:function (storage,player){
            if(storage&&storage.length){
                for(var i=0;i<storage.length;i++){
                    storage[i].discard();
                }
                player.$throw(storage);
                player.storage.xiansi.length=0;
            }
        },
                },
                ai:{
                    threaten:2,
                },
                global:"xiansi2",
            },
            "qieting1":{
                audio:"ext:异界四国:2",
                global:"qieting2",
                globalSilent:true,
                trigger:{
                    global:"phaseEnd",
                },
                filter:function (event,player){
        return event.player!=player&&!event.player.tempSkills.qieting3&&event.player.isAlive();
    },
                direct:true,
                content:function (){
        "step 0"
        var next;
        if(trigger.player.hasCard(function(card){
            return !player.getEquip(card);
        },'e')){
            next=player.chooseControl('移动装备','draw_card','cancel2',function(event,player){
                var source=_status.event.source;
                var att=get.attitude(player,source);
                if(source.hasSkillTag('noe')){
                    if(att>0){
                        return '移动装备';
                    }
                }
                else{
                    if(att<=0){
                        return '移动装备';
                    }
                }
                return 'draw_card';
            }).set('source',trigger.player);
        }
        else{
            next=player.chooseControl('draw_card','cancel2',function(){
                return 'draw_card';
            });
        }
        next.set('prompt',get.prompt('qieting',trigger.player));
        "step 1"
        if(result.control=='移动装备'){
            player.logSkill('qieting',trigger.player);
            player.choosePlayerCard(trigger.player,'e','将一张装备牌移至你的装备区').set('filterButton',function(button){
                return !_status.event.player.getEquip(button.link);
            });
        }
        else{
            if(result.control=='draw_card'){
                player.logSkill('qieting');
                player.draw();
            }
            event.finish();
        }
        "step 2"
        if(result&&result.links&&result.links.length){
            game.delay(2);
            trigger.player.$give(result.links[0],player);
            player.equip(result.links[0]);
            player.addExpose(0.2);
        }
    },
            },
            "qieting2":{
                trigger:{
                    player:"useCard",
                },
                filter:function (event,player){
                    return _status.currentPhase==player&&event.targets&&(event.targets.length>1||event.targets[0]!=player);
                },
                forced:true,
                popup:false,
                content:function (){
                    player.addTempSkill('qieting3');
                },
            },
            "qieting3":{
            },
            "shenxian1":{
                audio:"ext:异界四国:2",
                trigger:{
                    global:"discardAfter",
                },
                filter:function (event,player){
        if(event.player==player||_status.currentPhase==player) return false;
        if(player.hasSkill('shenxian2')) return false;
        for(var i=0;i<event.cards.length;i++){
            if(get.type(event.cards[i])=='basic'){
                return true;
            }
        }
        return false;
    },
                frequent:true,
                content:function (){
        "step 0"
        if(trigger.delay==false) game.delay();
        "step 1"
        player.draw();
        player.addTempSkill('shenxian2');
    },
                ai:{
                    threaten:1.5,
                },
            },
            "shenxian2":{
            },
            "shuangxiong1":{
                audio:"ext:异界四国:true",
                trigger:{
                    player:"phaseDrawBefore",
                },
                check:function (event,player){
        if(player.countCards('h')>player.hp) return true;
        if(player.countCards('h')>3) return true;
        return false;
    },
                content:function (){
        "step 0"
        player.judge(ui.special);
        "step 1"
        player.gain(result.card);
        player.$gain2(result.card);
        player.addTempSkill('shuangxiong2');
        player.storage.shuangxiong=get.color(result.card);
        trigger.cancel();
    },
            },
            "shuangxiong2":{
                audio:true,
                enable:"phaseUse",
                viewAs:{
                    name:"juedou",
                },
                filterCard:function (card,player){
                    return get.color(card)!=player.storage.shuangxiong;
                },
                check:function (card){
                    return 8-get.value(card);
                },
                ai:{
                    basic:{
                        order:10,
                    },
                },
            },
            "xinjuece1":{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"phaseEnd",
                },
                direct:true,
                filter:function (event,player){
        return game.hasPlayer(function(player){
            return player.countCards('h')==0;
        });
    },
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('xinjuece'),function(card,player,target){
            return target.countCards('h')==0;
        }).set('ai',function(target){
            var player=_status.event.player;
            return get.damageEffect(target,player,player);
        });
        'step 1'
        if(result.bool){
            player.logSkill('juece',result.targets);
            result.targets[0].damage();
        }
    },
            },
            "xinfencheng1":{
                skillAnimation:"epic",
                animationColor:"fire",
                audio:"ext:异界四国:2",
                enable:"phaseUse",
                filter:function (event,player){
        return !player.storage.xinfencheng;
    },
                filterTarget:function (card,player,target){
        return player!=target;
    },
                unique:true,
                selectTarget:-1,
                multitarget:true,
                multiline:true,
                mark:true,
                line:"fire",
                content:function (){
        "step 0"
        player.storage.xinfencheng=true;
        player.awakenSkill('xinfencheng');
        event.num=1;
        event.targets=targets.slice(0);
        event.targets.sort(lib.sort.seat);
        "step 1"
        if(event.targets.length){
            var target=event.targets.shift();
            event.target=target;
            var res=get.damageEffect(target,player,target,'fire');
            target.chooseToDiscard('he','弃置至少'+get.cnNumber(event.num)+'张牌或受到2点火焰伤害',[num,Infinity]).set('ai',function(card){
                if(ui.selected.cards.length>=_status.event.getParent().num) return -1;
                if(_status.event.player.hasSkillTag('nofire')) return -1;
                if(_status.event.res>=0) return 6-get.value(card);
                if(get.type(card)!='basic'){
                    return 10-get.value(card);
                }
                return 8-get.value(card);
            }).set('res',res);
        }
        else{
            event.finish();
        }
        "step 2"
        if(!result.bool){
            event.target.damage(2,'fire');
            event.num=1;
        }
        else{
            event.num=result.cards.length+1;
        }
        event.goto(1);
    },
                ai:{
                    order:1,
                    result:{
                        player:function (player){
                var num=0,players=game.filterPlayer();
                for(var i=0;i<players.length;i++){
                    if(player!=players[i]&&get.damageEffect(players[i],player,players[i],'fire')<0){
                        var att=get.attitude(player,players[i]);
                        if(att>0){
                            num--;
                        }
                        else if(att<0){
                            num++;
                        }
                    }
                }
                if(game.players.length<5){
                    return num-1;
                }
                else{
                    return num-2;
                }
            },
                    },
                },
                init:function (player){
        player.storage.xinfencheng=false;
    },
                intro:{
                    content:"limited",
                },
            },
            guixin:{
                audio:2,
                alter:true,
                trigger:{
                    player:"damageEnd",
                },
                check:function (event,player){
        if(player.isTurnedOver()||event.num>1) return true;
        var num=game.countPlayer(function(current){
            if(current.countCards('he')&&current!=player&&get.attitude(player,current)<=0){
                return true;
            }
            if(current.countCards('j')&&current!=player&&get.attitude(player,current)>0){
                return true;
            }
        });
        return num>=2;
    },
                content:function (){
        "step 0"
        var targets=game.filterPlayer();
        targets.remove(player);
        targets.sort(lib.sort.seat);
        event.targets=targets;
        event.count=trigger.num;
        "step 1"
        event.num=0;
        player.line(targets,'green');
        "step 2"
        if(num<event.targets.length){
            if(!get.is.altered('guixin')){
                if(event.targets[num].countGainableCards(player,'hej')){
                    player.gainPlayerCard(event.targets[num],true,'hej');
                }
            }
            else{
                var hej=event.targets[num].getCards('hej')
                if(hej.length){
                    var card=hej.randomGet();
                    player.gain(card,event.targets[num]);
                    if(get.position(card)=='h'){
                        event.targets[num].$giveAuto(card,player);
                    }
                    else{
                        event.targets[num].$give(card,player);
                    }
                }
            }
            event.num++;
            event.redo();
        }
        "step 3"
        player.turnOver();
        "step 4"
        event.count--;
        if(event.count){
            player.chooseBool(get.prompt2('guixin'));
        }
        else{
            event.finish();
        }
        "step 5"
        if(event.count&&result.bool){
            event.goto(1);
        }
    },
                ai:{
                    maixie:true,
                    "maixie_hp":true,
                    threaten:function (player,target){
            if(target.hp==1) return 2.5;
            return 1;
        },
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'damage')){
                    if(player.hasSkillTag('jueqing',false,target)) return [1,-2];
                    if(target.hp==1) return 0.8;
                    if(target.isTurnedOver()) return [0,3];
                    var num=game.countPlayer(function(current){
                        if(current.countCards('he')&&current!=player&&get.attitude(player,current)<=0){
                            return true;
                        }
                        if(current.countCards('j')&&current!=player&&get.attitude(player,current)>0){
                            return true;
                        }
                    });
                    if(num>2) return [0,1];
                    if(num==2) return [0.5,1];
                }
            },
                    },
                },
            },
            "mieji1":{
                audio:"ext:异界四国:2",
                enable:"phaseUse",
                usable:1,
                filter:function (event,player){
        return player.countCards('h',{type:['trick','delay'],color:'black'});
    },
                filterCard:function (card){
        return get.color(card)=='black'&&get.type(card,'trick')=='trick';
    },
                filterTarget:function (card,player,target){
        return target!=player&&target.countCards('h')>0;
    },
                discard:false,
                delay:false,
                check:function (card){
        return 8-get.value(card);
    },
                content:function (){
        'step 0'
        player.showCards(cards);
        'step 1'
        ui.cardPile.insertBefore(cards[0],ui.cardPile.firstChild);
        var n1=target.getCards('he',function(card){
            if(!lib.filter.cardDiscardable(card,player)) return false;
            return get.type(card,'trick')=='trick';
        });
        var n2=target.getCards('he',function(card){
            if(!lib.filter.cardDiscardable(card,player)) return false;
            return get.type(card,'trick')!='trick';
        });
        if(n1.length>1||n2.length>2||(n1.length==1&&n2.length==2)){
            target.chooseToDiscard('弃置一张锦囊牌，或两张非锦囊牌',true,'he',function(card,player){
                if(!lib.filter.cardDiscardable(card,player)) return false;
                if(!_status.event.nontrick){
                    return get.type(card,'trick')=='trick';
                }
                if(ui.selected.cards.length){
                    return get.type(card,'trick')!='trick';
                }
                return true;
            }).set('ai',function(card){
                if(get.type(card,'trick')=='trick'){
                    return 8-get.value(card);
                }
                return -get.value(card);
            }).set('selectCard',function(){
                if(ui.selected.cards.length==1&&get.type(ui.selected.cards[0],'trick')=='trick'){
                    return 1;
                }
                return 2;
            }).set('nontrick',n2.length>=2).set('complexCard',true);
        }
        else{
            if(n1.length){
                target.discard(n1);
            }
            else if(n2.length){
                target.discard(n2);
            }
        }
    },
                ai:{
                    order:9,
                    result:{
                        target:-1,
                    },
                },
            },
            "qizhou1":{
                trigger:{
                    player:["phaseBefore","equipAfter","loseAfter"],
                },
                forced:true,
                popup:false,
                derivation:["mashu","yingzi","duanbing","fenwei"],
                filter:function (event,player){
        if(player.equiping) return false;
        var suits=[];
        var es=player.getCards('e');
        for(var i=0;i<es.length;i++){
            suits.add(get.suit(es[i]));
        }
        if(player.additionalSkills.qizhou){
            return player.additionalSkills.qizhou.length!=suits.length;
        }
        else{
            return suits.length>0;
        }
    },
                content:function (){
        var suits=[];
        var es=player.getCards('e');
        for(var i=0;i<es.length;i++){
            suits.add(get.suit(es[i]));
        }
        player.removeAdditionalSkill('qizhou');
        switch(suits.length){
            case 1:player.addAdditionalSkill('qizhou',['mashu']);break;
            case 2:player.addAdditionalSkill('qizhou',['mashu','reyingzi']);break;
            case 3:player.addAdditionalSkill('qizhou',['mashu','reyingzi','duanbing']);break;
            case 4:player.addAdditionalSkill('qizhou',['mashu','reyingzi','duanbing','fenwei']);break;
        }
    },
                ai:{
                    threaten:1.2,
                },
            },
            "dujin1":{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"phaseDrawBegin",
                },
                frequent:true,
                content:function (){
        trigger.num+=1+Math.floor(player.countCards('e')/2);
    },
            },
            "zhichi1":{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"damageEnd",
                },
                forced:true,
                filter:function (event,player){
        return _status.currentPhase!=player;
    },
                content:function (){
        player.addTempSkill('zhichi2',['phaseAfter','phaseBefore']);
    },
            },
            "zhichi2":{
                trigger:{
                    target:"useCardToBefore",
                },
                forced:true,
                priority:15,
                filter:function (event,player){
                    return get.type(event.card)=='trick'||event.card.name=='sha';
                },
                content:function (){
                    game.log(player,'发动了智迟，',trigger.card,'对',trigger.target,'失效')
                    trigger.cancel();
                },
                mark:true,
                intro:{
                    content:"杀或普通锦囊牌对你无效",
                },
                ai:{
                    effect:{
                        target:function (card,player,target,current){
                            if(get.type(card)=='trick'||card.name=='sha') return 'zeroplayertarget';
                        },
                    },
                },
            },
            "xiashu1":{
                trigger:{
                    player:"phaseUseBegin",
                },
                direct:true,
                filter:function (event,player){
        return player.countCards('h')>0;
    },
                content:function (){
        'step 0'
        var maxval=0;
        var hs=player.getCards('h');
        for(var i=0;i<hs.length;i++){
            maxval=Math.max(maxval,get.value(hs[i]));
        }
        player.chooseTarget(get.prompt('xiashu'),lib.filter.notMe).set('ai',function(target){
            var player=_status.event.player;
            var maxval=_status.event.maxval;
            var dh=target.countCards('h')-player.countCards('h');
            var att=get.attitude(player,target);
            if(target.hasSkill('qingjian')) return false;
            if(dh<=0) return 0;
            if(att>0) return 0.1;
            if(maxval>=8) return 0;
            if(att==0) return 0.2;
            if(dh>=3) return dh;
            if(dh==2){
                if(maxval<=7) return dh;
            }
            if(maxval<=6) return dh;
            return 0;

        }).set('maxval',maxval);
        'step 1'
        if(result.bool){
            player.logSkill('xiashu',result.targets);
            event.target=result.targets[0];
            var hs=player.getCards('h');
            event.target.gain(hs,player);
            player.$give(hs.length,event.target);
        }
        else{
            event.finish();
        }
        'step 2'
        var hs=event.target.getCards('h');
        if(!hs.length){
            event.finish();
            return;
        }
        hs.sort(function(a,b){
            return get.value(b,player,'raw')-get.value(a,player,'raw');
        });
        event.target.chooseCard([1,hs.length],'展示至少一张手牌',true).set('ai',function(card){
            var rand=_status.event.rand;
            var list=_status.event.list;
            if(_status.event.att){
                if(ui.selected.cards.length>=Math.ceil(list.length/2)) return 0;
                var value=get.value(card);
                if(_status.event.getParent().player.isHealthy()){
                    value+=(get.tag(card,'damage')?1.5:0)+(get.tag(card,'draw')?2:0);
                }
                return value;
            }
            if(ui.selected.cards.length>=Math.floor(list.length/2)) return 0;
            return (list.indexOf(card)%2==rand)?1:0;
        }).set('rand',(Math.random()<0.6)?1:0).set('list',hs).set('att',get.attitude(event.target,player)>0);
        'step 3'
        event.target.showCards(result.cards);
        event.cards1=result.cards;
        event.cards2=event.target.getCards('h',function(card){
            return !event.cards1.contains(card);
        });
        'step 4'
        var choice;
        var num1=event.cards1.length;
        var num2=event.cards2.length;
        if(get.attitude(event.target,player)>0&&num1>=num2){
            choice=0;
        }
        else if(num1==num2){
            choice=(Math.random()<0.45)?0:1;
        }
        else if(num1>num2){
            if(num1-num2==1){
                choice=(Math.random()<0.6)?0:1;
            }
            else{
                choice=0;
            }
        }
        else{
            if(num2-num1==1){
                choice=(Math.random()<0.6)?1:0;
            }
            else{
                choice=1;
            }
        }
        player.chooseControl(function(event,player){
            return _status.event.choice;
        }).set('choiceList',['获得'+get.translation(event.target)+'展示的牌',
        '获得'+get.translation(event.target)+'未展示的牌']).set('choice',choice);
        'step 5'
        if(result.index==0){
            player.gain(event.cards1,target);
            target.$give(event.cards1,player);
        }
        else{
            player.gain(event.cards2,target);
            target.$giveAuto(event.cards2,player);
        }
    },
                ai:{
                    expose:0.1,
                },
            },
            "kuanshi1":{
                trigger:{
                    player:"phaseEnd",
                },
                direct:true,
                content:function (){
        'step 0'
        player.chooseTarget(get.prompt('kuanshi')).set('ai',function(target){
            if(get.attitude(_status.event.player,target)>0){
                return 1/Math.sqrt(target.hp+1);
            }
            return 0;
        });
        'step 1'
        if(result.bool){
            var target=result.targets[0];
            player.logSkill('kuanshi',target);
            target.storage.kuanshi2=player;
            target.addSkill('kuanshi2');
        }
    },
            },
            "ganlu1":{
                enable:"phaseUse",
                usable:1,
                audio:"ext:异界四国:2",
                selectTarget:2,
                filterTarget:function (card,player,target){
        if(target.isMin()) return false;
        if(ui.selected.targets.length==0) return true;
        if(ui.selected.targets[0].countCards('e')==0&&target.countCards('e')==0) return false;
        return Math.abs(ui.selected.targets[0].countCards('e')-target.countCards('e'))<=player.maxHp-player.hp;
    },
                multitarget:true,
                content:function (){
        "step 0"
        event.cards=[targets[0].getCards('e'),targets[1].getCards('e')];
        targets[0].lose(event.cards[0],ui.special);
        targets[1].lose(event.cards[1],ui.special);
        if(event.cards[0].length) targets[0].$give(event.cards[0],targets[1]);
        if(event.cards[1].length) targets[1].$give(event.cards[1],targets[0]);
        "step 1"
        for(var i=0;i<event.cards[1].length;i++){
            targets[0].equip(event.cards[1][i]);
        }
        for(var i=0;i<event.cards[0].length;i++){
            targets[1].equip(event.cards[0][i]);
        }
    },
                ai:{
                    order:10,
                    threaten:function (player,target){
            return 0.8*Math.max(1+target.maxHp-target.hp);
        },
                    result:{
                        target:function (player,target){
                var list1=[];
                var list2=[];
                var num=player.maxHp-player.hp;
                var players=game.filterPlayer();
                for(var i=0;i<players.length;i++){
                    if(get.attitude(player,players[i])>0) list1.push(players[i]);
                    else if(get.attitude(player,players[i])<0) list2.push(players[i]);
                }
                list1.sort(function(a,b){
                    return a.countCards('e')-b.countCards('e');
                });
                list2.sort(function(a,b){
                    return b.countCards('e')-a.countCards('e');
                });
                var delta;
                for(var i=0;i<list1.length;i++){
                    for(var j=0;j<list2.length;j++){
                        delta=list2[j].countCards('e')-list1[i].countCards('e');
                        if(delta<=0) continue;
                        if(delta<=num){
                            if(target==list1[i]||target==list2[j]){
                                return get.attitude(player,target);
                            }
                            return 0;
                        }
                    }
                }
                return 0;
            },
                    },
                    effect:{
                        target:function (card,player,target){
                if(target.hp==target.maxHp&&get.tag(card,'damage')) return 0.2;
            },
                    },
                },
            },
            "duanxie1":{
                enable:"phaseUse",
                usable:1,
                audio:"ext:异界四国:2",
                filterTarget:function (card,player,target){
        return player!=target&&!target.isLinked();
    },
                content:function (){
        "step 0"
        if(!target.isLinked()) target.link();
        "step 1"
        if(!player.isLinked()) player.link();
    },
                ai:{
                    result:{
                        target:-1,
                        player:function (player){
                return player.isLinked()?0:-0.8;
            },
                    },
                    order:2,
                    expose:0.3,
                    effect:{
                        target:function (card){
                if(card.name=='tiesuo'){
                    return 0.5;
                }
            },
                    },
                },
            },
            fenmin:{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"phaseEnd",
                },
                check:function (event,player){
        var num=game.countPlayer(function(current){
            if(current.isLinked()&&current.countCards('he')){
                return get.attitude(player,current);
            }
        });
        return num<0;
    },
                filter:function (event,player){
        return player.isLinked();
    },
                content:function (){
        "step 0"
        event.targets=game.filterPlayer(function(current){
            if(current.isLinked()&&current.countCards('he')){
                return true;
            }
        });
        event.num=0;
        event.targets.sort(lib.sort.seat);
        "step 1"
        if(event.num<event.targets.length){
            var target=event.targets[event.num];
            if(player==target){
                player.chooseToDiscard(true,'he');
            }
            else{
                player.discardPlayerCard(true,'he',target);
            }
            event.num++;
            event.redo();
        }
    },
            },
            "taiji1":{
                trigger:{
                    player:"respond",
                },
                filter:function (event,player){
        return event.card.name=='shan'&&player.hasSha();
    },
                direct:true,
                content:function (){
        player.chooseToUse({name:'sha'},'太极：是否使用一张杀？').logSkill='taiji';
    },
            },
            "jiudu1":{
                audio:"ext:异界四国:2",
                trigger:{
                    global:"phaseUseBegin",
                },
                filter:function (event,player){
        return event.player!=player&&player.countCards('h')>0;
    },
                direct:true,
                content:function (){
        "step 0"
        var nono=(Math.abs(get.attitude(player,trigger.player))<3);
        if(get.damageEffect(trigger.player,player,player)<=0){
            nono=true
        }
        else if(trigger.player.hp>2){
            nono=true;
        }
        else if(trigger.player.hp>1&&player.countCards('h')<3){
            nono=true;
        }
        else if(trigger.player.canUse('sha',player)&&!player.countCards('h','shan')&&trigger.player.countCards('h')>=3){
            nono=true;
        }
        var next=player.chooseToDiscard(get.prompt('zhendu',trigger.player));
        next.set('ai',function(card){
            if(_status.event.nono) return -1;
            return 7-get.useful(card);
        });
        next.set('logSkill',['zhendu',trigger.player]);
        next.set('nono',nono);
        "step 1"
        if(result.bool){
            trigger.player.damage();
        }
        else{
            event.finish();
        }
        "step 2"
        trigger.player.useCard({name:'jiu'},trigger.player);
    },
                ai:{
                    threaten:2,
                    expose:0.3,
                },
            },
            "qiluan1":{
                trigger:{
                    source:"dieAfter",
                },
                priority:-10,
                silent:true,
                locked:false,
                onremove:function (player){
        delete player.storage.qiluan;
    },
                filter:function (event){
        return _status.currentPhase!=event.player;
    },
                content:function (){
        if(!player.storage.qiluan){
            player.storage.qiluan=1;
        }
        else{
            player.storage.qiluan++;
        }
    },
                group:["qiluan2","qiluan3","qiluan4"],
                forced:true,
                popup:false,
            },
            "qiluan2":{
                audio:2,
                trigger:{
                    global:"phaseAfter",
                },
                frequent:true,
                filter:function (event,player){
                    return player.storage.qiluan?true:false;
                },
                content:function (){
                    if(get.mode()=='guozhan'){
                        player.draw(3);
                    }
                    else{
                        player.draw(3*player.storage.qiluan);
                    }
                    player.storage.qiluan=0;
                },
            },
            "qiluan3":{
                trigger:{
                    source:"dieAfter",
                },
                frequent:true,
                priority:-10,
                filter:function (event){
                    return _status.currentPhase==event.player;
                },
                content:function (){
                    var num=3;
                    if(player.storage.qiluan){
                        if(get.mode()!='guozhan'){
                            num+=3*player.storage.qiluan;
                        }
                        player.storage.qiluan=0;
                    }
                    player.draw(num);
                },
            },
            "qiluan4":{
                trigger:{
                    global:"phaseBegin",
                },
                silent:true,
                content:function (){
                    player.storage.qiluan=0;
                },
            },
            "zhensha1":{
                trigger:{
                    global:"dying",
                },
                priority:9,
                filter:function (event,player){
        return event.player.hp<=0&&(player.countCards('h','jiu')>0||player.countCards('h',{color:'black'})>=2)&&player!=event.player;
    },
                direct:true,
                content:function (){
        'step 0'
        var goon=(get.attitude(player,trigger.player)<0);
        var next=player.chooseToDiscard('鸠杀：是否弃置一张酒或两张黑色手牌令'+get.translation(trigger.player)+'立即死亡？');
        next.ai=function(card){
            if(ui.selected.cards.length){
                if(ui.selected.cards[0].name=='jiu') return 0;
            }
            if(goon){
                if(card.name=='jiu') return 2;
                return 1;
            }
            return 0;
        };
        next.filterCard=function(card){
            if(ui.selected.cards.length){
                return get.color(card)=='black';
            }
            return get.color(card)=='black'||card.name=='jiu';
        };
        next.complexCard=true,
        next.logSkill=['zhensha',trigger.player];
        next.selectCard=function(){
            if(ui.selected.cards.length){
                if(get.color(ui.selected.cards[0])!='black') return [1,1];
            }
            return [1,2];
        }
        'step 1'
        if(result.bool){
            trigger.player.die();
        }
        else{
            event.finish();
        }
        'step 2'
        if(!trigger.player.isAlive()){
            trigger.cancel(true);
        }
    },
                ai:{
                    threaten:1.5,
                },
            },
            "tuqiang1":{
                trigger:{
                    player:"respond",
                },
                filter:function (event,player){
        return event.card&&event.card.name=='shan';
    },
                frequent:true,
                content:function (){
        player.draw();
    },
                ai:{
                    mingzhi:false,
                    effect:{
                        target:function (card,player,target){
                if(get.tag(card,'respondShan')){
                    return 0.8;
                }
            },
                    },
                },
            },
            "fenghuo1":{
                enable:"chooseToUse",
                filter:function (event,player){
        return player.countCards('e')>0;
    },
                filterCard:true,
                position:"e",
                viewAs:{
                    name:"nanman",
                },
                prompt:"将一张装备区内的牌当南蛮入侵使用",
                check:function (card){
        var player=_status.currentPhase;
        if(player.countCards('he',{subtype:get.subtype(card)})>1){
            return 11-get.equipValue(card);
        }
        if(player.countCards('h')<player.hp){
            return 6-get.value(card);
        }
        return 2-get.equipValue(card);
    },
                ai:{
                    order:9,
                    threaten:1.1,
                    wuxie:function (target,card,player,viewer){
            if(get.attitude(viewer,target)>0&&target.countCards('h','sha')){
                if(!target.countCards('h')||target.hp==1||Math.random()<0.7) return 0;
            }
        },
                    basic:{
                        order:9,
                        useful:[5,1],
                        value:5,
                    },
                    result:{
                        target:function (player,target){
                if(player.hasUnknown(2)&&get.mode()!='guozhan') return 0;
                var nh=target.countCards('h');
                if(get.mode()=='identity'){
                    if(target.isZhu&&nh<=2&&target.hp<=1) return -100;
                }
                if(nh==0) return -2;
                if(nh==1) return -1.7
                return -1.5;
            },
                    },
                    tag:{
                        respond:1,
                        respondSha:1,
                        damage:1,
                        multitarget:1,
                        multineg:1,
                    },
                },
            },
            "zhuhai1":{
                trigger:{
                    global:"phaseEnd",
                },
                direct:true,
                filter:function (event,player){
        return event.player.isAlive()&&event.player.getStat('damage')&&
        lib.filter.targetEnabled({name:'sha'},player,event.player)&&player.hasSha();
    },
                content:function (){
        player.chooseToUse({name:'sha'},'诛害：是否对'+get.translation(trigger.player)+'使用一张杀？',
            trigger.player,-1).set('logSkill','zhuhai');
    },
            },
            "moukui1":{
                trigger:{
                    player:"shaBegin",
                },
                direct:true,
                audio:"ext:异界四国:2",
                content:function (){
        "step 0"
        var controls=['draw_card'];
        if(trigger.target.countCards('he')){
            controls.push('discard_card');
        }
        controls.push('cancel');
        player.chooseControl(controls).set('ai',function(){
            var trigger=_status.event.getTrigger();
            if(trigger.target.countCards('he')&&get.attitude(_status.event.player,trigger.target)<0){
                return 'discard_card';
            }
            else{
                return 'draw_card';
            }
        }).set('prompt',get.prompt('moukui'));
        "step 1"
        if(result.control=='draw_card'){
            player.draw();
            player.logSkill('moukui');
        }
        else if(result.control=='discard_card'&&trigger.target.countCards('he')){
            player.discardPlayerCard(trigger.target,'he',true).logSkill=['moukui',trigger.target];
        }
        else event.finish();
        "step 2"
        player.addTempSkill('moukui2','shaEnd');
    },
                ai:{
                    expose:0.1,
                },
            },
            "qiangwu1":{
                audio:"ext:异界四国:2",
                enable:"phaseUse",
                usable:1,
                content:function (){
        "step 0"
        player.judge();
        "step 1"
        player.storage.qiangwu=result.number;
    },
                ai:{
                    result:{
                        player:1,
                    },
                    order:11,
                },
                mod:{
                    targetInRange:function (card,player){
            if(_status.currentPhase==player&&card.name=='sha'&&card.number<player.storage.qiangwu) return true;
        },
                    cardUsable:function (card,player){
            if(_status.currentPhase==player&&card.name=='sha'&&card.number>player.storage.qiangwu) return Infinity;
        },
                },
                group:["qiangwu2","qiangwu3"],
            },
            "weikui1":{
                audio:"kuiwei",
                enable:"phaseUse",
                usable:1,
                filterTarget:function (card,player,target){
        return target!=player&&target.countCards('h');
    },
                content:function (){
        'step 0'
        player.loseHp();
        'step 1'
        if(target.countCards('h','shan')){
            player.viewHandcards(target);
            player.useCard({name:'sha'},target,false);
            player.storage.weikui2=target;
            player.addTempSkill('weikui2');
        }
        else{
            player.discardPlayerCard(target,'visible',true);
        }
    },
                ai:{
                    order:8,
                    result:{
                        target:function (player,target){
                if(player.hp<=2) return 0;
                if(player.hp==3) return target.hp<=2?-1:0;
                return -1;
            },
                    },
                },
            },
            "huoji1":{
                audio:"ext:异界四国:2",
                enable:"chooseToUse",
                filterCard:function (card){
        return get.color(card)=='red';
    },
                viewAs:{
                    name:"huogong",
                    nature:"fire",
                },
                viewAsFilter:function (player){
        if(!player.countCards('h',{color:'red'})) return false;
    },
                prompt:"将一张红色牌当火攻使用",
                check:function (card){
        var player=_status.currentPhase;
        if(player.countCards('h')>player.hp){
            return 6-get.value(card);
        }
        return 4-get.value(card)
    },
                ai:{
                    basic:{
                        order:4,
                        value:[3,1],
                        useful:1,
                    },
                    wuxie:function (target,card,player,current,state){
            if(get.attitude(current,player)>=0&&state>0) return false;
        },
                    result:{
                        player:function (player){
                var nh=player.countCards('h');
                if(nh<=player.hp&&nh<=4&&_status.event.name=='chooseToUse'){
                    if(typeof _status.event.filterCard=='function'&&
                        _status.event.filterCard({name:'huogong'})){
                        return -10;
                    }
                    if(_status.event.skill){
                        var viewAs=get.info(_status.event.skill).viewAs;
                        if(viewAs=='huogong') return -10;
                        if(viewAs&&viewAs.name=='huogong') return -10;
                    }
                }
                return 0;
            },
                        target:function (player,target){
                if(target.hasSkill('huogong2')||target.countCards('h')==0) return 0;
                if(player.countCards('h')<=1) return 0;
                if(target==player){
                    if(typeof _status.event.filterCard=='function'&&
                        _status.event.filterCard({name:'huogong'})){
                        return -1.5;
                    }
                    if(_status.event.skill){
                        var viewAs=get.info(_status.event.skill).viewAs;
                        if(viewAs=='huogong') return -1.5;
                        if(viewAs&&viewAs.name=='huogong') return -1.5;
                    }
                    return 0;
                }
                return -1.5;
            },
                    },
                    tag:{
                        damage:1,
                        fireDamage:1,
                        natureDamage:1,
                        norepeat:1,
                    },
                },
            },
            "kanpo1":{
                audio:"ext:异界四国:2",
                enable:"chooseToUse",
                filterCard:function (card){
        return get.color(card)=='black';
    },
                viewAsFilter:function (player){
        return player.countCards('h',{color:'black'})>0;
    },
                viewAs:{
                    name:"wuxie",
                },
                prompt:"将一张黑色手牌当无懈可击使用",
                check:function (card){return 8-get.value(card)},
                threaten:1.2,
                ai:{
                    basic:{
                        useful:[6,4],
                        value:[6,4],
                    },
                    result:{
                        player:1,
                    },
                    expose:0.2,
                },
            },
            "qianju1":{
                mod:{
                    globalFrom:function (from,to,distance){
            return distance-(from.maxHp-from.hp);
        },
                },
            },
            "quji1":{
                enable:"phaseUse",
                usable:1,
                position:"he",
                filterCard:true,
                selectCard:function (){
        var player=_status.event.player;
        var num=game.countPlayer(function(current){
            return current.isDamaged();
        });
        return [1,Math.min(num,player.maxHp-player.hp)];
    },
                filterTarget:function (card,player,target){
        return target.hp<target.maxHp;
    },
                filter:function (event,player){
        return player.hp<player.maxHp;
    },
                selectTarget:function (){
        return ui.selected.cards.length;
    },
                check:function (card){
        var player=_status.event.player;
        if(ui.selected.cards.length>=game.countPlayer(function(current){
            return get.attitude(player,current)>0&&current.isDamaged();
        })){
            return -1;
        }
        if(get.color(card)=='black') return -1;
        return 9-get.value(card);
    },
                content:function (){
        "step 0"
        target.recover();
        "step 1"
        if(target==player){
            for(var i=0;i<cards.length;i++){
                if(get.color(cards[i])=='black'){
                    player.loseHp();
                    break;
                }
            }
        }
    },
                ai:{
                    result:{
                        target:1,
                    },
                    order:6,
                },
            },
            "ranshang1":{
                audio:"ext:异界四国:2",
                trigger:{
                    player:"damageEnd",
                },
                filter:function (event,player){
        return event.nature=='fire';
    },
                init:function (player){
        player.storage.ranshang=0;
    },
                forced:true,
                check:function (){
        return false;
    },
                content:function (){
        if(player.storage.ranshang){
            player.storage.ranshang++;
        }
        else{
            player.storage.ranshang=1;
        }
        player.markSkill('ranshang');
        game.addVideo('storage',player,['ranshang',player.storage.ranshang]);
    },
                intro:{
                    content:"mark",
                },
                ai:{
                    effect:{
                        target:function (card,player,target,current){
                if(card.name=='sha'){
                    if(card.nature=='fire'||player.hasSkill('zhuque_skill')) return 2;
                }
                if(get.tag(card,'fireDamage')&&current<0) return 2;
            },
                    },
                },
                group:"ranshang2",
            },
            "xueji1":{
                audio:"ext:异界四国:2",
                enable:"phaseUse",
                usable:1,
                filter:function (event,player){
        return player.countCards('he',{color:'red'})>0;
    },
                filterTarget:true,
                selectTarget:function (){
        var player=_status.event.player
        return [1,Math.max(1,player.maxHp-player.hp)];
    },
                position:"he",
                filterCard:{
                    color:"red",
                },
                check:function (card){
        return 8-get.value(card);
    },
                multitarget:true,
                multiline:true,
                line:"fire",
                content:function (){
        'step 0'
        event.delay=false;
        for(var i=0;i<targets.length;i++){
            if(!targets[i].isLinked()){
                targets[i].link(true);
                event.delay=true;
            }
        }
        'step 1'
        if(event.delay){
            game.delay();
        }
        'step 2'
        targets[0].damage('fire');
    },
                ai:{
                    damage:true,
                    threaten:1.5,
                    order:7,
                    result:{
                        target:function (player,target){
                var eff=get.damageEffect(target,player,target,'fire');
                if(target.isLinked()){
                    return eff/10;
                }
                else{
                    return eff;
                }
            },
                    },
                },
            },
            "yingjian1":{
                trigger:{
                    player:"phaseBegin",
                },
                direct:true,
                content:function (){
        "step 0"
        player.chooseTarget(get.prompt('yingjian'),function(card,player,target){
            return lib.filter.targetEnabled({name:'sha'},player,target);
        }).set('ai',function(target){
            return get.effect(target,{name:'sha'},_status.event.player);
        });
        "step 1"
        if(result.bool){
            player.logSkill('yingjian');
            player.useCard({name:'sha'},result.targets,false);
        }
    },
                ai:{
                    threaten:function (player,target){
            return 1.6;
        },
                },
            },
            "guzheng1":{
                audio:"ext:异界四国:2",
                trigger:{
                    global:"discardAfter",
                },
                filter:function (event,player){
        if(event.player!=player&&event.player.isIn()&&
        event.cards&&event.cards.length&&event.getParent(2).name=='phaseDiscard'){
            for(var i=0;i<event.cards.length;i++){
                if(get.position(event.cards[i])=='d'){
                    return true;
                }
            }
            return false;
        }
    },
                checkx:function (event,player){
        var du=false;
        var num=0;
        for(var i=0;i<event.cards.length;i++){
            if(get.position(event.cards[i])=='d'){
                num++;
                if(event.cards[i].name=='du'){
                    du=true;
                }
            }
        }
        if(get.attitude(player,event.player)>0){
            if(du&&num<=3){
                return false;
            }
            return true;
        }
        if(du) return true;
        return num>2;
    },
                direct:true,
                content:function (){
        "step 0"
        event.cards=trigger.cards.slice(0);
        for(var i=0;i<event.cards.length;i++){
            if(get.position(event.cards[i])!='d'){
                event.cards.splice(i,1);i--;
            }
        }
        if(event.cards.length==0){
            event.finish();
            return;
        }
        var check=lib.skill.guzheng.checkx(trigger,player);
        player.chooseCardButton(event.cards,'固政：选择令'+get.translation(trigger.player)+'收回的牌').set('ai',function(button){
            if(_status.event.check){
                return 20-get.value(button.link);
            }
            return 0;
        }).set('check',check);
        "step 1"
        if(result.bool){
            game.delay(0.5);
            player.logSkill('guzheng',trigger.player);
            trigger.player.gain(result.links[0]);
            trigger.player.$gain2(result.links[0]);
            game.log(trigger.player,'收回了',result.links[0]);
            event.cards.remove(result.links[0]);
            if(event.cards.length){
                player.gain(event.cards);
                player.$gain2(event.cards);
                game.log(player,'收回了',event.cards);
            }
            game.delay();
        }
    },
                ai:{
                    threaten:1.3,
                    expose:0.2,
                },
            },
            "guose1":{
                audio:"ext:异界四国:1",
                filter:function (event,player){
        return player.countCards('he',{color:'red'})>0;
    },
                enable:"chooseToUse",
                filterCard:function (card){
        return get.color(card)=='red';
    },
                position:"he",
                viewAs:{
                    name:"lebu",
                },
                prompt:"将一张红色牌当乐不思蜀使用",
                check:function (card){return 6-get.value(card)},
                ai:{
                    threaten:1.5,
                    basic:{
                        order:1,
                        useful:1,
                        value:8,
                    },
                    result:{
                        target:function (player,target){
                var num=target.hp-target.countCards('h')-2;
                if(num>-1) return -0.01;
                if(target.hp<3) num--;
                if(target.isTurnedOver()) num/=2;
                var dist=get.distance(player,target,'absolute');
                if(dist<1) dist=1;
                return num/Math.sqrt(dist);
            },
                    },
                    tag:{
                        skip:"phaseUse",
                    },
                },
            },
            "zishu1":{
                subSkill:{
                    discard:{
                        trigger:{
                            player:"gainAfter",
                        },
                        silent:true,
                        filter:function (event,player){
                return _status.currentPhase!=player;
            },
                        content:function (){
                if(!player.storage.zishu){
                    player.storage.zishu=[];
                }
                player.storage.zishu.addArray(trigger.cards);
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                    "discard2":{
                        trigger:{
                            global:"phaseAfter",
                        },
                        forced:true,
                        filter:function (event,player){
                if(_status.currentPhase!=player&&player.storage.zishu){
                    var he=player.getCards('he');
                    for(var i=0;i<player.storage.zishu.length;i++){
                        if(he.contains(player.storage.zishu[i])){
                            return true;
                        }
                    }
                    return false;
                }
            },
                        content:function (){
                var he=player.getCards('he');
                var list=[];
                for(var i=0;i<player.storage.zishu.length;i++){
                    if(he.contains(player.storage.zishu[i])){
                        list.push(player.storage.zishu[i])
                    }
                }
                player.$throw(list);
                player.lose(list,ui.discardPile);
                game.log(player,'将',list,'置入弃牌堆');
            },
                        sub:true,
                    },
                    "discard3":{
                        trigger:{
                            global:"phaseBegin",
                        },
                        silent:true,
                        content:function (){
                delete player.storage.zishu;
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                    draw:{
                        trigger:{
                            player:"gainAfter",
                        },
                        forced:true,
                        filter:function (event,player){
                if(_status.currentPhase!=player) return false;
                return event.getParent(2).name!='zishu_draw';
            },
                        content:function (){
                player.draw();
            },
                        sub:true,
                    },
                },
                ai:{
                    threaten:1.2,
                    nogain:1,
                },
                group:["zishu_draw","zishu_discard","zishu_discard2","zishu_discard3"],
            },
            "luanji1":{
                audio:"luanji",
                enable:"phaseUse",
                viewAs:{
                    name:"wanjian",
                    cards:[{"node":{"image":{},"info":{},"name":{},"name2":{},"background":{},"intro":{},"range":{}},"storage":{},"vanishtag":[],"_uncheck":[],"suit":"heart","number":5,"name":"qilin","cardid":"379236025","clone":{"name":"qilin","suit":"heart","number":5,"node":{"name":{},"info":{},"intro":{},"background":{},"image":{}},"_onEndDelete":true,"_transitionEnded":true,"timeout":323},"timeout":250,"original":"h"},{"node":{"image":{},"info":{},"name":{},"name2":{},"background":{},"intro":{},"range":{}},"storage":{},"vanishtag":[],"_uncheck":[],"suit":"heart","number":7,"name":"sha","nature":"fire","cardid":"219905823","clone":{"name":"sha","suit":"heart","number":7,"node":{"name":{},"info":{},"intro":{},"background":{},"image":{}},"_onEndDelete":true,"_transitionEnded":true,"timeout":324},"timeout":251,"original":"h"}],
                },
                filterCard:function (card,player){
        if(!player.storage.reluanji) return true;
        return !player.storage.reluanji.contains(get.suit(card));
    },
                selectCard:2,
                check:function (card){
        var player=_status.event.player;
        var targets=game.filterPlayer(function(current){
            return player.canUse('wanjian',current);
        });
        var num=0;
        for(var i=0;i<targets.length;i++){
            var eff=get.sgn(get.effect(targets[i],{name:'wanjian'},player,player));
            if(targets[i].hp==1){
                eff*=1.5;
            }
            num+=eff;
        }
        if(!player.needsToDiscard(-1)){
            if(targets.length>=7){
                if(num<2) return 0;
            }
            else if(targets.length>=5){
                if(num<1.5) return 0;
            }
        }
        return 6-get.value(card);
    },
                ai:{
                    basic:{
                        order:10,
                        useful:1,
                        value:5,
                    },
                    wuxie:function (target,card,player,viewer){
            if(get.attitude(viewer,target)>0&&target.countCards('h','shan')){
                if(!target.countCards('h')||target.hp==1||Math.random()<0.7) return 0;
            }
        },
                    result:{
                        target:function (player,target){
                if(player.hasUnknown(2)&&get.mode()!='guozhan') return 0;
                var nh=target.countCards('h');
                if(get.mode()=='identity'){
                    if(target.isZhu&&nh<=2&&target.hp<=1) return -100;
                }
                if(nh==0) return -2;
                if(nh==1) return -1.7
                return -1.5;
            },
                    },
                    tag:{
                        respond:1,
                        respondShan:1,
                        damage:1,
                        multitarget:1,
                        multineg:1,
                    },
                },
                group:["reluanji_count","reluanji_reset","reluanji_respond"],
                subSkill:{
                    reset:{
                        trigger:{
                            player:"phaseAfter",
                        },
                        silent:true,
                        filter:function (event,player){
                return player.storage.reluanji?true:false;
            },
                        content:function (){
                delete player.storage.reluanji;
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                    count:{
                        trigger:{
                            player:"useCard",
                        },
                        silent:true,
                        filter:function (event){
                return event.skill=='reluanji';
            },
                        content:function (){
                if(!player.storage.reluanji){
                    player.storage.reluanji=[];
                }
                for(var i=0;i<trigger.cards.length;i++){
                    player.storage.reluanji.add(get.suit(trigger.cards[i]));
                }
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                    respond:{
                        trigger:{
                            global:"respond",
                        },
                        silent:true,
                        filter:function (event){
                return event.getParent(2).skill=='reluanji'&&event.player.isDamaged();
            },
                        content:function (){
                trigger.player.draw();
            },
                        sub:true,
                        forced:true,
                        popup:false,
                    },
                },
            },
            "weimu1":{
                mod:{
                    targetEnabled:function (card){
            if((get.type(card)=='trick'||get.type(card)=='delay')&&
                get.color(card)=='black') return false;
        },
                },
            },
            "yizhong1":{
                trigger:{
                    target:"shaBefore",
                },
                forced:true,
                audio:"ext:异界四国:2",
                filter:function (event,player){
                    if(player.getEquip(2)) return false;
                    return (event.card.name=='sha'&&get.color(event.card)=='black')
                },
                content:function (){
                    trigger.cancel();
                },
                ai:{
                    effect:{
                        target:function (card,player,target){
                            if(player==target&&get.subtype(card)=='equip2'){
                                if(get.equipValue(card)<=8) return 0;
                            }
                            if(target.getEquip(2)) return;
                            if(card.name=='sha'&&get.color(card)=='black') return 'zerotarget';
                        },
                    },
                },
            },
            "shenfen1":{
                audio:"ext:异界四国:2",
                enable:"phaseUse",
                filter:function (event,player){
        return player.storage.baonu>=6;
    },
                skillAnimation:true,
                animationColor:"metal",
                content:function (){
        "step 0"
        player.storage.baonu-=6;
        player.syncStorage('baonu');
        player.updateMarks('baonu');
        event.targets=game.filterPlayer();
        event.targets.remove(player);
        event.targets.sort(lib.sort.seat);
        event.targets2=event.targets.slice(0);
        player.line(event.targets,'green');
        "step 1"
        if(event.targets.length){
            event.targets.shift().damage();
            event.redo();
        }
        "step 2"
        if(event.targets2.length){
            var cur=event.targets2.shift();
            if(cur&&cur.countCards('he')){
                cur.chooseToDiscard('he',true,4);
            }
            event.redo();
        }
    },
                ai:{
                    combo:"baonu",
                    order:10,
                    result:{
                        player:function (player){
                return game.countPlayer(function(current){
                    if(current!=player){
                        return get.sgn(get.damageEffect(current,player,player));
                    }
                });
            },
                    },
                },
            },
            kuangbao:{
                audio:"ext:异界四国:2",
                mark:true,
                init:function (player){
        player.storage.baonu=2;
        player.markSkill('baonu');
        player.syncStorage('baonu');
    },
                trigger:{
                    source:"damageEnd",
                    player:"damageEnd",
                },
                forced:true,
                filter:function (event){
        return event.num>0; 
    },
                content:function (){
        player.storage.baonu+=trigger.num;
        player.markSkill('baonu');
        player.syncStorage('baonu');
    },
                intro:{
                    content:"mark",
                },
                ai:{
                    combo:"shenfen",
                    maixie:true,
                    "maixie_hp":true,
                },
            },
        },
        "shensu1":{
            audio:2,
            trigger:{
                player:"phaseBegin",
            },
            direct:true,
            content:function (){
                "step 0"
                var check= player.countCards('h')>2;
                player.chooseTarget(get.prompt('shensu'),function(card,player,target){
                    if(player==target) return false;
                    return player.canUse({name:'sha'},target,false);
                }).set('check',check).set('ai',function(target){
                    if(!_status.event.check) return 0;
                    return get.effect(target,{name:'sha'},_status.event.player);
                });
                "step 1"
                if(result.bool){
                    player.logSkill('shensu1',result.targets);
                    player.useCard({name:'sha'},result.targets[0],false);
                    player.skip('phaseJudge');
                    player.skip('phaseDraw');
                }
            },
        },
        "shensu2":{
            audio:2,
            trigger:{
                player:"phaseUseBefore",
            },
            direct:true,
            filter:function (event,player){
                return player.countCards('he',{type:'equip'})>0;
            },
            content:function (){
                "step 0"
                var check=player.needsToDiscard();
                player.chooseCardTarget({
                    prompt:get.prompt('shensu'),
                    filterCard:function(card,player){
                        return get.type(card)=='equip'&&lib.filter.cardDiscardable(card,player)
                    },
                    position:'he',
                    filterTarget:function(card,player,target){
                        if(player==target) return false;
                        return player.canUse({name:'sha'},target,false);
                    },
                    ai1:function(card){
                        if(_status.event.check) return 0;
                        return 6-get.value(card);
                    },
                    ai2:function(target){
                        if(_status.event.check) return 0;
                        return get.effect(target,{name:'sha'},_status.event.player);
                    },
                    check:check
                });
                "step 1"
                if(result.bool){
                    player.logSkill('shensu2',result.targets);
                    player.discard(result.cards[0]);
                    player.useCard({name:'sha'},result.targets[0]);
                    trigger.cancel();
                }
            },
        },
        "shensu4":{
            audio:"shensu1",
            trigger:{
                player:"phaseDiscardBefore",
            },
            direct:true,
            content:function (){
                "step 0"
                var check=player.needsToDiscard()||player.isTurnedOver();
                player.chooseTarget(get.prompt('shensu'),function(card,player,target){
                    if(player==target) return false;
                    return player.canUse({name:'sha'},target,false);
                }).set('check',check).set('ai',function(target){
                    if(!_status.event.check) return 0;
                    return get.effect(target,{name:'sha'},_status.event.player);
                });
                "step 1"
                if(result.bool){
                    player.logSkill('shensu4',result.targets);
                    player.turnOver();
                    player.useCard({name:'sha'},result.targets[0],false);
                    trigger.cancel();
                }
            },
        },
        "zhenwei2":{
            mark:true,
            intro:{
                content:"cards",
            },
            trigger:{
                global:"phaseAfter",
            },
            forced:true,
            content:function (){
                player.gain(player.storage.zhenwei2,'gain2');
                delete player.storage.zhenwei2;
                player.removeSkill('zhenwei2');
            },
        },
        qiaobian:{
            audio:2,
            group:["qiaobian1","qiaobian2","qiaobian3","qiaobian4"],
            ai:{
                threaten:3,
            },
        },
        "qiaobian1":{
            audio:2,
            trigger:{
                player:"phaseJudgeBefore",
            },
            filter:function (event,player){
                return player.countCards('h')>0;
            },
            direct:true,
            frequent:true,
            content:function (){
                "step 0"
                if(player.countCards('j')==0&&(!event.isMine()||!lib.config.autoskilllist.contains('qiaobian1'))){
                    event.finish();
                }
                else{
                    var next=player.chooseToDiscard(get.prompt('qiaobian'),'弃置一张手牌并跳过判定阶段');
                    next.set('ai',get.unuseful2);
                    next.set('logSkill','qiaobian1');
                }
                "step 1"
                if(result.bool){
                    trigger.cancel();
                }
            },
        },
        "qiaobian2":{
            audio:2,
            trigger:{
                player:"phaseDrawBefore",
            },
            filter:function (event,player){
                return player.countCards('h')>0;
            },
            direct:true,
            content:function (){
                "step 0"
                var check,i,num=0,num2=0,players=game.filterPlayer();
                for(i=0;i<players.length;i++){
                    if(player!=players[i]&&players[i].countCards('h')){
                        var att=get.attitude(player,players[i]);
                        if(att<=0){
                            num++;
                        }
                        if(att<0){
                            num2++;
                        }
                    }
                }
                check=(num>=2&&num2>0);

                player.chooseToDiscard(get.prompt('gaiqiaobian'),'弃置一张手牌并跳过摸牌阶段，然后可以获得至多两名角色各一张手牌',lib.filter.cardDiscardable).set('ai',function(card){
                    if(!_status.event.check) return 0;
                    return 7-get.value(card);
                }).set('check',check).set('logSkill','qiaobian2');
                "step 1"
                if(result.bool){
                    trigger.cancel();
                    player.chooseTarget([1,2],'获得至多两名角色各一张手牌',function(card,player,target){
                        return target!=player&&target.countCards('h');
                    }).set('ai',function(target){
                        return 1-get.attitude(_status.event.player,target);
                    })
                }
                else{
                    event.finish();
                }
                "step 2"
                if(result.bool){
                    player.line(result.targets,'green');
                    event.targets=result.targets;
                    if(!event.targets.length) event.finish();
                }
                else{
                    event.finish();
                }
                "step 3"
                player.gainMultiple(event.targets);
                "step 4"
                game.delay();
            },
            ai:{
                expose:0.2,
            },
        },
        "qiaobian3":{
            audio:2,
            trigger:{
                player:"phaseUseBefore",
            },
            filter:function (event,player){
                return player.countCards('h')>0;
            },
            direct:true,
            content:function (){
                "step 0"
                var check;
                if(!player.canMoveCard(true)){
                    check=false;
                }
                else{
                    check=game.hasPlayer(function(current){
                        return get.attitude(player,current)>0&&current.countCards('j');
                    });
                    if(!check){
                        if(player.countCards('h')>player.hp+1){
                            check=false;
                        }
                        else if(player.countCards('h',{name:['wuzhong']})){
                            check=false;
                        }
                        else{
                            check=true;
                        }
                    }
                }
                player.chooseToDiscard(get.prompt('qiaobian'),'弃置一张手牌并跳过出牌阶段，然后可以移动场上的一张牌',lib.filter.cardDiscardable).set('ai',function(card){
                    if(!_status.event.check) return 0;
                    return 7-get.value(card);
                }).set('check',check).set('logSkill','qiaobian3');
                "step 1"
                if(result.bool){
                    trigger.cancel();
                    player.moveCard();
                }
                else{
                    event.finish();
                }
            },
            ai:{
                expose:0.2,
            },
        },
        "qiaobian4":{
            audio:2,
            trigger:{
                player:"phaseDiscardBefore",
            },
            direct:true,
            filter:function (event,player){
                return player.countCards('h')>0;
            },
            content:function (){
                "step 0"
                var discard=player.countCards('h')>player.hp;
                var next=player.chooseToDiscard(get.prompt('qiaobian4'),'弃置一张手牌并跳过弃牌阶段');
                next.logSkill='qiaobian';
                next.ai=function(card){
                    if(discard){
                        return 100-get.useful(card);
                    }
                    else{
                        return -1;
                    }
                };
                "step 1"
                if(result.bool){
                    trigger.cancel();
                }
            },
        },
        translate:{
            zhaxiang:"诈降",
            "zhaxiang_info":"锁定技 每当你失去1点体力后，你摸三张牌。然后若此时是你的出牌阶段，则直到回合结束，你使用红色【杀】无距离限制且不能被【闪】响应，你可以额外使用一张【杀】。",
            qiangxi:"强袭",
            "qiangxi_info":"出牌阶段各限一次，你可以选择一项：1. 失去一点体力并对你攻击范围内的一名其他角色造成一点伤害；2. 弃置一张装备牌并对你攻击范围内的一名其他角色造成一点伤害 ",
            lianying:"连营",
            "lianying_info":"当你失去最后的手牌时，你可以令至多X名角色各摸一张牌（X为你此次失去的手牌数）。",
            qianxun:"谦逊",
            "qianxun_info":"每当一张延时类锦囊牌或其他角色使用的普通锦囊牌生效时，若你是此牌的唯一目标，你可以将所有手牌置于你的武将牌上，若如此做，此回合结束时，你获得你武将牌上的所有牌。",
            qingnang:"青囊",
            "qingnang_info":"出牌阶段，你可以弃置一张手牌令一名角色回复一点体力，每阶段限一次",
            jijiu:"急救",
            "jijiu_info":"回合外，你可以将一张红色牌当[桃]使用",
            kurou:"苦肉",
            "kurou_info":"出牌阶段，你可以流失一点体力并摸两张牌",
            longyin:"龙吟",
            "longyin_info":"每当一名角色在其出牌阶段使用【杀】时，你可弃置一张牌令此【杀】不计入出牌阶段使用次数，若此【杀】为红色，你摸一张牌",
            mashu:"马术",
            "mashu_info":"锁定技，你的进攻距离+1",
            retieqi:"铁骑",
            "retieqi_info":"当你使用一张[杀]时，可进行一次判定，若为红色则此[杀]不可闪避",
            yijieanguo:"安国",
            "yijieanguo_info":"出牌阶段限一次，你可以选择一名其他角色，若其手牌数为全场最少，其摸一张牌；体力值为全场最低，回复1点体力；装备区内牌数为全场最少，随机使用一张装备牌。然后若该角色有未执行的效果且你满足条件，你执行之。",
            fenxun:"奋迅",
            "fenxun_info":"出牌阶段限一次，你可以弃置一张牌并选择一名其他角色，然后本回合你计算与其的距离视为1",
            duanbing:"短兵",
            "duanbing_info":"你使用【杀】可以多选择一名距离为1的角色为目标",
            "kuanggu1":"狂骨",
            "kuanggu1_info":"当你对距离1以内的一名角色造成1点伤害后，你可以回复1点体力或摸一张牌",
            wusheng:"武圣",
            "wusheng_info":"你可以将一张红色牌当[杀]使用",
            qimou:"奇谋",
            "qimou_info":"限定技，出牌阶段，你可以失去任意点体力，然后直到回合结束，你的进攻距离+X，且你可以多使用X张【杀】（X为你失去的体力值）",
            xianzhen:"陷阵",
            "xianzhen_info":"出牌阶段，你可以与一名角色拼点。若你赢，你获得以下技能直到回合结束：无视与该角色的距离；无视防具且可使用任意数量的【杀】。若你没赢，你不能使用【杀】直到回合结束。每回合限一次",
            jinjiu:"禁酒",
            "jinjiu_info":"锁定技，你的【酒】均视为【杀】",
            tianbian:"天辩",
            "tianbian_info":"你拼点时，可以改为用牌堆顶的一张牌进行拼点；当你拼点的牌亮出后，若此牌花色为红桃，则点数视为K",
            yiji:"遗计",
            "yiji_info":"每当你受到一点伤害，可以观看牌堆顶的两张牌，并将其交给任意1~2名角色",
            longdan:"龙胆",
            "longdan_info":"你可以将[杀]当[闪]，或[闪]当[杀]使用或打出",
            chongzhen:"冲阵",
            "chongzhen_info":"每当你发动“龙胆”使用或打出一张手牌时，你可以立即获得对方的一张手牌。",
            paoxiao:"咆哮",
            "paoxiao_info":"出牌阶段，你使用[杀]无数量限制",
            lihun:"离魂",
            "lihun_info":"出牌阶段，你可以弃置一张牌并将你的武将牌翻面，若如此做，你指定一名男性角色，获得其所有手牌。出牌阶段结束时，你需为该角色每一点体力分配给其一张牌。每回合限一次。",
            kongcheng:"空城",
            "kongcheng_info":"锁定技，当你没有手牌时，不能成为[杀]或[决斗]的目标",
            jishe:"极奢",
            "jishe2":"极奢",
            "jishe3":"极奢",
            "jishe_info":"出牌阶段，若你的手牌上限大于0，你可以摸一张牌，然后你本回合的手牌上限-1。结束阶段开始时，若你没有手牌，则你可以横置至多X名角色的武将牌（X为你的体力值）",
            luoyi:"裸衣",
            "luoyi_info":"你可以跳过摸牌阶段，然后展示牌堆顶的三张牌，获得其中的基本牌、武器牌和【决斗】，若如此做，直到你的下回合开始，你为伤害来源的【杀】或【决斗】造成的伤害+1。",
            biyue:"闭月",
            "biyue_info":"结束阶段，你可以摸一张牌",
            yongsi:"庸肆",
            "yongsi_info":"锁定技，摸牌阶段，你令额定摸牌数为X(X为势力数);弃牌阶段开始时，你选择一项：1.弃置一张牌;2.失去1点体力",
            shangshi:"伤势",
            "shangshi_info":"锁定技，当你的手牌数小于X时，你立即将手牌补至X张（X为你已损失的体力值且最多为3）",
            zaiqi:"再起",
            "zaiqi_info":"摸牌阶段，若你已受伤，你可以改为展示牌堆顶的X张牌，X为你已损失的体力值，其中每有一张♥牌，你回复1点体力，然后弃掉这些♥牌，将其余的牌收入手牌。",
            benghuai:"崩坏",
            "benghuai_info":"结束阶段，若你的体力不是全场最少的(或之一)，你须减1点体力或体力上限。",
            roulin:"肉林",
            "rolin_info":"你对女性角色、女性角色对你使用【杀】时，都需连续使用两张【闪】才能抵消。",
            qice:"奇策",
            "qice_info":"出牌阶段，你可以将所有的手牌（至少一张）当做任意一张通常性锦囊牌使用，每阶段限一次。",
            huituo:"恢拓",
            "huituo_info":"每当你受到伤害后，你可以令一名角色进行一次判定，若结果为红色，该角色回复1点体力；若结果为黑色，该角色摸X张牌（X为此次伤害的伤害数）",
            juxiang:"巨象",
            "juxiang_info":"南蛮入侵】对你无效；若其他角色使用的【南蛮入侵】在结算完时进入弃牌堆，你立即获得它。",
            lieren:"烈刃",
            "lieren_info":"你每使用【杀】造成一次伤害，可与受到该伤害的角色拼点；若你赢，你获得对方的一张牌。",
            qixi:"奇袭",
            "qixi_info":"你可以将一张黑色牌当[过河拆桥]使用",
            luoshen:"洛神",
            "luoshen_info":"准备阶段，你可以进行一定判定，若为黑色则可以继续判定，直到出现红色。然后你获得所有黑色的判定牌",
            guicai:"鬼才",
            "guicai_info":"在任意角色的判定牌生效前，你可以打出一张手牌代替之",
            shibei:"矢北",
            "shibei_info":"锁定技，当你受到伤害后：若此伤害是你本回合第一次受到伤害，则你回复1点体力；若不是你本回合第一次受到伤害，则你失去1点体力。",
            qingxian:"清弦",
            "qingxian_info":"当你受到伤害/回复体力后，你可以令伤害来源/一名其他角色执行一项：失去1点体力，随机使用一张装备牌；回复1点体力，弃置一张装备牌。若其以此法使用或弃置的牌为梅花，你回复1点体力",
            jiushi:"酒诗",
            "jiushi_info":"若你的武将牌正面朝上，你可以(在合理的时机)将你的武将牌翻面来视为使用一张【酒】;当你的武将牌背面朝上时你受到伤害，你可在伤害结算后将之翻回正面。",
            jianxiong:"奸雄",
            "jianxiong_info":"你可以立即获得对你造成伤害的牌",
            ganglie:"刚烈",
            "ganglie_info":"每当你受到一次伤害，可进行一次判定，若结果不为红桃，则伤害来源须弃置两张手牌或受到来自你的一点伤害",
            releiji:"雷击",
            "releiji_info":"每当你使用或打出一张【闪】，可令任意一名角色进行一次判定，若结果为梅花，其受到一点雷电伤害，然后你回复一点体力；若结果为黑桃，其受到两点雷电伤害",
            guidao:"鬼道",
            "guidao_info":"任意一名角色的判定生效前，你可以打出一张黑色牌替换之",
            weijing:"卫境",
            "wejing_info":"每轮限一次，你可以在需要使用【杀】或【闪】时，视为使用一张【杀】或【闪】。",
            jiang:"激昂",
            "jiang_info":"每当你使用（指定目标后）或被使用（成为目标后）一张【决斗】或红色的【杀】时，你可以摸一张牌。",
            yingzi:"英姿",
            "yingzi_info":"摸牌阶段，你可以额外摸一张牌",
            tianyi:"天义",
            "tianyi_info":"出牌阶段，你可以和一名角色拼点，若你赢，你获得以下技能直到回合结束：攻击范围无限；可额外使用一张【杀】；使用【杀】时可额外指定一个目标，若你没赢，你不能使用【杀】直到回合结束。每回合限一次。",
            yinghun:"英魂",
            "yinghun_info":"准备阶段开始时，若你已受伤，你可令一名其他角色执行一项：摸X张牌，然后弃置一张牌；或摸一张牌，然后弃置X张牌（X为你已损失的体力值，若你装备区里牌的数量不小于你的体力值，则X改为你的体力上限）",
            xiaoji:"枭姬",
            "xiaoji_info":"每当你失去一张装备牌，可以摸两张牌",
            baobian:"豹变",
            "baobian_info":"锁定技，若你的体力值为3或更少，你视为拥有技能“挑衅”；若你的体力值为2或更少；你视为拥有技能“咆哮”；若你的体力值为1，你视为拥有技能“神速”。",
            kaikang:"慷忾",
            "kaikang_info":"每当你距离1以内的角色成为杀的目标后，你可以摸一张牌。若如此做，你交给其一张牌并展示之，若该牌为装备牌，该角色可以使用此牌。",
            tiandu:"天妒",
            "tiandu_info":"你可以立即获得你的判定牌",
            benxi:"奔袭",
            "benxi_info":"锁定技，在你的回合内，你每使用一次牌后，你的进攻距离+1，直到回合结束；你的回合内，若你与所有角色的距离均为1，你无视其他角色的防具，且你使用的【杀】可额外指定一个目标",
            fuqi:"伏骑",
            "fuqi_info":"锁定技，与你距离为1的其他角色不能使用或打出牌响应你使用的牌",
            jiaozi:"娇恣",
            "jiaozi_info":"锁定技，若你的手牌数是全场唯一最多的，你造成或受到的伤害均+1",
            wushuang:"无双",
            "wushuang_info":"锁定技，你使用的【杀】或【决斗】需要两张【闪】或【杀】响应",
            keji:"克己",
            "keji_info":"若你在出牌阶段没有使用[杀]，则可跳过弃牌阶段",
            yaowu:"耀武",
            "yaowu_info":"锁定技，当任意一名角色使用红色【杀】对你造成伤害时，该角色回复1点体力或摸一张牌。",
            zhenlie:"贞烈",
            "zhenlie_info":"每当你成为其他角色的卡牌的目标时，你可以流失一点体力取消之，然后弃置对方一张牌",
            zhanjue:"战绝",
            "zhanjue_info":"出牌阶段，你可以将所有手牌当【决斗】使用，结算后你和以此法受到伤害的角色各摸一张牌。若你在同一阶段内以此法摸了两张或更多的牌，则此技能失效直到回合结束",
            zhiyu:"智愚",
            "zhiyu_info":"每当你受到一次伤害后，你可以摸一张牌，然后展示所有手牌，若颜色均相同，伤害来源弃置一张手牌。",
            xiangle:"享乐",
            "xiangle_info":"锁定技，当其他玩家使用【杀】指定你为目标时，需额外弃掉一张基本牌，否则该【杀】对你无效。",
            tianming:"天命",
            "tianming_info":"当你成为【杀】的目标时，你可以弃置两张牌(不足则全弃，无牌则不弃)，然后摸两张牌;若此时全场体力值最多的角色仅有一名(且不是你)，该角色也可以如此做。",
            duwu:"黩武",
            "duwu_info":"出牌阶段，你可以弃置X张牌对你攻击范围内的一名其他角色造成1点伤害(X为该角色的体力值)。若你以此法令该角色进入濒死状态，则濒死状态结算后你失去1点体力，且本回合不能再发动黩武。",
            rende:"仁德",
            "rende_info":"出牌阶段，你可以将任意手牌送给其他角色，若送出的手牌不少于两张，你回复一点体力",
            xuanfeng:"旋风",
            "xuanfeng_info":"当你失去装备区里的牌时，或于弃牌阶段弃置了两张或更多的手牌后，你可以依次弃置一至两名其他角色的共计两张牌。",
            qiangshi:"强识",
            "qiangshi_info":"出牌阶段开始时，你可以展示一名其他角色的一张手牌。若如此做，每当你于此阶段内使用与此牌类别相同的牌时，你可以摸一张牌。",
            xiaoguo:"骁果",
            "xiaoguo_info":"其他角色的结束阶段开始时，你可以弃置一张基本牌，令该角色选择一项：1.弃置一张装备牌并令你摸一张牌；2.受到你对其造成的1点伤害。",
            liegong:"烈弓",
            "liegong_info":"你使用【杀】可以选择你距离不大于此【杀】点数的角色为目标；当你使用【杀】指定一个目标后，你可以根据下列条件执行相应的效果：1.其手牌数小于等于你的手牌数，此【杀】不可被【闪】响应 2.其体力值大于等于你的体力值，此【杀】伤害+1",
            zhanyi:"战意",
            "zhanyi_info":"出牌阶段限一次，你可以弃置一张牌并失去1点体力，然后根据你弃置的牌获得以下效果直到回合结束：基本牌，你可以将一张基本牌当作杀、酒或桃使用；锦囊牌，摸两张牌且你使用的牌无距离限制；装备牌，你使用【杀】指定目标角色后，其弃置两张牌",
            jili:"蒺藜",
            "jili_info":"当你于一回合内使用或打出第X张牌时，你可以摸X张牌（X为你的攻击范围）。",
            mingzhe:"明哲",
            "mingzhe_info":"你的回合外，每当你因使用、打出或弃置而失去一张红色牌时，你可以摸一张牌。",
            fulin:"腹鳞",
            "fulin_info":"锁定技，弃牌阶段内，你于此回合内获得的牌不计入你的手牌数",
            qiaoshuo:"巧说",
            "qiaoshuo_info":"出牌阶段开始时，你可与一名其他角色拼点。若你赢，你使用的下一张基本牌或普通锦囊牌可以额外指定任意一名其他角色为目标或减少指定一个目标；若你没赢，你不能使用锦囊牌直到回合结束",
            zongshi:"纵适",
            "zongshi_info":"每当你拼点赢，你可以获得对方此次拼点的牌；每当你拼点没赢，你可以收回你此次拼点的牌",
            shuomeng:"说盟",
            "shuomeng_info":"出牌阶段结束时，你可以与一名角色拼点，若你赢，视为你使用【无中生有】；若你没赢，视为其对你使用【过河拆桥】",
            huomo:"活墨",
            "huomo_info":"每当你需要使用一张本回合内未使用过的基本牌时，你可以将一张黑色非基本牌置于牌堆顶，然后视为你使用了此基本牌",
            zuoding:"佐定",
            "zuoding_info":"每当一名其他角色于其回合内使用♠牌指定目标后，若本回合没有角色受到过伤害，则你可以令其中一名目标角色摸一张牌",
            pizhuan:"辟撰",
            "pizhuan_info":"当你使用黑桃牌后，或你成为其他角色使用黑桃牌的目标后，你可以将牌堆顶的一张牌置于武将牌上，称为“书”；你至多拥有四张“书”，你每有一张“书” ，手牌上限+1",
            tongbo:"通博",
            "tongbo_info":"摸牌阶段摸牌后，你可以用任意张牌替换等量的“书”，然后若你的“书”包含四种花色，你将所有“书”交给任意名其他角色",
            lirang:"礼让",
            "lirang_info":"当你的牌因弃置而置入弃牌堆时，你可以将其中的任意张牌交给其他角色",
            mingshi:"名士",
            "mingshi_info":"当你即将受到伤害时，若伤害来源的体力值大于你，你可以弃置一张黑色手牌令伤害-1 ",
            lianzhu:"连诛",
            "lianzhu_info":"出牌阶段限一次，你可以展示并交给一名其他角色一张牌，若该牌为黑色，其选择一项：1.你摸两张牌；2.弃置两张牌",
            xiehui:"黠慧",
            "xiehui_info":"锁定技，你的黑色牌不占用手牌上限；其他角色获得你的黑色牌时，其不能使用、打出、弃置这些牌直到其体力值减少为止",
            junxing:"峻刑",
            "junxing_info":"出牌阶段限一次，你可以弃置至少一张手牌并选择一名其他角色，该角色需弃置一张与你弃置的牌类别均不同的手牌，否则其先将其武将牌翻面再摸X张牌（X为你以此法弃置的手牌数量）。",
            yuce:"御策 ",
            "yuce_info":"每当你受到一次伤害，可以弃置一张手牌，并令伤害来源选择一项：弃置一张相同类型的手牌并令你摸一张牌，或令你回复一点体力",
            polu:"破橹",
            "polu_info":"锁定技，回合开始时，若你的装备区里没有【霹雳车】，你使用之；当你受到1点伤害后，若你的装备区里没有【霹雳车】，你摸一张牌",
            xinzhiheng:"制衡",
            "xinzhiheng_info":"出牌阶段限1次，你可以弃置任意张牌并摸等量的牌，如果在发动制衡时弃置了所有手牌，你额外摸一张牌",
            shuangren:"双刃",
            "shuangren_info":"出牌阶段开始时，你可以与一名角色拼点。若你赢，你视为任意一名角色使用一张【杀】（此【杀】不计入限制的次数）；若你没赢，你结束出牌阶段",
            fulu:"符箓",
            "fulu_info":"你可以将【杀】当雷【杀】使用。",
            zhufu:"助祭",
            "zhufu_info":"当一名角色造成雷电伤害时，你可以令其进行一次判定，若结果为黑色，此伤害+1；若结果为红色，该角色获得此牌。",
            luanzhan:"乱战",
            "luanzhan_info":"你使用【杀】或黑色普通锦囊牌可以额外选择X名角色为目标；当你使用【杀】或黑色普通锦囊牌指定目标后，若此牌的目标角色数小于X，则X减至0（X为你于本局游戏内造成过伤害的次数）",
            sijian:"死谏",
            "sijian_info":"当你失去最后的手牌时，你可以弃置一名其他角色的一张牌",
            liangzhu:"良助",
            "liangzhu_info":"当一名角色于其出牌阶段内回复体力时，你可以选择一项：1、摸一张牌；2、令该角色摸两张牌 ",
            bagua:"八卦",
            "bagua_info":"当你没装备防具时，始终视为你装备着【八卦阵】",
            meibu:"魅步",
            "meibu_info":"一名其他角色的出牌阶段开始时，若你不在其攻击范围内，你可以令该角色的锦囊牌均视为【杀】，直到该角色以此法使用了一张【杀】或回合结束。若如此做，则直到回合结束，视为你在其攻击范围内",
            zhidao:"雉盗",
            "zhidao_info":"锁定技，当你于你的回合内第一次对区域里有牌的其他角色造成伤害后，你获得其手牌、装备区和判定区里的各一张牌，然后直到回合结束，其他角色不能被选择为你使用牌的目标",
            hezong:"合纵",
            "hezong_info":"锁定技，结束阶段，你可以横置至多两名角色",
            faen:"法恩",
            "faen_info":"当一名角色翻至正面或横置后，你可以令其摸一张牌",
            gailianhuan:"连环改",
            "gailianhuan1":"连环",
            "gailianhuan2":"连铸",
            "gailianhuan_info":"出牌阶段，你可以将你任意一张黑色手牌当【铁索连环】使用或重铸。",
            "gai_huansha":"环杀",
            "gai_huansha_info":"横置你的武将牌，视为打出一张火杀",
            "gai_huanshan":"环闪",
            "gai_huanshan_info":"重置你的武将牌，视为打出一张闪",
            fuhun:"父魂",
            "fuhun2":"父魂2",
            "fuhun3":"父魂3",
            "fuhun_info":"你可以将两张手牌当杀使用或打出；出牌阶段，若你以此法使用的杀造成了伤害，你获得技能“武圣”、“咆哮”直到回合结束。",
            "fengqi1":"风起",
            "fengqi1_info":"准备阶段和结束阶段，你可以视为使用任意一张普通锦囊牌",
            "huoshen1":"火神",
            "huoshen1_info":"锁定技，你防止即将受到的火焰伤害，改为回复1点体力",
            shenyi:"神裔",
            "shenyi_info":"锁定技，你的武将牌始终正面向上，你的判定区内的牌效果反转",
            "gailianhuan1_info":"undefined",
            "gongao1":"功獒",
            "gongao1_info":"锁定技，每当一名角色死亡后，你增加一点体力上限，回复一点体力。",
            "chengxiang1":"称象",
            "chengxiang1_info":"每当你受到一次伤害后，你可以亮出牌堆顶的四张牌。然后获得其中任意数量点数之和不大于13的牌",
            "wangxi1":"忘隙",
            "wangxi1_info":"每当你对其他角色造成1点伤害后，或受到其他角色造成的1点伤害后，你可与该角色各摸一张牌。",
            "jushou1":"据守",
            "jushou1_info":"结束阶段，你可以翻面并摸四张牌，然后弃置一张手牌，若以此法弃置的是装备牌，则你改为使用之",
            "xinjiewei1":"解围",
            "xinjiewei1_info":"你可以将装备区里的牌当【无懈可击】使用；当你从背面翻至正面时，你可以弃置一张牌，然后移动场上的一张牌",
            xiefeng:"携锋",
            "xiefeng_info":"锁定技，出牌阶段开始时，若你装备区没有武器牌，你随机装备一张武器牌。",
            "jiqiao1":"机巧",
            "jiqiao1_info":"出牌阶段开始时，你可以弃置任意张装备牌，然后亮出牌堆顶五倍数量的牌，你获得其中的锦囊牌",
            kongsheng:"箜声",
            "kongsheng_info":"准备阶段，你可以将任意张牌置于你的武将牌上；结束阶段，你使用武将牌上的装备牌，并获得武将牌上的其他牌",
            "shenduan1":"慎断",
            "shenduan1_info":"当你的黑色基本牌因弃置而进入弃牌堆时，你可以将之视为 【兵粮寸断】并置于一名其他角色的判定区里",
            "jiezi1":"截辎",
            "jiezi1_info":"锁定技，一名其他角色跳过摸牌阶段后，你摸一张牌",
            "jigong1":"急攻",
            "jigong1_info":"出牌阶段开始时，你可以摸两张牌。若如此做，此回合你的手牌上限改为X(X为你此阶段造成的伤害数)",
            xinjizhi:"集智",
            "xinjizhi_info":"每当你使用一张非转化的锦囊牌，可以摸一张牌，如果摸到的是基本牌，你可以弃置这张牌，然后本回合手牌上限+1",
            "qingguo1":"倾国",
            "qingguo1_info":"你可以将一张黑色手牌当[闪]使用或打出",
            "fangzhu1":"放逐",
            "fangzhu1_info":"你每受到一次伤害，可令除你以外的任一角色补X张牌，X为你已损失的体力值，然后该角色将其武将牌翻面。",
            qiaobian:"巧变",
            "qiaobian1":"巧变·判定",
            "qiaobian2":"巧变·摸牌",
            "qiaobian3":"巧变·出牌",
            "qiaobian4":"巧变·弃牌",
            "qiaobian_info":"你可以弃一张手牌来跳过自己的一个阶段(回合开始和结束阶段除外);若以此法跳过摸牌阶段,你可以从其他至多两名角色手里各抽取一张牌;若以此法跳过出牌阶段,你可以将场上的一张牌移动到另一个合理的位置。",
            gaikunfen:"困奋",
            "gaikunfen_info":"锁定技，结束阶段开始时，你失去１点体力，然后摸两张牌",
            "fengliang1":"逢亮",
            "fengliang1_info":"觉醒技，当你进入濒死状态时，你减１点体力上限并将体力值回复至２点，然后获得技能挑衅，将困奋改为非锁定技",
            "yuhua1":"羽化",
            "yuhua1_info":"锁定技，弃牌阶段内，你的非基本牌不计入手牌数，且你不能弃置你的非基本牌",
            "qirang1":"祈禳",
            "qirang1_info":"当有装备牌进入你的装备区时，你可以获得牌堆中的一张锦囊牌",
            "tuntian1":"屯田",
            "tuntian1_info":"每次当你于回合外失去牌时，可以进行一次判定，将非♥结果的判定牌置于你的武将牌上，称为“田”，每有一张田，你的进攻距离+1.",
            "zaoxian1":"凿险",
            "zaoxian1_info":"觉醒技，准备阶段，若田的数量达到3张或更多，你须减1点体力上限，并永久获得技能“急袭”",
            jixi:"急袭",
            "jixi_info":"出牌阶段，你可以把任意一张田当【顺手牵羊】使用",
            "mizhao1":"密诏",
            "mizhao1_info":"出牌阶段，你可以将所有手牌(至少一张)交给一名其他角色。若如此做，你令该角色与你指定的另一名有手牌的角色拼点。视为拼点赢的角色对没赢的角色使用一张【杀】。每阶段限一次。",
            "hongde1":"弘德",
            "hongde1_info":"当你一次获得或失去至少两张牌后，你可以令一名其他角色摸一张牌",
            "shenxing1":"慎行",
            "shenxing1_info":"出牌阶段，你可以弃置两张牌，然后摸一张牌。",
            "wuyan1":"无言",
            "wuyan1_info":"锁定技，每当锦囊牌造成伤害时，若你为伤害来源，你防止此伤害；锁定技，每当你受到锦囊牌对你造成的伤害时，你防止此伤害。",
            "pingkou1":"平寇",
            "pingkou1_info":"回合结束时，你可以对至多X名其他角色各造成1点伤害（X为你本回合跳过的阶段数）。",
            "zhenwei1":"镇卫",
            "zhenwei2":"镇卫",
            "zhenwei1_info":"当一名其他角色成为【杀】或黑色锦囊牌的目标时（使用者不是你），若该角色的体力值小于你且此牌的目标角色数为1，你可以弃置一张牌。若如此做，你选择一项：1、摸一张牌，然后将此【杀】或黑色锦囊牌转移给你；2、令此【杀】或黑色锦囊牌无效，然后将此【杀】或黑色锦囊牌置于使用者的武将牌旁，若如此做，当前回合结束后，使用者获得使用者武将牌旁的这些牌",
            "xinshensu1":"神速",
            "shensu1":"神速",
            "shensu2":"神速",
            "shensu4":"神速",
            "xinshensu1_info":"你可以选择一至三项：1. 跳过判定阶段和摸牌阶段；2. 跳过出牌阶段并弃置一张装备牌；3. 跳过弃牌阶段并将你的武将牌翻面。你每选择一项，视为你对一名其他角色使用一张【杀】",
            "jianzheng1":"谏征",
            "jianzheng1_info":"当一名其他角色使用【杀】指定目标时，若你在其攻击范围内且你不是目标，则你可以将一张手牌置于牌堆顶，取消所有目标，然后若此【杀】不为黑色，你成为目标",
            cunmu:"寸目",
            "cunmu_info":"锁定技，当你摸牌时，改为从牌堆底摸牌",
            xinguanxing:"观星",
            "xinguanxing_info":"准备阶段，你可以观看牌堆顶的5张牌（存活角色小于4时改为3张），并将其以任意顺序置于牌堆项或牌堆底，如果你把观星的牌都放在牌堆底，你可以在结束阶段再进行1次观星",
            "shouxi1":"守玺",
            "shouxi1_info":"当你成为【杀】的目标后，你可声明一种未以此法声明过的基本牌或锦囊牌的牌名。若使用者弃置一张你声明的牌，其获得你的一张牌；若否，则此【杀】对你无效",
            danshou:"胆守",
            "danshou_info":"出牌阶段，你可以选择你攻击范围内的一名其他角色，然后弃置X张牌（X为此前你于此阶段你发动“胆守”的次数+1）。若X：为1，你弃置该角色的一张牌；为2，令该角色交给你一张牌；为3，你对该角色造成1点伤害；不小于4，你与该角色各摸两张牌。",
            "haosh1i":"好施",
            "haosh1i_info":"摸牌阶段，你可以额外摸两张牌，若此时你的手牌数多于五张，你必须将一半(向下取整)的手牌交给场上除你外手牌数最少的一名角色。",
            "beige1":"悲歌",
            "beige1_info":"一名角色每受到【杀】造成的一次伤害，你可以弃一张牌，并令其进行一次判定，判定结果为：♥该角色回复1点体力；♦︎该角色摸两张牌；♣伤害来源弃两张牌；♠伤害来源将其武将牌翻面",
            "jieming1":"节命",
            "jieming1_info":"你每受到1点伤害，可令任意一名角色将手牌补至其体力上限的张数(不能超过五张)。",
            "qianxi1":"潜袭",
            "qianxi2":"潜袭",
            "qianxi2_bg":"袭",
            "qianxi1_info":"准备阶段，你可以摸一张牌，并弃置一张牌，然后令一名距离为1的角色不能使用或打出与你弃置的牌颜色相同的手牌，直到回合结束。",
            "retieqi1":"铁骑",
            "retieqi1_info":"当你使用【杀】指定一名角色为目标后，你可以进行一次判定并令该角色的非锁定技失效直到回合结束，除非该角色弃置一张与判定结果花色相同的牌，否则不能使用【闪】抵消此【杀】。",
            "xiansi1":"陷嗣",
            "xiansi1_info":"准备阶段开始时，你可以将一至两名角色的各一张牌置于你的武将牌上，称为“逆”；每当一名角色需要对你使用杀时，该角色可以移去两张“逆”，视为对你使用一张杀。",
            "qieting1":"窃听",
            "qieting1_info":"一名其他角色的结束阶段，若其未于此回合内使用过指定另一名角色为目标的牌，你可以选择一项：将其装备区里的一张牌移动至你装备区里的相应位置（可替换原装备）；或摸一张牌。",
            "shenxian1":"甚贤",
            "shenxian1_info":"每名角色的回合限一次，你的回合外，每当有其他角色因弃置而失去牌时，若其中有基本牌，你可以摸一张牌。",
            "shuangxiong1":"双雄",
            "shuangxiong2":"双雄",
            "shuangxiong1_info":"摸牌阶段，你可选择改为进行一次判定：你获得此判定牌，且于此回合的出牌阶段，你可以将任意一张与此判定牌不同颜色的手牌当【决斗】使用。",
            "xinjuece1":"绝策",
            "xinjuece1_info":"结束阶段开始时，你可以对没有手牌的一名角色造成1点伤害",
            "xinfencheng1":"焚城",
            "xinfencheng1_info":"限定技，出牌阶段，你可以令所有其他角色各选择一项：弃置至少X张牌(X为该角色的上家以此法弃置牌的数量+1)；或受到你对其造成的2点火焰伤害",
            guixin:"归心",
            "guixin_info":"当你受到1点伤害后，你可以随机获得每名其他角色区域里的一张牌，然后你翻面",
            "mieji1":"灭计",
            "mieji1_info":"出牌阶段限一次，你可以展示一张黑色锦囊牌并将之置于牌堆顶，然后令有手牌的一名其他角色选择一项：弃置一张锦囊牌；或弃置两张非锦囊牌",
            "qizhou1":"绮胄",
            "qizhou1_info":"锁定技，你根据装备区里牌的花色数获得以下技能：1种或以上-马术；2种或以上-英姿；3种或以上-短兵；4种-奋威",
            "dujin1":"独进",
            "dujin1_info":"摸牌阶段，你可以额外摸X+1张牌（X为你装备区里牌数的一半且向下取整）",
            "zhichi1":"智迟",
            "zhichi2":"智迟",
            "zhichi1_info":"锁定技，你的回合外，你每受到一次伤害，任何【杀】或普通锦囊牌均对你无效，直到该回合结束。",
            "xiashu1":"下书",
            "xiashu1_info":"出牌阶段开始时，你可以将所有手牌交给一名其他角色，然后该角色亮出任意数量的手牌（至少一张），令你选择一项：1.获得其亮出的手牌；2.获得其未亮出的手牌",
            "kuanshi1":"宽释",
            "kuanshi1_info":"结束阶段，你可以选择一名角色。直到你的下回合开始，该角色下一次受到超过1点的伤害时，防止此伤害，然后你跳过下个回合的摸牌阶段",
            "ganlu1":"甘露",
            "ganlu1_info":"出牌阶段，你可以选择两名角色，交换他们装备区里的所有牌。以此法交换的装备数差不能超过X(X为你已损失体力值)。每回合限一次。",
            "duanxie1":"断绁",
            "duanxie1_info":"出牌阶段限一次，你可以令一名其他角色横置武将牌，若如此做，你横置武将牌。",
            fenmin:"奋命",
            "fenmin_info":"结束阶段开始时，若你处于连环状态，你可以弃置处于连环状态的每名角色的一张牌。",
            "taiji1":"太极",
            "taiji1_info":"每当你使用或打出一张闪，你可以使用一张杀",
            "jiudu1":"鸠毒",
            "jiudu1_info":"其他角色的出牌阶段开始时，你可以弃置一张手牌，视为该角色使用一张【酒】，然后你对其造成一点伤害。",
            "qiluan1":"戚乱",
            "qiluan1_info":"每当你杀死一名角色后，可以在此回合结束时摸三张牌。",
            "zhensha1":"鸩杀",
            "zhensha1_info":"当场上有角色进入濒死状态时，你可以弃置一张酒或两张黑色手牌，则该角色立即死亡。",
            "tuqiang1":"图强",
            "tuqiang1_info":"每当你使用或打出一张闪，你可以摸一张牌",
            "fenghuo1":"烽火",
            "fenghuo1_info":"你可以将一张装备区内的牌当作南蛮入侵使用",
            "zhuhai1":"诛害",
            "zhuhai1_info":"一名其他角色的结束阶段开始时，若该角色本回合造成过伤害，你可以对其使用一张【杀】。",
            "moukui1":"谋溃",
            "moukui1_info":"当你使用【杀】指定一名角色为目标后，你可以选择一项：摸一张牌，或弃置其一张牌。若如此做，此【杀】被【闪】抵消时，该角色弃置你的一张牌。 ",
            "qiangwu1":"枪舞",
            "qiangwu1_info":"出牌阶段，你可以进行一次判定。若如此做，则直到回合结束，你使用点数小于判定牌的 【杀】时不受距离限制，且你使用点数大于判定牌的【杀】时不计入出牌阶段的使用次数。",
            "weikui1":"伪溃",
            "weikui1_info":"出牌阶段限一次，你可以失去1点体力并选择一名有手牌的其他角色，你观看其手牌：若其手牌中有【闪】，则视为你对其使用【杀】,且本回合你计算与其的距离视为1；若其手牌中没有【闪】，你弃置其中一张牌",
            "huoji1":"火计",
            "huoji1_info":"出牌阶段，你可以将你的任意一张♥或♦手牌当【火攻】使用。",
            "kanpo1":"看破",
            "kanpo1_info":"你可以将你的任意一张♠或♣手牌当【无懈可击】使用。",
            "qianju1":"千驹",
            "qianju1_info":"锁定技，若你已受伤，你的进攻距离+X（X为你已损失体力值）",
            "quji1":"去疾",
            "quji1_info":"出牌阶段限一次，你可以弃置X张牌（X为你已损失的体力值），然后令至多X名已受伤的角色各回复1点体力。若你以此法弃置的牌中有黑色牌，你失去一点体力。",
            "ranshang1":"燃殇",
            "ranshang1_info":"锁定技，当你受到1点火焰伤害后，你获得1枚“燃”标记；结束阶段开始时，你失去X点体力（X为“燃”标记的数量）",
            "xueji1":"血祭",
            "xueji1_info":"出牌阶段限一次，你可以弃置一张红色牌，然后选择至多X名角色，横置这些角色并对其中一名角色造成1点火焰伤害。（X为你已损失的体力值数且至少为1）",
            "yingjian1":"影箭",
            "yingjian1_info":"准备阶段，你可以视为使用一张无视距离的杀",
            "guzheng1":"固政",
            "guzheng1_info":"其他角色的弃牌阶段结束时，你可将其弃置的一张牌返回其手牌，然后获得其弃置的其它牌",
            "guose1":"国色",
            "guose1_info":"你可以将任意一张红色手牌当[乐不思蜀]使用",
            "zishu1":"自书",
            "zishu1_info":"锁定技，你的回合外，你获得的牌均会在当前回合结束后置入弃牌堆；你的回合内，当你不因此技能效果获得牌时，额外摸一张牌。",
            "luanji1":"乱击",
            "luanji1_info":"你可以将两张与你本回合以此法转化的花色均不相同的手牌当【万箭齐发】使用，然后当一名已受伤的角色因响应此牌而打出【闪】时，该角色摸一张牌",
            "weimu1":"帷幕",
            "weimu1_info":"你不能成为黑色锦囊的目标。",
            "yizhong1":"毅重",
            "yizhong1_info":"锁定技，当你没有防具时，黑色的杀对你无效",
            "shenfen1":"神愤",
            "shenfen1_info":"出牌阶段，你可以弃6枚“暴怒”标记并选择所有其他角色，对这些角色各造成1点伤害，然后这些角色先各弃置其装备区里的牌，再各弃置四张手牌，最后你将你的武将牌翻面。每阶段限一次。",
            kuangbao:"狂暴",
            "kuangbao_info":"锁定技，游戏开始时，你获得两枚暴怒标记，每当你造成或受到一点伤害，你获得一枚暴怒标记",
        },
    },
    intro:"存在于异世界的武将",
    author:"谜之仙人",
    diskURL:"",
    forumURL:"",
    version:"1.3",
},files:{"character":["嵇授获.jpg","许蝉.jpg","华异.jpg","诸昏.jpg","曹侯淳.jpg","黄奉.jpg","典盖.jpg","孟康.jpg","黄志.jpg","荀睿.jpg","夏侯昂.jpg","荀逊.jpg","严香.jpg","李延.jpg","陈坚统.jpg","刘恪.jpg","刘攸.jpg","吕羽.jpg","马平.jpg","凌权.jpg","夏侯嘉.jpg","吕瑜.jpg","黄朗.jpg","马茹.jpg","兀突坚.jpg","桥昭纮.jpg","马松.jpg","王盖.jpg","关华.jpg","贾禁华.jpg","吕虎.jpg","孟姒延.jpg","郭佗.jpg","曹虎渊.jpg","沮康.jpg","赵飞.jpg","朱盖.jpg","刘亮.jpg","张芝.jpg","陈岑董昏.jpg","吴姬操.jpg","魏羽.jpg","乐仁.jpg","曹智仁.jpg","田逊.jpg","马嘉.jpg","诸超嘉.jpg","蔡文彧.jpg","颜貂文蝉.jpg","孙姒.jpg","高宓.jpg","郭图刘协.jpg","太史宓.jpg","袁华.jpg","甄懿.jpg","关松.jpg","吕丰践.jpg","徐羽策.jpg","诸葛获.jpg","甘逊.jpg","董获.jpg","孙仁.jpg","吴义.jpg","貂仁.jpg","诸攸节.jpg","鲁然.jpg","刘葛禅.jpg","蔡星.jpg","关彩.jpg","曹儒.jpg","贺操.jpg","阚宫.jpg","张坚.jpg","何雉.jpg","伏彩.jpg","曹盖.jpg","黄休.jpg","袁延奉.jpg","祝宓.jpg","孙华.jpg","孙瑜慈.jpg","王华.jpg","钟邕.jpg","诸马逊.jpg","孔白权.jpg","满攸.jpg","张顿.jpg","简乾灵.jpg","孙佗.jpg","诸昏育.jpg","诸葛冲.jpg","张超.jpg","黄恩月.jpg","徐浩纪协.jpg","甄白.jpg","曹嘉.jpg","植丕.jpg","张维.jpg","诸葛姬.jpg","邓协.jpg","步雍.jpg","刘丰.jpg","文亮.jpg","张宓昂.jpg","马岱超.jpg","刘尚姬.jpg","夏恒奉.jpg","凌宁逊.jpg"],"card":[],"skill":[]}}})
